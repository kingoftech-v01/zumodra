{% extends "base/freelanhub_dashboard_base.html" %}
{% load static i18n humanize %}

{% block title %}{% trans "Reports" %} - Zumodra{% endblock %}

{% block page_title %}{% trans "Reports" %}{% endblock %}

{% block dashboard_content %}
{% if request.tenant.tenant_type != 'company' %}
<div class="p-4 rounded-lg bg-yellow bg-opacity-10 border border-yellow">
    <div class="flex items-start gap-3">
        <i class="ph ph-warning text-yellow text-xl"></i>
        <div>
            <p class="caption1 text-title">
                {% trans "Analytics features are only available for company tenants." %}
                <a href="{% url 'tenants:tenant_settings' %}" class="font-medium underline hover:opacity-80">
                    {% trans "Switch to company account" %}
                </a>
            </p>
        </div>
    </div>
</div>
{% else %}
<!-- Breadcrumb -->
<div class="breadcrumb flex items-center gap-2 mb-6">
    <a href="{% url 'frontend:analytics:dashboard' %}" class="text-secondary hover:text-primary caption1">{% trans "Analytics" %}</a>
    <span class="ph ph-caret-right text-secondary"></span>
    <span class="text-title caption1">{% trans "Reports" %}</span>
</div>

<!-- Page Header -->
<div class="heading flex items-center justify-between mb-6">
    <div>
        <h3 class="heading3 text-title">{% trans "Reports" %}</h3>
        <p class="caption1 text-secondary mt-2">
            {% trans "Generate and download detailed reports for your organization." %}
        </p>
    </div>
    <button hx-get="{% url 'frontend:analytics:reports' %}"
            hx-target="#modal-container"
            hx-swap="innerHTML"
            class="button-main flex items-center gap-2">
        <i class="ph ph-plus"></i>
        {% trans "Create Report" %}
    </button>
</div>

<div id="main-content">
    <!-- Report Templates -->
    <div class="mb-8">
        <h4 class="heading5 text-title mb-4">{% trans "Quick Reports" %}</h4>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            <!-- Recruiting Summary -->
            <div class="p-6 rounded-lg bg-white hover:shadow-md transition-shadow cursor-pointer"
                 hx-get="{% url 'frontend:analytics:report-generate' %}?type=recruiting_summary"
                 hx-target="#modal-container"
                 hx-swap="innerHTML">
                <div class="flex items-center">
                    <div class="w-12 h-12 rounded-lg bg-blue bg-opacity-10 flex items-center justify-center">
                        <i class="ph ph-chart-bar text-blue text-2xl"></i>
                    </div>
                    <div class="ml-4">
                        <h5 class="caption1 font-medium text-title">{% trans "Recruiting Summary" %}</h5>
                        <p class="caption2 text-secondary">{% trans "Overview of hiring activity" %}</p>
                    </div>
                </div>
            </div>

            <!-- Pipeline Report -->
            <div class="p-6 rounded-lg bg-white hover:shadow-md transition-shadow cursor-pointer"
                 hx-get="{% url 'frontend:analytics:report-generate' %}?type=pipeline"
                 hx-target="#modal-container"
                 hx-swap="innerHTML">
                <div class="flex items-center">
                    <div class="w-12 h-12 rounded-lg bg-purple bg-opacity-10 flex items-center justify-center">
                        <i class="ph ph-funnel text-purple text-2xl"></i>
                    </div>
                    <div class="ml-4">
                        <h5 class="caption1 font-medium text-title">{% trans "Pipeline Report" %}</h5>
                        <p class="caption2 text-secondary">{% trans "Candidate flow analysis" %}</p>
                    </div>
                </div>
            </div>

            <!-- Source Effectiveness -->
            <div class="p-6 rounded-lg bg-white hover:shadow-md transition-shadow cursor-pointer"
                 hx-get="{% url 'frontend:analytics:report-generate' %}?type=source_effectiveness"
                 hx-target="#modal-container"
                 hx-swap="innerHTML">
                <div class="flex items-center">
                    <div class="w-12 h-12 rounded-lg bg-green bg-opacity-10 flex items-center justify-center">
                        <i class="ph ph-chart-pie-slice text-green text-2xl"></i>
                    </div>
                    <div class="ml-4">
                        <h5 class="caption1 font-medium text-title">{% trans "Source Analysis" %}</h5>
                        <p class="caption2 text-secondary">{% trans "Channel performance" %}</p>
                    </div>
                </div>
            </div>

            <!-- Time Metrics -->
            <div class="p-6 rounded-lg bg-white hover:shadow-md transition-shadow cursor-pointer"
                 hx-get="{% url 'frontend:analytics:report-generate' %}?type=time_metrics"
                 hx-target="#modal-container"
                 hx-swap="innerHTML">
                <div class="flex items-center">
                    <div class="w-12 h-12 rounded-lg bg-orange bg-opacity-10 flex items-center justify-center">
                        <i class="ph ph-clock text-orange text-2xl"></i>
                    </div>
                    <div class="ml-4">
                        <h5 class="caption1 font-medium text-title">{% trans "Time Metrics" %}</h5>
                        <p class="caption2 text-secondary">{% trans "Hiring speed analysis" %}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Reports -->
    <div class="p-8 rounded-lg bg-white">
        <div class="mb-6">
            <h4 class="heading5 text-title">{% trans "Recent Reports" %}</h4>
        </div>
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left caption2 font-medium text-secondary uppercase tracking-wider">{% trans "Report Name" %}</th>
                        <th scope="col" class="px-6 py-3 text-left caption2 font-medium text-secondary uppercase tracking-wider">{% trans "Type" %}</th>
                        <th scope="col" class="px-6 py-3 text-left caption2 font-medium text-secondary uppercase tracking-wider">{% trans "Date Range" %}</th>
                        <th scope="col" class="px-6 py-3 text-left caption2 font-medium text-secondary uppercase tracking-wider">{% trans "Created" %}</th>
                        <th scope="col" class="px-6 py-3 text-left caption2 font-medium text-secondary uppercase tracking-wider">{% trans "Status" %}</th>
                        <th scope="col" class="relative px-6 py-3"><span class="sr-only">{% trans "Actions" %}</span></th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for report in reports %}
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="caption1 font-medium text-title">{{ report.name }}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap caption1 text-secondary">{{ report.get_type_display }}</td>
                        <td class="px-6 py-4 whitespace-nowrap caption1 text-secondary">
                            {{ report.start_date|date:"M d" }} - {{ report.end_date|date:"M d, Y" }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap caption1 text-secondary">{{ report.created_at|naturaltime }}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            {% if report.status == 'completed' %}
                            <span class="tag bg-green bg-opacity-10 text-green">{% trans "Ready" %}</span>
                            {% elif report.status == 'processing' %}
                            <span class="tag bg-yellow bg-opacity-10 text-yellow">{% trans "Processing" %}</span>
                            {% else %}
                            <span class="tag bg-red bg-opacity-10 text-red">{% trans "Failed" %}</span>
                            {% endif %}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-right caption1 font-medium">
                            <div class="flex items-center justify-end gap-3">
                                {% if report.status == 'completed' %}
                                <a href="{{ report.file.url }}" class="text-primary hover:text-primary-dark" download>
                                    <i class="ph ph-download-simple text-xl"></i>
                                </a>
                                {% endif %}
                                <button hx-delete="{% url 'frontend:analytics:reports' report.id %}"
                                        hx-confirm="{% trans 'Are you sure you want to delete this report?' %}"
                                        hx-swap="outerHTML swap:1s"
                                        class="text-red hover:text-red-dark">
                                    <i class="ph ph-trash text-xl"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="px-6 py-12 text-center">
                            <i class="ph ph-file-text text-6xl text-secondary mb-4"></i>
                            <h5 class="heading6 text-title mb-2">{% trans "No reports yet" %}</h5>
                            <p class="caption1 text-secondary">{% trans "Generate your first report using the templates above." %}</p>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        {% if page_obj %}
        {% include "components/pagination.html" %}
        {% endif %}
    </div>
</div>
{% endif %}
{% endblock %}
