{% extends "base/freelanhub_dashboard_base.html" %}
{% load static i18n humanize %}

{% block page_title %}Finance Dashboard{% endblock %}

{% block dashboard_content %}
<!-- Page Header -->
<div class="heading flex items-center justify-between mb-7.5">
    <div>
        <h3 class="heading3">{% trans "Finance Dashboard" %}</h3>
        <p class="caption1 text-secondary mt-1">{% trans "Overview of your financial activities" %}</p>
    </div>
    {% if request.tenant %}
        {% if request.tenant.tenant_type == 'company' %}
            <span class="tag bg-blue bg-opacity-10 text-blue">
                <span class="ph ph-buildings text-lg mr-1"></span>
                {% trans "Company" %}
            </span>
        {% else %}
            <span class="tag bg-green bg-opacity-10 text-green">
                <span class="ph ph-user text-lg mr-1"></span>
                {% trans "Freelancer" %}
            </span>
        {% endif %}
    {% endif %}
</div>
<!-- Quick Stats -->
<div id="finance-quick-stats"
     hx-get="{% url 'finance-frontend:quick-stats' %}"
     hx-trigger="load, every 60s"
     hx-swap="innerHTML">
    {% include "finance/partials/_quick_stats.html" %}
</div>

<!-- Main Grid -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-7.5 mt-7.5">
    <!-- Left Column: Recent Payments & Pending Invoices -->
    <div class="lg:col-span-2 space-y-7.5">
        <!-- Recent Payments -->
        <div class="p-8 rounded-lg bg-white">
            <div class="flex items-center justify-between mb-6 pb-6 border-b border-line">
                <h4 class="heading5">{% trans "Recent Payments" %}</h4>
                <a href="{% url 'finance-frontend:payment-history' %}"
                   class="caption1 text-primary hover:underline">
                    {% trans "View all" %}
                </a>
            </div>
            <div id="recent-payments"
                 hx-get="{% url 'finance-frontend:recent-payments' %}"
                 hx-trigger="load"
                 hx-swap="innerHTML">
                {% include "finance/partials/_recent_payments.html" %}
            </div>
        </div>

        <!-- Pending Invoices -->
        <div class="p-8 rounded-lg bg-white">
            <div class="flex items-center justify-between mb-6 pb-6 border-b border-line">
                <h4 class="heading5">{% trans "Pending Invoices" %}</h4>
                <a href="{% url 'finance-frontend:invoices' %}"
                   class="caption1 text-primary hover:underline">
                    {% trans "View all" %}
                </a>
            </div>
            <div id="pending-invoices"
                 hx-get="{% url 'finance-frontend:pending-invoices' %}"
                 hx-trigger="load"
                 hx-swap="innerHTML">
                {% include "finance/partials/_pending_invoices.html" %}
            </div>
        </div>
    </div>

    <!-- Right Column: Subscription & Escrow Summary -->
    <div class="space-y-7.5">
        <!-- Subscription Status -->
        <div class="p-6 rounded-lg bg-white">
            <h4 class="heading6 mb-4">{% trans "Subscription" %}</h4>
            {% if subscription %}
            <div class="space-y-3">
                <div class="flex items-center justify-between">
                    <span class="caption1 text-secondary">{% trans "Plan" %}</span>
                    <span class="caption1 text-title">{{ subscription.plan.name }}</span>
                </div>
                <div class="flex items-center justify-between">
                    <span class="caption1 text-secondary">{% trans "Status" %}</span>
                    <span class="tag
                        {% if subscription.status == 'active' %}bg-green bg-opacity-10 text-green
                        {% elif subscription.status == 'past_due' %}bg-yellow bg-opacity-10 text-yellow
                        {% else %}bg-grey bg-opacity-10 text-grey{% endif %}">
                        {{ subscription.status|title }}
                    </span>
                </div>
                <div class="flex items-center justify-between">
                    <span class="caption1 text-secondary">{% trans "Renews" %}</span>
                    <span class="caption1 text-title">{{ subscription.current_period_end|date:"M d, Y" }}</span>
                </div>
            </div>
            <div class="mt-4">
                <a href="{% url 'finance-frontend:subscription' %}"
                   class="button-main -border w-full">
                    {% trans "Manage Subscription" %}
                </a>
            </div>
            {% else %}
            <div class="text-center py-4">
                <p class="caption1 text-secondary mb-4">{% trans "No active subscription" %}</p>
                <a href="{% url 'finance-frontend:subscription' %}"
                   class="button-main">
                    {% trans "View Plans" %}
                </a>
            </div>
            {% endif %}
        </div>

        <!-- Escrow Summary -->
        <div class="p-6 rounded-lg bg-white"
             id="escrow-summary"
             hx-get="{% url 'finance-frontend:escrow-summary' %}"
             hx-trigger="load"
             hx-swap="innerHTML">
            {% include "finance/partials/_escrow_summary.html" %}
        </div>

        <!-- Payment Methods -->
        <div class="p-6 rounded-lg bg-white">
            <div class="flex justify-between items-center mb-4">
                <h4 class="heading6">{% trans "Payment Methods" %}</h4>
                <span class="caption1 text-secondary">{{ payment_methods_count }} {% trans "saved" %}</span>
            </div>
            <a href="{% url 'finance-frontend:payment-methods' %}"
               class="button-main -border w-full">
                {% trans "Manage Payment Methods" %}
            </a>
        </div>

        <!-- Connected Account (Stripe Connect) -->
        {% if connected_account %}
        <div class="p-6 rounded-lg bg-white">
            <h4 class="heading6 mb-4">{% trans "Seller Account" %}</h4>
            <div class="space-y-3">
                <div class="flex items-center justify-between">
                    <span class="caption1 text-secondary">{% trans "Status" %}</span>
                    <span class="tag
                        {% if connected_account.account_status == 'active' %}bg-green bg-opacity-10 text-green
                        {% elif connected_account.account_status == 'restricted' %}bg-yellow bg-opacity-10 text-yellow
                        {% else %}bg-grey bg-opacity-10 text-grey{% endif %}">
                        {{ connected_account.account_status|title }}
                    </span>
                </div>
                <div class="flex items-center justify-between">
                    <span class="caption1 text-secondary">{% trans "Payouts" %}</span>
                    <span class="caption1 text-title">
                        {% if connected_account.payouts_enabled %}{% trans "Enabled" %}{% else %}{% trans "Disabled" %}{% endif %}
                    </span>
                </div>
            </div>
            <div class="mt-4">
                <a href="{% url 'finance-frontend:connected-account' %}"
                   class="button-main -border w-full">
                    {% trans "Manage Seller Account" %}
                </a>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
