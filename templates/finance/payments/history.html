{% extends "base/freelanhub_dashboard_base.html" %}
{% load static i18n humanize %}

{% block page_title %}Payment History{% endblock %}

{% block dashboard_content %}
<!-- Breadcrumb -->
<div class="breadcrumb flex items-center gap-2 mb-6">
    <a href="{% url 'frontend:finance:dashboard' %}" class="text-secondary hover:text-primary caption1">{% trans "Finance" %}</a>
    <span class="ph ph-caret-right text-secondary"></span>
    <span class="text-title caption1">{% trans "Payment History" %}</span>
</div>

<!-- Page Header -->
<div class="heading flex items-center justify-between mb-7.5">
    <div>
        <h3 class="heading3">{% trans "Payment History" %}</h3>
        <p class="caption1 text-secondary mt-1">{% trans "View all your payment transactions" %}</p>
    </div>
    {% if request.tenant %}
        {% if request.tenant.tenant_type == 'company' %}
            <span class="tag bg-blue bg-opacity-10 text-blue">
                <span class="ph ph-buildings text-lg mr-1"></span>
                {% trans "Company" %}
            </span>
        {% else %}
            <span class="tag bg-green bg-opacity-10 text-green">
                <span class="ph ph-user text-lg mr-1"></span>
                {% trans "Freelancer" %}
            </span>
        {% endif %}
    {% endif %}
</div>

<!-- Stats Cards -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-7.5 mb-7.5">
    <div class="p-6 rounded-lg bg-white">
        <p class="caption1 text-secondary mb-2">{% trans "Total Spent" %}</p>
        <p class="heading4 text-title">${{ total_spent|floatformat:2|intcomma }}</p>
    </div>
    <div class="p-6 rounded-lg bg-white">
        <p class="caption1 text-secondary mb-2">{% trans "Successful" %}</p>
        <p class="heading4 text-green">{{ successful_count }}</p>
    </div>
    <div class="p-6 rounded-lg bg-white">
        <p class="caption1 text-secondary mb-2">{% trans "Failed" %}</p>
        <p class="heading4 text-red">{{ failed_count }}</p>
    </div>
</div>

<!-- Filters -->
<div class="p-6 rounded-lg bg-white mb-7.5">
    <form id="payment-filters" hx-get="{% url 'frontend:finance:payment-list-partial' %}" hx-target="#payment-list" hx-trigger="change, submit" hx-push-url="true">
        <div class="flex flex-wrap gap-4 items-end">
            <div>
                <label for="status" class="block caption1 text-title mb-2">{% trans "Status" %}</label>
                <select id="status" name="status" class="px-4 py-2 border border-line rounded-lg caption1 text-title">
                    <option value="">{% trans "All" %}</option>
                    <option value="succeeded" {% if current_filters.status == 'succeeded' %}selected{% endif %}>{% trans "Succeeded" %}</option>
                    <option value="failed" {% if current_filters.status == 'failed' %}selected{% endif %}>{% trans "Failed" %}</option>
                </select>
            </div>
            <div>
                <label for="start_date" class="block caption1 text-title mb-2">{% trans "From" %}</label>
                <input type="date" id="start_date" name="start_date" value="{{ current_filters.start_date }}"
                       class="px-4 py-2 border border-line rounded-lg caption1 text-title">
            </div>
            <div>
                <label for="end_date" class="block caption1 text-title mb-2">{% trans "To" %}</label>
                <input type="date" id="end_date" name="end_date" value="{{ current_filters.end_date }}"
                       class="px-4 py-2 border border-line rounded-lg caption1 text-title">
            </div>
            <button type="button" onclick="document.getElementById('payment-filters').reset(); htmx.trigger('#payment-filters', 'change');"
                    class="caption1 text-secondary hover:text-title">
                {% trans "Clear" %}
            </button>
        </div>
    </form>
</div>

<!-- Payment List -->
<div id="payment-list"
     hx-get="{% url 'frontend:finance:payment-list-partial' %}"
     hx-trigger="load"
     hx-swap="innerHTML">
    <div class="flex justify-center py-12">
        <span class="ph ph-spinner text-4xl text-primary animate-spin"></span>
    </div>
</div>
{% endblock %}
