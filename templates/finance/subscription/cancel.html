{% extends "base/dashboard_base.html" %}
{% load static i18n %}

{% block breadcrumb %}
<li><span class="text-gray-400 mx-2">/</span></li>
<li><a href="{% url 'finance-frontend:dashboard' %}" class="text-gray-500 dark:text-gray-400 hover:text-gray-700">Finance</a></li>
<li><span class="text-gray-400 mx-2">/</span></li>
<li><a href="{% url 'finance-frontend:subscription' %}" class="text-gray-500 dark:text-gray-400 hover:text-gray-700">Subscription</a></li>
<li><span class="text-gray-400 mx-2">/</span></li>
<li><span class="text-gray-900 dark:text-gray-100 font-medium">Cancel</span></li>
{% endblock %}

{% block page_title %}Cancel Subscription{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto space-y-6">
    <!-- Warning -->
    <div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-6">
        <div class="flex">
            <div class="flex-shrink-0">
                <svg class="h-6 w-6 text-yellow-600 dark:text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                </svg>
            </div>
            <div class="ml-3">
                <h3 class="text-sm font-medium text-yellow-800 dark:text-yellow-200">Are you sure?</h3>
                <p class="mt-2 text-sm text-yellow-700 dark:text-yellow-300">
                    You're about to cancel your {{ subscription.plan.name }} subscription.
                </p>
            </div>
        </div>
    </div>

    <!-- Current Plan Info -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
        <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">What you'll lose</h3>
        <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg mb-4">
            <p class="font-medium text-gray-900 dark:text-white">{{ subscription.plan.name }}</p>
            <p class="text-sm text-gray-500 dark:text-gray-400">${{ subscription.plan.price|floatformat:2 }}/{{ subscription.plan.interval }}</p>
        </div>
        {% if subscription.plan.description %}
        <ul class="space-y-2">
            {% for feature in subscription.plan.description.splitlines %}
            {% if feature.strip %}
            <li class="flex items-center text-sm text-gray-600 dark:text-gray-300">
                <svg class="flex-shrink-0 h-4 w-4 text-red-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
                {{ feature.strip }}
            </li>
            {% endif %}
            {% endfor %}
        </ul>
        {% endif %}
    </div>

    <!-- Cancel Form -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
        <form hx-post="{% url 'finance-frontend:subscription-cancel-confirm' %}"
              hx-swap="outerHTML"
              class="space-y-4">
            {% csrf_token %}

            <div>
                <label for="reason" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                    Why are you canceling? (Optional)
                </label>
                <select id="reason" name="reason"
                        class="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-primary-500 focus:ring-primary-500">
                    <option value="">Select a reason</option>
                    <option value="too_expensive">Too expensive</option>
                    <option value="not_using">Not using it enough</option>
                    <option value="missing_features">Missing features I need</option>
                    <option value="switching">Switching to another service</option>
                    <option value="temporary">Just need a break</option>
                    <option value="other">Other</option>
                </select>
            </div>

            <div>
                <label class="flex items-center">
                    <input type="checkbox" name="cancel_at_period_end" value="true" checked
                           class="rounded border-gray-300 dark:border-gray-600 text-primary-600 focus:ring-primary-500">
                    <span class="ml-2 text-sm text-gray-600 dark:text-gray-300">
                        Cancel at end of billing period ({{ subscription.current_period_end|date:"M d, Y" }})
                    </span>
                </label>
            </div>

            <div class="flex justify-between pt-4">
                <a href="{% url 'finance-frontend:subscription' %}"
                   class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white">
                    Keep My Subscription
                </a>
                <button type="submit"
                        class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 font-medium text-sm">
                    Cancel Subscription
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
