{% extends "base/freelanhub_dashboard_base.html" %}
{% load static i18n humanize %}

{% block page_title %}Escrow Transactions{% endblock %}

{% block dashboard_content %}
<!-- Breadcrumb -->
<div class="breadcrumb flex items-center gap-2 mb-6">
    <a href="{% url 'frontend:finance:dashboard' %}" class="text-secondary hover:text-primary caption1">{% trans "Finance" %}</a>
    <span class="ph ph-caret-right text-secondary"></span>
    <span class="text-title caption1">{% trans "Escrow" %}</span>
</div>

<!-- Page Header -->
<div class="heading flex items-center justify-between mb-7.5">
    <div>
        <h3 class="heading3">{% trans "Escrow Transactions" %}</h3>
        <p class="caption1 text-secondary mt-1">{% trans "Manage your escrow transactions as buyer or seller" %}</p>
    </div>
    {% if request.tenant %}
        {% if request.tenant.tenant_type == 'company' %}
            <span class="tag bg-blue bg-opacity-10 text-blue">
                <span class="ph ph-buildings text-lg mr-1"></span>
                {% trans "Company" %}
            </span>
        {% else %}
            <span class="tag bg-green bg-opacity-10 text-green">
                <span class="ph ph-user text-lg mr-1"></span>
                {% trans "Freelancer" %}
            </span>
        {% endif %}
    {% endif %}
</div>

<!-- Stats Cards -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-7.5 mb-7.5">
    <div class="p-6 rounded-lg bg-white">
        <p class="caption1 text-secondary mb-2">{% trans "As Buyer" %}</p>
        <p class="heading4 text-title">${{ total_as_buyer|floatformat:2|intcomma }}</p>
    </div>
    <div class="p-6 rounded-lg bg-white">
        <p class="caption1 text-secondary mb-2">{% trans "As Seller" %}</p>
        <p class="heading4 text-title">${{ total_as_seller|floatformat:2|intcomma }}</p>
    </div>
    <div class="p-6 rounded-lg bg-white">
        <p class="caption1 text-secondary mb-2">{% trans "Pending" %}</p>
        <p class="heading4 text-title">{{ pending_count }}</p>
    </div>
</div>

<!-- Filters -->
<div class="p-6 rounded-lg bg-white mb-7.5">
    <form id="escrow-filters" hx-get="{% url 'frontend:finance:escrow-list-partial' %}" hx-target="#escrow-list" hx-trigger="change, submit" hx-push-url="true">
        <div class="flex flex-wrap gap-4 items-end">
            <div>
                <label for="role" class="block caption1 text-title mb-2">{% trans "Role" %}</label>
                <select id="role" name="role" class="px-4 py-2 border border-line rounded-lg caption1 text-title">
                    <option value="">{% trans "All Roles" %}</option>
                    <option value="buyer" {% if current_filters.role == 'buyer' %}selected{% endif %}>{% trans "As Buyer" %}</option>
                    <option value="seller" {% if current_filters.role == 'seller' %}selected{% endif %}>{% trans "As Seller" %}</option>
                </select>
            </div>
            <div>
                <label for="status" class="block caption1 text-title mb-2">{% trans "Status" %}</label>
                <select id="status" name="status" class="px-4 py-2 border border-line rounded-lg caption1 text-title">
                    <option value="">{% trans "All Status" %}</option>
                    <option value="initialized" {% if current_filters.status == 'initialized' %}selected{% endif %}>{% trans "Initialized" %}</option>
                    <option value="funded" {% if current_filters.status == 'funded' %}selected{% endif %}>{% trans "Funded" %}</option>
                    <option value="service_delivered" {% if current_filters.status == 'service_delivered' %}selected{% endif %}>{% trans "Delivered" %}</option>
                    <option value="released" {% if current_filters.status == 'released' %}selected{% endif %}>{% trans "Released" %}</option>
                    <option value="dispute" {% if current_filters.status == 'dispute' %}selected{% endif %}>{% trans "Disputed" %}</option>
                    <option value="refunded" {% if current_filters.status == 'refunded' %}selected{% endif %}>{% trans "Refunded" %}</option>
                </select>
            </div>
            <button type="button" onclick="document.getElementById('escrow-filters').reset(); htmx.trigger('#escrow-filters', 'change');"
                    class="caption1 text-secondary hover:text-title">
                {% trans "Clear Filters" %}
            </button>
        </div>
    </form>
</div>

<!-- Escrow List -->
<div id="escrow-list"
     hx-get="{% url 'frontend:finance:escrow-list-partial' %}"
     hx-trigger="load"
     hx-swap="innerHTML">
    <div class="flex justify-center py-12">
        <span class="ph ph-spinner text-4xl text-primary animate-spin"></span>
    </div>
</div>
{% endblock %}
