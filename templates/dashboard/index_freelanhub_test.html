{% extends "base/freelanhub_dashboard_base.html" %}
{% load static i18n %}

{% block page_title %}{% trans "Dashboard" %}{% endblock %}

{% block dashboard_content %}
    <h4 class="heading4 max-lg:mt-3">{% trans "Dashboard" %}</h4>

    <!-- Quick Stats Cards -->
    <ul class="list_counter grid 2xl:grid-cols-4 grid-cols-2 sm:gap-7.5 gap-5 mt-7.5 w-full">
        {% include 'components/dashboard/stats_card.html' with label="Open Jobs" value=stats.open_jobs|default:"0" icon="briefcase" item_class="applied_job" %}
        {% include 'components/dashboard/stats_card.html' with label="Total Candidates" value=stats.total_candidates|default:"0" icon="users-three" item_class="services_offered" %}
        {% include 'components/dashboard/stats_card.html' with label="Active Applications" value=stats.active_applications|default:"0" icon="notepad" item_class="views_profile" %}
        {% include 'components/dashboard/stats_card.html' with label="Pending Interviews" value=stats.pending_interviews|default:"0" icon="video-camera" item_class="total_reviews" %}
    </ul>

    <!-- Chart and Notifications Section -->
    <div class="chart_overview flex max-xl:flex-col gap-7.5 mt-7.5">
        <!-- Chart Container -->
        {% include 'components/dashboard/chart_container.html' with chart_id="chart-timeline" chart_title="Overview" show_time_filter=True %}

        <!-- Notification Widget -->
        {% include 'components/dashboard/notification_widget.html' with notifications=recent_activity %}
    </div>

    <!-- Upcoming Interviews Section -->
    <div class="mt-7.5">
        <div class="rounded-lg bg-white p-6">
            <div class="flex items-center justify-between mb-4">
                <h5 class="heading5">{% trans "Upcoming Interviews" %}</h5>
                <a href="{% url 'frontend:ats:interview_list' %}" class="text-button text-primary hover:underline">
                    {% trans "View All" %}
                </a>
            </div>

            {% if upcoming_interviews %}
            <!-- Data Table for Interviews -->
            {% with headers=interview_headers rows=interview_rows %}
                {% include 'components/dashboard/data_table.html' %}
            {% endwith %}
            {% else %}
            <div class="text-center py-12">
                <span class="ph ph-calendar-blank text-6xl text-secondary block mb-4"></span>
                <h3 class="heading6 mb-2">{% trans "No upcoming interviews" %}</h3>
                <p class="text-secondary">{% trans "Schedule interviews from the applications page." %}</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Quick Actions Section -->
    <div class="mt-7.5">
        <h5 class="heading5 mb-4">{% trans "Quick Actions" %}</h5>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <a href="{% url 'frontend:ats:job_create' %}" class="flex flex-col items-center gap-3 p-6 rounded-lg bg-white duration-300 hover:shadow-lg">
                <div class="flex items-center justify-center w-16 h-16 rounded-full bg-gradient">
                    <span class="ph-fill ph-plus text-3xl text-white"></span>
                </div>
                <span class="text-button text-center">{% trans "Post New Job" %}</span>
            </a>

            <a href="{% url 'frontend:ats:candidate_list' %}" class="flex flex-col items-center gap-3 p-6 rounded-lg bg-white duration-300 hover:shadow-lg">
                <div class="flex items-center justify-center w-16 h-16 rounded-full bg-gradient">
                    <span class="ph-fill ph-users-three text-3xl text-white"></span>
                </div>
                <span class="text-button text-center">{% trans "View Candidates" %}</span>
            </a>

            <a href="{% url 'frontend:ats:pipeline_board' %}" class="flex flex-col items-center gap-3 p-6 rounded-lg bg-white duration-300 hover:shadow-lg">
                <div class="flex items-center justify-center w-16 h-16 rounded-full bg-gradient">
                    <span class="ph-fill ph-kanban text-3xl text-white"></span>
                </div>
                <span class="text-button text-center">{% trans "Pipeline" %}</span>
            </a>

            <a href="{% url 'frontend:hr:employee_directory' %}" class="flex flex-col items-center gap-3 p-6 rounded-lg bg-white duration-300 hover:shadow-lg">
                <div class="flex items-center justify-center w-16 h-16 rounded-full bg-gradient">
                    <span class="ph-fill ph-identification-card text-3xl text-white"></span>
                </div>
                <span class="text-button text-center">{% trans "Employees" %}</span>
            </a>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
<script>
    // Dashboard chart initialization
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize ApexCharts if chart data is available
        if (typeof ApexCharts !== 'undefined') {
            var options = {
                series: [{
                    name: 'Applications',
                    data: {{ chart_data.applications|default:"[0,0,0,0,0,0,0,0,0,0,0,0]" }}
                }],
                chart: {
                    type: 'area',
                    height: 350,
                    toolbar: {
                        show: false
                    }
                },
                dataLabels: {
                    enabled: false
                },
                stroke: {
                    curve: 'smooth',
                    width: 2
                },
                xaxis: {
                    categories: {{ chart_data.months|default:"['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec']" }}
                },
                colors: ['#6366f1'],
                fill: {
                    type: 'gradient',
                    gradient: {
                        shadeIntensity: 1,
                        opacityFrom: 0.7,
                        opacityTo: 0.2,
                    }
                }
            };

            var chart = new ApexCharts(document.querySelector("#chart-timeline"), options);
            chart.render();
        }
    });
</script>
{% endblock %}
