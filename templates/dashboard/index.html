{% extends "base/freelanhub_dashboard_base.html" %}
{% load static i18n %}

{% block page_title %}{% trans "Dashboard" %}{% endblock %}

{% block dashboard_content %}
    <h4 class="heading4 max-lg:mt-3">{% trans "Dashboard" %}</h4>

    <!-- Quick Stats Cards -->
    <ul class="list_counter grid 2xl:grid-cols-4 grid-cols-2 sm:gap-7.5 gap-5 mt-7.5 w-full">
        {% include 'components/dashboard/stats_card.html' with label="Open Jobs" value=stats.open_jobs|default:"0" icon="briefcase" item_class="applied_job" %}
        {% include 'components/dashboard/stats_card.html' with label="Total Candidates" value=stats.total_candidates|default:"0" icon="users-three" item_class="services_offered" %}
        {% include 'components/dashboard/stats_card.html' with label="Active Applications" value=stats.active_applications|default:"0" icon="notepad" item_class="views_profile" %}
        {% include 'components/dashboard/stats_card.html' with label="Pending Interviews" value=stats.pending_interviews|default:"0" icon="video-camera" item_class="total_reviews" %}
    </ul>

    <!-- Chart and Notifications Section -->
    <div class="chart_overview flex max-xl:flex-col gap-7.5 mt-7.5">
        <!-- Chart Container -->
        <div class="w-full h-full rounded-lg bg-white">
            <div class="flex flex-wrap justify-between gap-6 p-6">
                <h5 class="heading5">{% trans "Overview" %}</h5>
                <div class="menu_time flex flex-wrap gap-7.5">
                    <button id="one_week" class="button_time line-before line-black line-2px text-button text-secondary">{% trans "Week" %}</button>
                    <button id="one_month" class="button_time line-before line-black line-2px text-button text-secondary">{% trans "Month" %}</button>
                    <button id="one_year" class="button_time line-before line-black line-2px text-button text-secondary active">{% trans "Year" %}</button>
                </div>
            </div>
            <div class="chart md:px-6 pb-6">
                <div id="chart-timeline"></div>
            </div>
        </div>

        <!-- Notification Widget -->
        <div class="notification overflow-hidden flex-shrink-0 flex-grow xl:w-[300px] h-full rounded-lg bg-white py-6">
            <h5 class="heading5 px-6">{% trans "Notifications" %}</h5>
            <ul class="list_notification scrollbar_custom max-h-[420px] flex flex-col gap-2.5 px-6 mt-5">
                {% for activity in recent_activity %}
                <li class="item flex gap-2">
                    <span class="icon flex flex-shrink-0 items-center justify-center w-8 h-8 rounded-full bg-surface text-secondary">
                        <span class="ph-fill ph-bell text-lg"></span>
                    </span>
                    <div class="content flex flex-col gap-2">
                        <p class="title text-secondary">{{ activity.message|safe }}</p>
                        <span class="date caption1 text-secondary">{{ activity.created_at|timesince }} {% trans "ago" %}</span>
                    </div>
                </li>
                {% empty %}
                <li class="item text-center py-8">
                    <p class="text-secondary">{% trans "No new notifications" %}</p>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <!-- Upcoming Interviews Section -->
    <div class="mt-7.5">
        <div class="rounded-lg bg-white p-6">
            <div class="flex items-center justify-between mb-4">
                <h5 class="heading5">{% trans "Upcoming Interviews" %}</h5>
                <a href="{% url 'frontend:ats:interview_list' %}" class="text-button text-primary hover:underline">
                    {% trans "View All" %}
                </a>
            </div>

            {% if upcoming_interviews %}
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-surface">
                        <tr>
                            <th class="sm:py-4 py-3 sm:px-4 px-2 text-left">
                                <span class="caption1">{% trans "Candidate" %}</span>
                            </th>
                            <th class="sm:py-4 py-3 sm:px-4 px-2 text-left">
                                <span class="caption1">{% trans "Job" %}</span>
                            </th>
                            <th class="sm:py-4 py-3 sm:px-4 px-2 text-left">
                                <span class="caption1">{% trans "Date & Time" %}</span>
                            </th>
                            <th class="sm:py-4 py-3 sm:px-4 px-2 text-left">
                                <span class="caption1">{% trans "Type" %}</span>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for interview in upcoming_interviews %}
                        <tr class="item duration-300 hover:bg-background">
                            <td class="sm:py-4 py-3 sm:px-4 px-2">
                                <div class="flex items-center gap-3">
                                    {% if interview.candidate.profile_image %}
                                    <img src="{{ interview.candidate.profile_image.url }}" alt="{{ interview.candidate.full_name }}" class="w-10 h-10 rounded-full object-cover">
                                    {% else %}
                                    <div class="w-10 h-10 rounded-full bg-gradient flex items-center justify-center">
                                        <span class="text-white text-button">{{ interview.candidate.full_name.0 }}</span>
                                    </div>
                                    {% endif %}
                                    <span class="text-title">{{ interview.candidate.full_name }}</span>
                                </div>
                            </td>
                            <td class="sm:py-4 py-3 sm:px-4 px-2">{{ interview.job.title }}</td>
                            <td class="sm:py-4 py-3 sm:px-4 px-2">
                                {{ interview.scheduled_at|date:"M d, Y" }}<br>
                                <span class="text-secondary caption1">{{ interview.scheduled_at|time:"H:i" }}</span>
                            </td>
                            <td class="sm:py-4 py-3 sm:px-4 px-2">
                                <span class="px-3 py-1 rounded-full text-xs {% if interview.interview_type == 'video' %}bg-blue-100 text-blue-700{% elif interview.interview_type == 'phone' %}bg-yellow-100 text-yellow-700{% else %}bg-green-100 text-green-700{% endif %}">
                                    {{ interview.get_interview_type_display }}
                                </span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center py-12">
                <span class="ph ph-calendar-blank text-6xl text-secondary block mb-4"></span>
                <h3 class="heading6 mb-2">{% trans "No upcoming interviews" %}</h3>
                <p class="text-secondary">{% trans "Schedule interviews from the applications page." %}</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Quick Actions Section -->
    <div class="mt-7.5">
        <h5 class="heading5 mb-4">{% trans "Quick Actions" %}</h5>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <a href="{% url 'frontend:ats:job_create' %}" class="flex flex-col items-center gap-3 p-6 rounded-lg bg-white duration-300 hover:shadow-lg">
                <div class="flex items-center justify-center w-16 h-16 rounded-full bg-gradient">
                    <span class="ph-fill ph-plus text-3xl text-white"></span>
                </div>
                <span class="text-button text-center">{% trans "Post New Job" %}</span>
            </a>

            <a href="{% url 'frontend:ats:candidate_list' %}" class="flex flex-col items-center gap-3 p-6 rounded-lg bg-white duration-300 hover:shadow-lg">
                <div class="flex items-center justify-center w-16 h-16 rounded-full bg-gradient">
                    <span class="ph-fill ph-users-three text-3xl text-white"></span>
                </div>
                <span class="text-button text-center">{% trans "View Candidates" %}</span>
            </a>

            <a href="{% url 'frontend:ats:pipeline_board' %}" class="flex flex-col items-center gap-3 p-6 rounded-lg bg-white duration-300 hover:shadow-lg">
                <div class="flex items-center justify-center w-16 h-16 rounded-full bg-gradient">
                    <span class="ph-fill ph-kanban text-3xl text-white"></span>
                </div>
                <span class="text-button text-center">{% trans "Pipeline" %}</span>
            </a>

            <a href="{% url 'frontend:hr:employee-directory' %}" class="flex flex-col items-center gap-3 p-6 rounded-lg bg-white duration-300 hover:shadow-lg">
                <div class="flex items-center justify-center w-16 h-16 rounded-full bg-gradient">
                    <span class="ph-fill ph-identification-card text-3xl text-white"></span>
                </div>
                <span class="text-button text-center">{% trans "Employees" %}</span>
            </a>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
<script>
    // Dashboard chart initialization
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize ApexCharts if available
        if (typeof ApexCharts !== 'undefined') {
            var options = {
                series: [{
                    name: 'Applications',
                    data: [31, 40, 28, 51, 42, 109, 100, 91, 125, 150, 130, 180]
                }],
                chart: {
                    type: 'area',
                    height: 350,
                    toolbar: {
                        show: false
                    }
                },
                dataLabels: {
                    enabled: false
                },
                stroke: {
                    curve: 'smooth',
                    width: 2
                },
                xaxis: {
                    categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
                },
                colors: ['#6366f1'],
                fill: {
                    type: 'gradient',
                    gradient: {
                        shadeIntensity: 1,
                        opacityFrom: 0.7,
                        opacityTo: 0.2,
                    }
                },
                tooltip: {
                    y: {
                        formatter: function (val) {
                            return val + " applications"
                        }
                    }
                }
            };

            var chart = new ApexCharts(document.querySelector("#chart-timeline"), options);
            chart.render();

            // Handle time filter buttons
            document.querySelectorAll('.button_time').forEach(button => {
                button.addEventListener('click', function() {
                    document.querySelectorAll('.button_time').forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    // Here you would update chart data based on selected time period
                });
            });
        }
    });
</script>
{% endblock %}
