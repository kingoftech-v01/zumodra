{% extends "base/freelanhub_dashboard_base.html" %}
{% load static i18n humanize %}

{% block title %}{% trans "My CVs" %} - Zumodra{% endblock %}

{% block dashboard_content %}
<!-- Breadcrumb -->
<div class="flex items-center gap-2 mb-6">
    <a href="{% url 'frontend:dashboard:index' %}" class="caption1 text-secondary hover:text-title">{% trans "Dashboard" %}</a>
    <i class="ph ph-caret-right caption1 text-secondary"></i>
    <span class="caption1 text-title">{% trans "My CVs" %}</span>
</div>

<!-- Page Header -->
<div class="flex items-center justify-between mb-7.5">
    <div>
        <h1 class="heading3 text-title mb-2">{% trans "My CVs" %}</h1>
        <p class="caption1 text-secondary">
            {% trans "Manage multiple CV versions tailored to different job types." %}
        </p>
    </div>
    <a href="{% url 'frontend:accounts:cv_create' %}"
       class="button-main flex items-center gap-2">
        <i class="ph ph-plus"></i>
        {% trans "Create New CV" %}
    </a>
</div>
<div class="space-y-6">
    <!-- Tips Banner -->
    <div class="bg-blue bg-opacity-10 border border-blue border-opacity-20 rounded-lg p-6">
        <div class="flex items-start gap-3">
            <i class="ph ph-info text-blue text-2xl flex-shrink-0"></i>
            <div>
                <h4 class="caption1 font-semibold text-blue mb-1">{% trans "Pro Tip: Multiple CVs Win Jobs" %}</h4>
                <p class="caption2 text-blue opacity-90">
                    {% trans "Candidates with tailored CVs for different roles get 40% more interviews. Create versions for each job type you're targeting." %}
                </p>
            </div>
        </div>
    </div>

    <!-- CV Grid -->
    {% if cvs %}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-7.5">
        {% for cv in cvs %}
        <div class="bg-white rounded-lg p-8 hover:shadow-md transition-shadow">
            <!-- CV Header -->
            <div class="mb-6">
                <div class="flex items-start justify-between mb-4">
                    <div class="flex items-center gap-2">
                        {% if cv.is_primary %}
                        <span class="tag bg-blue bg-opacity-10 text-blue">
                            {% trans "Primary" %}
                        </span>
                        {% endif %}
                        <span class="tag {% if cv.status == 'active' %}bg-green bg-opacity-10 text-green
                            {% elif cv.status == 'draft' %}bg-yellow bg-opacity-10 text-yellow
                            {% else %}bg-secondary bg-opacity-10 text-secondary{% endif %}">
                            {{ cv.get_status_display }}
                        </span>
                    </div>
                    <div class="relative" x-data="{ open: false }">
                        <button @click="open = !open" class="text-secondary hover:text-title">
                            <i class="ph ph-dots-three-vertical text-xl"></i>
                        </button>
                        <div x-show="open" @click.away="open = false" x-transition
                             class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-line z-10">
                            <a href="{% url 'frontend:accounts:cv_edit' cv.uuid %}"
                               class="block px-4 py-2 caption1 text-title hover:bg-surface">
                                <i class="ph ph-pencil-simple mr-2"></i>{% trans "Edit" %}
                            </a>
                            <a href="{% url 'frontend:accounts:cv_duplicate' cv.uuid %}"
                               class="block px-4 py-2 caption1 text-title hover:bg-surface">
                                <i class="ph ph-copy mr-2"></i>{% trans "Duplicate" %}
                            </a>
                            {% if not cv.is_primary %}
                            <button hx-post="{% url 'frontend:accounts:cv_set_primary' cv.uuid %}"
                                    hx-swap="none"
                                    hx-on::after-request="location.reload()"
                                    class="w-full text-left px-4 py-2 caption1 text-title hover:bg-surface">
                                <i class="ph ph-star mr-2"></i>{% trans "Set as Primary" %}
                            </button>
                            {% endif %}
                            <hr class="my-1 border-line">
                            <button hx-delete="{% url 'frontend:accounts:cv_delete' cv.uuid %}"
                                    hx-confirm="{% trans 'Delete this CV?' %}"
                                    hx-target="closest .bg-white"
                                    hx-swap="outerHTML"
                                    class="w-full text-left px-4 py-2 caption1 text-red hover:bg-red hover:bg-opacity-10">
                                <i class="ph ph-trash mr-2"></i>{% trans "Delete" %}
                            </button>
                        </div>
                    </div>
                </div>

                <!-- CV Name -->
                <h3 class="heading6 text-title mb-1">{{ cv.name }}</h3>
                {% if cv.headline %}
                <p class="caption1 text-secondary">{{ cv.headline|truncatewords:10 }}</p>
                {% endif %}

                <!-- Target Keywords -->
                {% if cv.target_job_types %}
                <div class="mt-3 flex flex-wrap gap-1">
                    {% for job_type in cv.target_job_types|slice:":3" %}
                    <span class="tag bg-secondary bg-opacity-10 text-secondary">
                        {{ job_type }}
                    </span>
                    {% endfor %}
                    {% if cv.target_job_types|length > 3 %}
                    <span class="caption2 text-secondary">+{{ cv.target_job_types|length|add:"-3" }}</span>
                    {% endif %}
                </div>
                {% endif %}

                <!-- Stats -->
                <div class="mt-6 grid grid-cols-3 gap-4 pt-4 border-t border-line">
                    <div class="text-center">
                        <p class="heading5 text-title">{{ cv.applications_count }}</p>
                        <p class="caption2 text-secondary">{% trans "Uses" %}</p>
                    </div>
                    <div class="text-center">
                        {% if cv.interview_rate %}
                        <p class="heading5 text-green">{{ cv.interview_rate }}%</p>
                        {% else %}
                        <p class="heading5 text-secondary">--</p>
                        {% endif %}
                        <p class="caption2 text-secondary">{% trans "Interview Rate" %}</p>
                    </div>
                    <div class="text-center">
                        {% if cv.ai_score %}
                        <p class="heading5 {% if cv.ai_score >= 80 %}text-green{% elif cv.ai_score >= 60 %}text-yellow{% else %}text-red{% endif %}">{{ cv.ai_score|floatformat:0 }}</p>
                        {% else %}
                        <p class="heading5 text-secondary">--</p>
                        {% endif %}
                        <p class="caption2 text-secondary">{% trans "AI Score" %}</p>
                    </div>
                </div>
            </div>

            <!-- CV Actions Footer -->
            <div class="px-6 py-3 bg-surface flex items-center justify-between">
                <a href="{% url 'frontend:accounts:cv_detail' cv.uuid %}"
                   class="caption1 font-semibold text-blue hover:underline">
                    {% trans "View Details" %}
                </a>
                <a href="{% url 'frontend:accounts:cv_feedback' cv.uuid %}"
                   class="caption1 text-secondary hover:text-title flex items-center gap-1">
                    <i class="ph ph-lightbulb"></i>
                    {% trans "Get Feedback" %}
                </a>
            </div>
        </div>
        {% endfor %}

        <!-- Add New CV Card -->
        <a href="{% url 'frontend:accounts:cv_create' %}"
           class="bg-surface border-2 border-dashed border-line rounded-lg p-8 flex flex-col items-center justify-center hover:border-blue hover:bg-blue hover:bg-opacity-5 transition-colors min-h-[240px]">
            <div class="w-12 h-12 rounded-full bg-surface flex items-center justify-center mb-3">
                <i class="ph ph-plus text-2xl text-secondary"></i>
            </div>
            <p class="caption1 font-semibold text-title">{% trans "Create New CV" %}</p>
            <p class="caption2 text-secondary mt-1">{% trans "Tailored for a specific role" %}</p>
        </a>
    </div>
    {% else %}
    <!-- Empty State -->
    <div class="bg-white rounded-lg p-12 text-center">
        <div class="mx-auto w-24 h-24 rounded-full bg-surface flex items-center justify-center mb-6">
            <i class="ph ph-file-text text-5xl text-secondary"></i>
        </div>
        <h3 class="heading5 text-title mb-2">{% trans "No CVs Yet" %}</h3>
        <p class="caption1 text-secondary mb-6 max-w-sm mx-auto">
            {% trans "Create your first CV to start applying to jobs. You can create multiple versions for different types of roles." %}
        </p>
        <a href="{% url 'frontend:accounts:cv_create' %}"
           class="button-main inline-flex items-center gap-2">
            <i class="ph ph-plus"></i>
            {% trans "Create Your First CV" %}
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}
