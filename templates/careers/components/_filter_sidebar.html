{% load static i18n %}

{# Universal Filter Sidebar Modal #}
{# Works with jobs, companies, and projects #}

<div id="filter_sidebar" class="filter_sidebar fixed top-0 left-0 w-full h-full bg-black bg-opacity-50 z-50 hidden">
    <div class="filter_sidebar_content absolute top-0 right-0 w-full md:w-[400px] h-full bg-white overflow-y-auto shadow-2xl transform translate-x-full transition-transform duration-300">
        <div class="filter_sidebar_header flex items-center justify-between p-6 border-b border-line">
            <h4 class="heading5">{% trans "Filters" %}</h4>
            <button id="close_filter_sidebar" class="text-2xl text-secondary hover:text-black">
                <span class="ph ph-x"></span>
            </button>
        </div>

        <form method="get" class="filter_sidebar_form p-6 space-y-6">
            {# Search Input #}
            {% if show_search %}
            <div class="filter_group">
                <label class="text-sm font-semibold text-title mb-2 block">{% trans "Search" %}</label>
                <input type="text" name="search" value="{{ search|default:'' }}"
                       class="w-full px-4 py-2 border border-line rounded-lg focus:border-primary focus:outline-none"
                       placeholder="{% trans 'Search...' %}">
            </div>
            {% endif %}

            {# Location Filter #}
            {% if locations %}
            <div class="filter_group">
                <label class="text-sm font-semibold text-title mb-2 block">{% trans "Location" %}</label>
                <select name="location" class="w-full px-4 py-2 border border-line rounded-lg focus:border-primary focus:outline-none">
                    <option value="">{% trans "All Locations" %}</option>
                    {% for location in locations %}
                    <option value="{{ location }}" {% if selected_location == location %}selected{% endif %}>{{ location }}</option>
                    {% endfor %}
                </select>
            </div>
            {% endif %}

            {# Category Filter (Jobs) #}
            {% if categories %}
            <div class="filter_group">
                <label class="text-sm font-semibold text-title mb-2 block">{% trans "Category" %}</label>
                <select name="category" class="w-full px-4 py-2 border border-line rounded-lg focus:border-primary focus:outline-none">
                    <option value="">{% trans "All Categories" %}</option>
                    {% for category in categories %}
                    <option value="{{ category.slug }}" {% if selected_category == category.slug %}selected{% endif %}>{{ category.name }}</option>
                    {% endfor %}
                </select>
            </div>
            {% endif %}

            {# Industry Filter (Companies) #}
            {% if industries %}
            <div class="filter_group">
                <label class="text-sm font-semibold text-title mb-2 block">{% trans "Industry" %}</label>
                <select name="industry" class="w-full px-4 py-2 border border-line rounded-lg focus:border-primary focus:outline-none">
                    <option value="">{% trans "All Industries" %}</option>
                    {% for industry in industries %}
                    <option value="{{ industry }}" {% if selected_industry == industry %}selected{% endif %}>{{ industry }}</option>
                    {% endfor %}
                </select>
            </div>
            {% endif %}

            {# Job Type Filter #}
            {% if job_types %}
            <div class="filter_group">
                <label class="text-sm font-semibold text-title mb-2 block">{% trans "Job Type" %}</label>
                <div class="space-y-2">
                    {% for value, label in job_types %}
                    <label class="flex items-center space-x-2 cursor-pointer">
                        <input type="checkbox" name="job_type" value="{{ value }}"
                               {% if selected_job_type == value %}checked{% endif %}
                               class="w-5 h-5 text-primary border-line rounded focus:ring-primary">
                        <span class="text-sm text-secondary">{{ label }}</span>
                    </label>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            {# Remote Filter #}
            {% if show_remote_filter %}
            <div class="filter_group">
                <label class="flex items-center space-x-2 cursor-pointer">
                    <input type="checkbox" name="remote" value="true"
                           {% if selected_remote %}checked{% endif %}
                           class="w-5 h-5 text-primary border-line rounded focus:ring-primary">
                    <span class="text-sm text-title font-semibold">{% trans "Remote Only" %}</span>
                </label>
            </div>
            {% endif %}

            {# Action Buttons #}
            <div class="filter_actions flex gap-3 pt-4 border-t border-line">
                <button type="button" id="clear_filters" class="flex-1 py-3 px-4 border border-line rounded-lg text-secondary hover:bg-surface">
                    {% trans "Clear All" %}
                </button>
                <button type="submit" class="flex-1 py-3 px-4 bg-primary text-white rounded-lg hover:bg-primary-dark">
                    {% trans "Apply Filters" %}
                </button>
            </div>
        </form>
    </div>
</div>

<script>
// Filter Sidebar Toggle
document.addEventListener('DOMContentLoaded', function() {
    const filterBtn = document.getElementById('filter_btn');
    const filterSidebar = document.getElementById('filter_sidebar');
    const closeBtn = document.getElementById('close_filter_sidebar');
    const sidebarContent = filterSidebar.querySelector('.filter_sidebar_content');
    const clearFiltersBtn = document.getElementById('clear_filters');

    // Open sidebar
    if (filterBtn) {
        filterBtn.addEventListener('click', function() {
            filterSidebar.classList.remove('hidden');
            setTimeout(() => {
                sidebarContent.classList.remove('translate-x-full');
            }, 10);
        });
    }

    // Close sidebar
    function closeSidebar() {
        sidebarContent.classList.add('translate-x-full');
        setTimeout(() => {
            filterSidebar.classList.add('hidden');
        }, 300);
    }

    if (closeBtn) {
        closeBtn.addEventListener('click', closeSidebar);
    }

    // Close on background click
    filterSidebar.addEventListener('click', function(e) {
        if (e.target === filterSidebar) {
            closeSidebar();
        }
    });

    // Close on escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && !filterSidebar.classList.contains('hidden')) {
            closeSidebar();
        }
    });

    // Clear all filters
    if (clearFiltersBtn) {
        clearFiltersBtn.addEventListener('click', function() {
            window.location.href = window.location.pathname;
        });
    }
});
</script>
