{% extends "base/freelanhub_base.html" %}
{% load static i18n %}

{% block title %}{% trans "Browse Jobs" %} - Zumodra{% endblock %}

{% block meta_description %}{{ meta_description }}{% endblock %}

{% block content %}

<!-- Breadcrumb -->
<section class="breadcrumb">
    <div class="breadcrumb_inner relative sm:mt-20 mt-16 lg:py-20 py-14">
        <div class="breadcrumb_bg absolute top-0 left-0 w-full h-full bg-primary"></div>
        <div class="container relative h-full">
            <div class="breadcrumb_content flex flex-col items-start justify-center xl:w-[1000px] lg:w-[848px] md:w-5/6 w-full h-full">
                <div class="list_breadcrumb flex items-center gap-2 animate animate_top" style="--i: 1">
                    <a href="{% url 'home' %}" class="caption1 text-white">{% trans "Home" %}</a>
                    <span class="caption1 text-white opacity-40">/</span>
                    <span class="caption1 text-white opacity-60">{% trans "Browse Jobs" %}</span>
                </div>
                <h3 class="heading3 text-white mt-2 animate animate_top" style="--i: 2">
                    {% trans "Find Your Next Opportunity" %}
                </h3>
                <p class="text-white opacity-90 mt-2 animate animate_top" style="--i: 3">
                    {% blocktrans count counter=total_jobs %}{{ counter }} job available{% plural %}{{ counter }} jobs available{% endblocktrans %}
                </p>
            </div>
        </div>
    </div>
</section>

<!-- Search and Filters -->
<section class="jobs-section lg:py-20 sm:py-14 py-10">
    <div class="container">
        <div class="lg:grid lg:grid-cols-4 lg:gap-8">
            <!-- Filters Sidebar -->
            <aside class="lg:col-span-1 mb-8 lg:mb-0">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h4 class="font-semibold text-lg mb-4">{% trans "Filters" %}</h4>

                    <form method="GET" class="space-y-6">
                        <!-- Search -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                {% trans "Search" %}
                            </label>
                            <input type="text" name="search" value="{{ search }}"
                                   placeholder="{% trans 'Job title, keywords...' %}"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-primary">
                        </div>

                        <!-- Category -->
                        {% if categories %}
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                {% trans "Category" %}
                            </label>
                            <select name="category" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-primary">
                                <option value="">{% trans "All Categories" %}</option>
                                {% for cat in categories %}
                                <option value="{{ cat.slug }}" {% if selected_category == cat.slug %}selected{% endif %}>
                                    {{ cat.name }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        {% endif %}

                        <!-- Job Type -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                {% trans "Job Type" %}
                            </label>
                            <select name="job_type" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-primary">
                                <option value="">{% trans "All Types" %}</option>
                                {% for value, label in job_types %}
                                <option value="{{ value }}" {% if selected_job_type == value %}selected{% endif %}>
                                    {{ label }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- Location -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                {% trans "Location" %}
                            </label>
                            <input type="text" name="location" value="{{ selected_location }}"
                                   placeholder="{% trans 'City or Country' %}"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-primary">
                        </div>

                        <!-- Remote -->
                        <div class="flex items-center gap-2">
                            <input type="checkbox" name="remote" value="true" id="remote"
                                   {% if selected_remote == 'true' %}checked{% endif %}
                                   class="w-4 h-4 text-primary border-gray-300 rounded focus:ring-primary">
                            <label for="remote" class="text-sm text-gray-700">
                                {% trans "Remote work only" %}
                            </label>
                        </div>

                        <!-- Filter Button -->
                        <button type="submit" class="w-full px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition">
                            {% trans "Apply Filters" %}
                        </button>

                        <!-- Clear Filters -->
                        <a href="{% url 'careers:home' %}" class="block text-center text-sm text-gray-600 hover:text-primary">
                            {% trans "Clear all filters" %}
                        </a>
                    </form>
                </div>
            </aside>

            <!-- Jobs List -->
            <div class="lg:col-span-3">
                {% if jobs %}
                <div class="space-y-4">
                    {% for job in jobs %}
                    <div class="job-card bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow duration-300">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <!-- Job Title -->
                                <h3 class="text-xl font-semibold text-gray-900 mb-2">
                                    {{ job.title }}
                                </h3>

                                <!-- Company -->
                                {% if job.tenant %}
                                <p class="text-gray-600 mb-3 flex items-center gap-2">
                                    <i class="ph ph-buildings text-gray-400"></i>
                                    {{ job.tenant.name }}
                                </p>
                                {% endif %}

                                <!-- Job Details -->
                                <div class="flex flex-wrap gap-4 text-sm text-gray-600 mb-4">
                                    <!-- Location -->
                                    {% if job.location_city %}
                                    <span class="flex items-center gap-1">
                                        <i class="ph ph-map-pin text-gray-400"></i>
                                        {{ job.location_city }}{% if job.location_country %}, {{ job.location_country }}{% endif %}
                                    </span>
                                    {% endif %}

                                    <!-- Job Type -->
                                    <span class="flex items-center gap-1">
                                        <i class="ph ph-briefcase text-gray-400"></i>
                                        {{ job.get_job_type_display }}
                                    </span>

                                    <!-- Remote -->
                                    {% if job.remote_policy != 'on_site' %}
                                    <span class="flex items-center gap-1">
                                        <i class="ph ph-laptop text-gray-400"></i>
                                        {{ job.get_remote_policy_display }}
                                    </span>
                                    {% endif %}

                                    <!-- Salary -->
                                    {% if job.salary_min %}
                                    <span class="flex items-center gap-1">
                                        <i class="ph ph-currency-dollar text-gray-400"></i>
                                        ${{ job.salary_min|floatformat:0 }}{% if job.salary_max %} - ${{ job.salary_max|floatformat:0 }}{% endif %}
                                    </span>
                                    {% endif %}
                                </div>

                                <!-- Description Preview -->
                                {% if job.description %}
                                <p class="text-gray-700 mb-4 line-clamp-2">
                                    {{ job.description|striptags|truncatewords:30 }}
                                </p>
                                {% endif %}

                                <!-- Skills/Tags -->
                                {% if job.required_skills %}
                                <div class="flex flex-wrap gap-2 mb-4">
                                    {% for skill in job.required_skills|slice:":5" %}
                                    <span class="px-3 py-1 bg-primary/10 text-primary text-sm rounded-full">
                                        {{ skill|title }}
                                    </span>
                                    {% endfor %}
                                    {% if job.required_skills|length > 5 %}
                                    <span class="px-3 py-1 bg-gray-100 text-gray-600 text-sm rounded-full">
                                        +{{ job.required_skills|length|add:"-5" }} more
                                    </span>
                                    {% endif %}
                                </div>
                                {% endif %}
                            </div>

                            <!-- Posted Date -->
                            <div class="text-sm text-gray-500 ml-4">
                                {{ job.published_at|timesince }} {% trans "ago" %}
                            </div>
                        </div>

                        <!-- Actions -->
                        <div class="flex gap-3 mt-4 pt-4 border-t border-gray-100">
                            <a href="{% url 'frontend:ats:job_detail' job.job_uuid %}"
                               class="flex-1 px-4 py-2 bg-primary text-white text-center rounded-lg hover:bg-primary/90 transition">
                                {% trans "View Details & Apply" %}
                            </a>
                            <button class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition">
                                <i class="ph ph-bookmark text-gray-600"></i>
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                </div>

                <!-- Pagination -->
                {% if jobs.has_other_pages %}
                <div class="pagination flex justify-center gap-2 mt-10">
                    {% if jobs.has_previous %}
                    <a href="?page={{ jobs.previous_page_number }}{% if search %}&search={{ search }}{% endif %}{% if selected_category %}&category={{ selected_category }}{% endif %}{% if selected_location %}&location={{ selected_location }}{% endif %}{% if selected_job_type %}&job_type={{ selected_job_type }}{% endif %}{% if selected_remote %}&remote={{ selected_remote }}{% endif %}"
                       class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                        {% trans "Previous" %}
                    </a>
                    {% endif %}

                    <span class="px-4 py-2 border border-primary bg-primary/10 rounded-lg">
                        {% trans "Page" %} {{ jobs.number }} {% trans "of" %} {{ jobs.paginator.num_pages }}
                    </span>

                    {% if jobs.has_next %}
                    <a href="?page={{ jobs.next_page_number }}{% if search %}&search={{ search }}{% endif %}{% if selected_category %}&category={{ selected_category }}{% endif %}{% if selected_location %}&location={{ selected_location }}{% endif %}{% if selected_job_type %}&job_type={{ selected_job_type }}{% endif %}{% if selected_remote %}&remote={{ selected_remote }}{% endif %}"
                       class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                        {% trans "Next" %}
                    </a>
                    {% endif %}
                </div>
                {% endif %}

                {% else %}
                <!-- No Jobs Found -->
                <div class="text-center py-16">
                    <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="ph ph-briefcase text-4xl text-gray-400"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">
                        {% trans "No Jobs Found" %}
                    </h3>
                    <p class="text-gray-600">
                        {% if search or selected_category or selected_location or selected_job_type or selected_remote %}
                        {% trans "Try adjusting your filters to see more results." %}
                        {% else %}
                        {% trans "There are currently no open positions. Check back later!" %}
                        {% endif %}
                    </p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>

{% endblock %}
