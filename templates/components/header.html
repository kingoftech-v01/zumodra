{% load static i18n %}

{% comment %} ============================================================================
   ZUMODRA PREMIUM HEADER
   ============================================================================
   Features:
   - Premium glassmorphism with saturated blur
   - Unified icon system (1.5 stroke weight)
   - Smooth dark mode toggle
   - Global search with HTMX
   - User dropdown with elegant animations
   ============================================================================ {% endcomment %}

<!-- Header with Premium Glassmorphism -->
<header class="zu-header">
    <div class="zu-header__inner">
        <!-- Left: Mobile menu button & Search -->
        <div class="flex items-center gap-4">
            <!-- Mobile menu button -->
            <button @click="mobileMenuOpen = !mobileMenuOpen"
                    class="zu-btn--icon-sm lg:hidden"
                    aria-label="Open menu">
                <svg class="zu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"/>
                </svg>
            </button>

            <!-- Global Search -->
            <div class="hidden sm:block relative" x-data="{ searchOpen: false, query: '', results: [] }">
                <div class="zu-search">
                    <svg class="zu-search__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                    </svg>
                    <input type="text"
                           id="global-search"
                           x-model="query"
                           @focus="searchOpen = true"
                           @blur="setTimeout(() => searchOpen = false, 200)"
                           @keyup.escape="searchOpen = false"
                           hx-get="{% url 'dashboard:search' %}"
                           hx-trigger="keyup changed delay:300ms"
                           hx-target="#search-results"
                           hx-vals='js:{q: document.getElementById("global-search").value}'
                           name="q"
                           class="zu-search__input"
                           placeholder="{% trans 'Search... (Ctrl+K)' %}">
                    <!-- Loading indicator -->
                    <div class="htmx-indicator zu-search__loading">
                        <svg class="animate-spin" width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    </div>
                </div>

                <!-- Search Results Dropdown -->
                <div id="search-results"
                     x-show="searchOpen && query.length > 0"
                     x-transition:enter="transition ease-out duration-100"
                     x-transition:enter-start="opacity-0 scale-95 -translate-y-1"
                     x-transition:enter-end="opacity-100 scale-100 translate-y-0"
                     x-transition:leave="transition ease-in duration-75"
                     x-transition:leave-start="opacity-100 scale-100"
                     x-transition:leave-end="opacity-0 scale-95"
                     class="zu-search-results"
                     x-cloak>
                    <!-- Results populated by HTMX -->
                </div>
            </div>
        </div>

        <!-- Right: Actions -->
        <div class="flex items-center gap-3">
            <!-- Quick Actions -->
            <div class="hidden md:flex items-center gap-2">
                <a href="{% url 'ats:job_create' %}" class="zu-btn zu-btn--primary zu-btn--sm">
                    <svg class="zu-btn__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 5v14m-7-7h14"/>
                    </svg>
                    <span>{% trans "Post Job" %}</span>
                </a>
            </div>

            <!-- Dark Mode Toggle -->
            <button @click="darkMode = !darkMode"
                    class="zu-btn--icon-sm zu-theme-toggle"
                    aria-label="Toggle dark mode">
                <svg x-show="!darkMode" class="zu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/>
                </svg>
                <svg x-show="darkMode" x-cloak class="zu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <circle cx="12" cy="12" r="5"/>
                    <line x1="12" y1="1" x2="12" y2="3"/>
                    <line x1="12" y1="21" x2="12" y2="23"/>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                    <line x1="1" y1="12" x2="3" y2="12"/>
                    <line x1="21" y1="12" x2="23" y2="12"/>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                </svg>
            </button>

            <!-- Notifications -->
            {% include "components/notification_dropdown.html" %}

            <!-- User Menu -->
            <div class="relative" x-data="{ open: false }">
                <button @click="open = !open"
                        @click.away="open = false"
                        class="zu-user-menu-trigger"
                        aria-expanded="false"
                        aria-haspopup="true">
                    {% if user.profile_picture %}
                    <img class="zu-avatar zu-avatar--sm" src="{{ user.profile_picture.url }}" alt="{{ user.get_full_name }}">
                    {% else %}
                    <div class="zu-avatar zu-avatar--sm zu-avatar--initials">
                        <span>{{ user.first_name|slice:":1" }}{{ user.last_name|slice:":1" }}</span>
                    </div>
                    {% endif %}
                    <svg class="hidden md:block zu-icon--sm text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/>
                    </svg>
                </button>

                <!-- User Dropdown Menu -->
                <div x-show="open"
                     x-transition:enter="transition ease-out duration-150"
                     x-transition:enter-start="opacity-0 scale-95 -translate-y-1"
                     x-transition:enter-end="opacity-100 scale-100 translate-y-0"
                     x-transition:leave="transition ease-in duration-100"
                     x-transition:leave-start="opacity-100 scale-100"
                     x-transition:leave-end="opacity-0 scale-95"
                     class="zu-dropdown zu-dropdown--right"
                     role="menu"
                     aria-orientation="vertical"
                     x-cloak>
                    <!-- User Info -->
                    <div class="zu-dropdown__header">
                        <p class="zu-dropdown__title">{{ user.get_full_name|default:user.email }}</p>
                        <p class="zu-dropdown__subtitle">{{ user.email }}</p>
                    </div>

                    <!-- Menu Items -->
                    <div class="zu-dropdown__body">
                        <a href="{% url 'dashboard:profile' %}" class="zu-dropdown__item" role="menuitem">
                            <svg class="zu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                            </svg>
                            {% trans "Your Profile" %}
                        </a>
                        <a href="{% url 'dashboard:account_settings' %}" class="zu-dropdown__item" role="menuitem">
                            <svg class="zu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                            </svg>
                            {% trans "Settings" %}
                        </a>
                        <a href="{% url 'dashboard:help' %}" class="zu-dropdown__item" role="menuitem">
                            <svg class="zu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            {% trans "Help & Support" %}
                        </a>
                    </div>

                    <!-- Sign Out -->
                    <div class="zu-dropdown__footer">
                        <a href="{% url 'account_logout' %}" class="zu-dropdown__item zu-dropdown__item--danger" role="menuitem">
                            <svg class="zu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                            </svg>
                            {% trans "Sign out" %}
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
