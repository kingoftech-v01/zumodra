{% load i18n %}
{% comment %} Trust Badge Component
Usage: {% include "components/trust_badge.html" with trust_score=user.trust_score size="sm"|"md"|"lg" show_details=True|False %}

Parameters:
- trust_score: TrustScore object (or None for new users)
- size: "sm" (inline), "md" (card small), "lg" (card full)
- show_details: Show breakdown of verification status
- link: Optional URL to link badge to trust score page {% endcomment %}

{% with size=size|default:"md" show_details=show_details|default:False %}

{% if size == "sm" %}
{% comment %} Inline badge for lists and cards {% endcomment %}
<div class="inline-flex items-center gap-1.5">
    {% if trust_score %}
    <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium
        {% if trust_score.trust_level == 'PREMIUM' %}bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300
        {% elif trust_score.trust_level == 'HIGH' %}bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300
        {% elif trust_score.trust_level == 'VERIFIED' %}bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300
        {% elif trust_score.trust_level == 'BASIC' %}bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300
        {% else %}bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400{% endif %}">
        {% if trust_score.trust_level == 'PREMIUM' %}
        <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
        {% elif trust_score.is_id_verified or trust_score.is_career_verified %}
        <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
        {% endif %}
        {{ trust_score.get_trust_level_display }}
    </span>
    {% if trust_score.is_id_verified %}
    <span class="inline-flex items-center" title="{% trans 'ID Verified' %}">
        <svg class="w-4 h-4 text-green-500" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
        </svg>
    </span>
    {% endif %}
    {% if trust_score.is_career_verified %}
    <span class="inline-flex items-center" title="{% trans 'Career Verified' %}">
        <svg class="w-4 h-4 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
            <path d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.838L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.838l-7-3zM3.31 9.397L5 10.12v4.102a8.969 8.969 0 00-1.05-.174 1 1 0 01-.89-.89 11.115 11.115 0 01.25-3.762zM9.3 16.573A9.026 9.026 0 007 14.935v-3.957l1.818.78a3 3 0 002.364 0l5.508-2.361a11.026 11.026 0 01.25 3.762 1 1 0 01-.89.89 8.968 8.968 0 00-5.35 2.524 1 1 0 01-1.4 0z"/>
        </svg>
    </span>
    {% endif %}
    {% else %}
    <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400">
        {% trans "New" %}
    </span>
    {% endif %}
</div>

{% elif size == "md" %}
{% comment %} Medium card for profiles and sidebars {% endcomment %}
<div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4">
    <div class="flex items-center justify-between mb-3">
        <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">{% trans "Trust Score" %}</h4>
        {% if link %}
        <a href="{{ link }}" class="text-xs text-primary-600 hover:text-primary-700 dark:text-primary-400">{% trans "Details" %}</a>
        {% endif %}
    </div>

    {% if trust_score %}
    <div class="flex items-center gap-3">
        <div class="relative">
            <svg class="w-14 h-14 transform -rotate-90">
                <circle cx="28" cy="28" r="24" stroke="currentColor" stroke-width="4" fill="none" class="text-gray-200 dark:text-gray-700"/>
                <circle cx="28" cy="28" r="24" stroke="currentColor" stroke-width="4" fill="none"
                        stroke-dasharray="{{ trust_score.overall_score|floatformat:0|add:'50' }} 150.79"
                        class="{% if trust_score.overall_score >= 80 %}text-green-500{% elif trust_score.overall_score >= 60 %}text-blue-500{% elif trust_score.overall_score >= 40 %}text-yellow-500{% else %}text-gray-400{% endif %}"/>
            </svg>
            <span class="absolute inset-0 flex items-center justify-center text-lg font-bold text-gray-900 dark:text-white">
                {{ trust_score.overall_score|floatformat:0 }}
            </span>
        </div>
        <div class="flex-1">
            <p class="font-medium text-gray-900 dark:text-white">{{ trust_score.get_trust_level_display }}</p>
            <div class="flex flex-wrap gap-1 mt-1">
                {% if trust_score.is_id_verified %}
                <span class="inline-flex items-center px-1.5 py-0.5 rounded text-xs bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300">
                    <svg class="w-3 h-3 mr-0.5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                    {% trans "ID" %}
                </span>
                {% endif %}
                {% if trust_score.is_career_verified %}
                <span class="inline-flex items-center px-1.5 py-0.5 rounded text-xs bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300">
                    <svg class="w-3 h-3 mr-0.5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                    {% trans "Career" %}
                </span>
                {% endif %}
                {% if trust_score.average_rating %}
                <span class="inline-flex items-center px-1.5 py-0.5 rounded text-xs bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-300">
                    <svg class="w-3 h-3 mr-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                    {{ trust_score.average_rating|floatformat:1 }}
                </span>
                {% endif %}
            </div>
        </div>
    </div>
    {% else %}
    <div class="text-center py-2">
        <p class="text-sm text-gray-500 dark:text-gray-400">{% trans "New user - building trust" %}</p>
    </div>
    {% endif %}
</div>

{% else %}
{% comment %} Large card with full details {% endcomment %}
<div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
    <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">{% trans "Trust & Verification" %}</h3>
        {% if link %}
        <a href="{{ link }}" class="text-sm text-primary-600 hover:text-primary-700 dark:text-primary-400">{% trans "View Details" %} &rarr;</a>
        {% endif %}
    </div>

    {% if trust_score %}
    <div class="flex items-start gap-6">
        {% comment %} Score Circle {% endcomment %}
        <div class="flex-shrink-0">
            <div class="relative w-24 h-24">
                <svg class="w-24 h-24 transform -rotate-90">
                    <circle cx="48" cy="48" r="40" stroke="currentColor" stroke-width="6" fill="none" class="text-gray-200 dark:text-gray-700"/>
                    <circle cx="48" cy="48" r="40" stroke="currentColor" stroke-width="6" fill="none"
                            stroke-dasharray="{{ trust_score.overall_score|floatformat:0|add:'150' }} 251.32"
                            class="{% if trust_score.overall_score >= 80 %}text-green-500{% elif trust_score.overall_score >= 60 %}text-blue-500{% elif trust_score.overall_score >= 40 %}text-yellow-500{% else %}text-gray-400{% endif %}"/>
                </svg>
                <div class="absolute inset-0 flex flex-col items-center justify-center">
                    <span class="text-2xl font-bold text-gray-900 dark:text-white">{{ trust_score.overall_score|floatformat:0 }}</span>
                    <span class="text-xs text-gray-500 dark:text-gray-400">/100</span>
                </div>
            </div>
        </div>

        {% comment %} Details {% endcomment %}
        <div class="flex-1">
            <div class="flex items-center gap-2 mb-3">
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium
                    {% if trust_score.trust_level == 'PREMIUM' %}bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300
                    {% elif trust_score.trust_level == 'HIGH' %}bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300
                    {% elif trust_score.trust_level == 'VERIFIED' %}bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300
                    {% elif trust_score.trust_level == 'BASIC' %}bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300
                    {% else %}bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400{% endif %}">
                    {{ trust_score.get_trust_level_display }}
                </span>
            </div>

            {% comment %} Verification Badges {% endcomment %}
            <div class="grid grid-cols-2 gap-2 mb-4">
                <div class="flex items-center gap-2 p-2 rounded-lg {% if trust_score.is_id_verified %}bg-green-50 dark:bg-green-900/20{% else %}bg-gray-50 dark:bg-gray-700/50{% endif %}">
                    {% if trust_score.is_id_verified %}
                    <svg class="w-5 h-5 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                    {% else %}
                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke-width="2"/></svg>
                    {% endif %}
                    <span class="text-sm {% if trust_score.is_id_verified %}text-green-700 dark:text-green-300{% else %}text-gray-500 dark:text-gray-400{% endif %}">{% trans "ID Verified" %}</span>
                </div>
                <div class="flex items-center gap-2 p-2 rounded-lg {% if trust_score.is_career_verified %}bg-blue-50 dark:bg-blue-900/20{% else %}bg-gray-50 dark:bg-gray-700/50{% endif %}">
                    {% if trust_score.is_career_verified %}
                    <svg class="w-5 h-5 text-blue-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                    {% else %}
                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke-width="2"/></svg>
                    {% endif %}
                    <span class="text-sm {% if trust_score.is_career_verified %}text-blue-700 dark:text-blue-300{% else %}text-gray-500 dark:text-gray-400{% endif %}">{% trans "Career Verified" %}</span>
                </div>
            </div>

            {% if show_details %}
            {% comment %} Score Breakdown {% endcomment %}
            <div class="space-y-2">
                <div class="flex items-center justify-between text-sm">
                    <span class="text-gray-600 dark:text-gray-400">{% trans "Reviews" %}</span>
                    <div class="flex items-center gap-2">
                        {% if trust_score.average_rating %}
                        <div class="flex items-center">
                            {% for i in "12345" %}
                            <svg class="w-4 h-4 {% if forloop.counter <= trust_score.average_rating %}text-yellow-400{% else %}text-gray-300 dark:text-gray-600{% endif %}" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                            </svg>
                            {% endfor %}
                        </div>
                        <span class="text-gray-900 dark:text-white font-medium">{{ trust_score.average_rating|floatformat:1 }}</span>
                        <span class="text-gray-500 dark:text-gray-400">({{ trust_score.total_reviews }})</span>
                        {% else %}
                        <span class="text-gray-500 dark:text-gray-400">{% trans "No reviews yet" %}</span>
                        {% endif %}
                    </div>
                </div>
                <div class="flex items-center justify-between text-sm">
                    <span class="text-gray-600 dark:text-gray-400">{% trans "Completed" %}</span>
                    <span class="text-gray-900 dark:text-white font-medium">{{ trust_score.completed_jobs|default:0 }} {% trans "jobs" %}</span>
                </div>
                {% if trust_score.total_disputes > 0 %}
                <div class="flex items-center justify-between text-sm">
                    <span class="text-gray-600 dark:text-gray-400">{% trans "Disputes" %}</span>
                    <span class="text-gray-900 dark:text-white font-medium">{{ trust_score.disputes_won }}/{{ trust_score.total_disputes }} {% trans "resolved favorably" %}</span>
                </div>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>
    {% else %}
    <div class="text-center py-6">
        <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center">
            <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
            </svg>
        </div>
        <p class="text-gray-900 dark:text-white font-medium">{% trans "New User" %}</p>
        <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">{% trans "This user is new to the platform and is building their trust score." %}</p>
    </div>
    {% endif %}
</div>
{% endif %}

{% endwith %}
