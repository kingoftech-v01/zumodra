{% load static i18n humanize %}

{% comment %} Single Candidate Row Partial for HTMX table updates

    Usage: {% include "partials/_candidate_row.html" with candidate=candidate %} {% endcomment %}

<tr class="zu-table__row">
    <td class="zu-table__td relative w-12 px-6 sm:w-16 sm:px-8">
        <input type="checkbox"
               value="{{ candidate.id }}"
               class="absolute left-4 top-1/2 -mt-2 h-4 w-4 rounded border-gray-300 dark:border-gray-600 text-primary-600 focus:ring-primary-500 dark:bg-gray-700">
    </td>
    <td class="zu-table__td">
        <div class="flex items-center">
            {% if candidate.photo %}
            <img class="zu-avatar zu-avatar--sm" src="{{ candidate.photo.url }}" alt="{{ candidate.full_name }}">
            {% else %}
            <div class="zu-avatar zu-avatar--sm bg-primary-600 flex items-center justify-center">
                <span class="text-white font-medium text-sm">{{ candidate.first_name|slice:":1" }}{{ candidate.last_name|slice:":1" }}</span>
            </div>
            {% endif %}
            <div class="ml-4">
                <div class="flex items-center gap-1.5">
                    <a href="{% url 'frontend:ats:candidate_detail' candidate.id %}"
                       class="text-sm font-medium text-gray-900 dark:text-white hover:text-primary-600 dark:hover:text-primary-400">
                        {{ candidate.full_name }}
                    </a>
                    {% if candidate.user and candidate.user.trust_score %}
                    {% include "components/trust_badge.html" with trust_score=candidate.user.trust_score size="sm" %}
                    {% endif %}
                </div>
                <p class="text-sm text-gray-500 dark:text-gray-400">{{ candidate.email }}</p>
            </div>
        </div>
    </td>
    <td class="zu-table__td whitespace-nowrap">
        <div class="text-sm text-gray-900 dark:text-white">{{ candidate.current_title|default:"N/A" }}</div>
        {% if candidate.current_company %}
        <div class="text-sm text-gray-500 dark:text-gray-400">{{ candidate.current_company }}</div>
        {% endif %}
    </td>
    <td class="zu-table__td">
        <div class="flex flex-wrap gap-1">
            {% for skill in candidate.skills.all|slice:":3" %}
            <span class="zu-badge zu-badge--primary">
                {{ skill.name }}
            </span>
            {% endfor %}
            {% if candidate.skills.count > 3 %}
            <span class="zu-badge zu-badge--neutral">
                +{{ candidate.skills.count|add:"-3" }}
            </span>
            {% endif %}
        </div>
    </td>
    <td class="zu-table__td whitespace-nowrap">
        {% if candidate.source == 'linkedin' %}
        <span class="inline-flex items-center text-sm text-gray-500 dark:text-gray-400">
            <svg class="zu-icon--sm mr-1 text-blue-600" fill="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/>
            </svg>
            LinkedIn
        </span>
        {% elif candidate.source == 'referral' %}
        <span class="inline-flex items-center text-sm text-gray-500 dark:text-gray-400">
            <svg class="zu-icon--sm mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
            </svg>
            Referral
        </span>
        {% else %}
        <span class="text-sm text-gray-500 dark:text-gray-400">{{ candidate.source|default:"Direct" }}</span>
        {% endif %}
    </td>
    <td class="zu-table__td whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
        {{ candidate.created_at|naturaltime }}
    </td>
    <td class="zu-table__td whitespace-nowrap text-right text-sm font-medium">
        <div class="flex items-center justify-end space-x-2">
            <a href="{% url 'frontend:ats:candidate_detail' candidate.id %}"
               class="zu-btn zu-btn--icon-sm text-primary-600 hover:text-primary-900 dark:text-primary-400 dark:hover:text-primary-300"
               title="{% trans 'View Profile' %}">
                <svg class="zu-icon--sm" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                </svg>
            </a>
            <button hx-get="{% url 'frontend:ats:candidate_add_to_job' candidate.id %}"
                    hx-target="#modal-container"
                    hx-swap="innerHTML"
                    class="zu-btn zu-btn--icon-sm text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"
                    title="{% trans 'Add to Job' %}">
                <svg class="zu-icon--sm" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
            </button>
            <a href="mailto:{{ candidate.email }}"
               class="zu-btn zu-btn--icon-sm text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"
               title="{% trans 'Send Email' %}">
                <svg class="zu-icon--sm" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                </svg>
            </a>
        </div>
    </td>
</tr>
