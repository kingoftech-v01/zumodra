{% extends "base/freelanhub_dashboard_base.html" %}
{% load static i18n humanize %}

{% block page_title %}{% trans "Employees" %}{% endblock %}

{% block dashboard_content %}
<!-- Breadcrumb -->
<div class="flex items-center gap-2 mb-6">
    <a href="{% url 'frontend:dashboard:index' %}" class="caption1 text-secondary hover:text-primary">
        <span class="ph ph-house"></span>
    </a>
    <span class="ph ph-caret-right text-secondary"></span>
    <span class="caption1 text-title">{% trans "Employees" %}</span>
</div>

{% if request.tenant.tenant_type != 'company' %}
<div class="p-6 rounded-lg bg-yellow-500 bg-opacity-10 border border-yellow-500">
    <div class="flex items-center gap-3">
        <span class="ph ph-warning text-xl text-yellow-500"></span>
        <p class="caption1 text-yellow-700">
            {% trans "HR features are only available for company tenants." %}
            <a href="{% url 'tenants:tenant_settings' %}" class="font-medium underline hover:text-yellow-900">
                {% trans "Switch to company account" %}
            </a>
        </p>
    </div>
</div>
{% else %}

<!-- Page Header -->
<div class="flex flex-wrap items-center justify-between gap-4 mb-7.5">
    <h4 class="heading4">{% trans "Employee Directory" %}</h4>
    <a href="{% url 'frontend:hr:employee-create' %}" class="button-main">
        <span class="ph ph-user-plus text-xl mr-2"></span>
        {% trans "Add Employee" %}
    </a>
</div>

<!-- Stats Cards -->
<div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-7.5" x-data="{ viewMode: 'grid' }">
    <div class="p-6 rounded-lg bg-white">
        <div class="flex items-center gap-4">
            <div class="w-12 h-12 rounded-lg bg-blue-500 bg-opacity-10 flex items-center justify-center">
                <span class="ph ph-users text-2xl text-blue-500"></span>
            </div>
            <div>
                <p class="caption2 text-secondary">{% trans "Total Employees" %}</p>
                <p class="heading5 mt-1">{{ total_employees }}</p>
            </div>
        </div>
    </div>
    <div class="p-6 rounded-lg bg-white">
        <div class="flex items-center gap-4">
            <div class="w-12 h-12 rounded-lg bg-green-500 bg-opacity-10 flex items-center justify-center">
                <span class="ph ph-chart-line text-2xl text-green-500"></span>
            </div>
            <div>
                <p class="caption2 text-secondary">{% trans "Active Today" %}</p>
                <p class="heading5 mt-1">{{ active_today }}</p>
            </div>
        </div>
    </div>
    <div class="p-6 rounded-lg bg-white">
        <div class="flex items-center gap-4">
            <div class="w-12 h-12 rounded-lg bg-yellow-500 bg-opacity-10 flex items-center justify-center">
                <span class="ph ph-clock text-2xl text-yellow-500"></span>
            </div>
            <div>
                <p class="caption2 text-secondary">{% trans "On Leave" %}</p>
                <p class="heading5 mt-1">{{ on_leave }}</p>
            </div>
        </div>
    </div>
    <div class="p-6 rounded-lg bg-white">
        <div class="flex items-center gap-4">
            <div class="w-12 h-12 rounded-lg bg-purple-500 bg-opacity-10 flex items-center justify-center">
                <span class="ph ph-user-circle-plus text-2xl text-purple-500"></span>
            </div>
            <div>
                <p class="caption2 text-secondary">{% trans "New This Month" %}</p>
                <p class="heading5 mt-1">{{ new_this_month }}</p>
            </div>
        </div>
    </div>

    <!-- Search and Filters -->
    <div class="col-span-full p-6 rounded-lg bg-white">
        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
            <!-- Search -->
            <div class="relative flex-1 max-w-md">
                <input type="text"
                       name="search"
                       hx-get="{% url 'frontend:hr:employee-directory' %}"
                       hx-trigger="keyup changed delay:300ms"
                       hx-target="#employees-container"
                       hx-swap="innerHTML"
                       class="w-full h-12 pl-12 pr-4 border border-line rounded-lg"
                       placeholder="{% trans 'Search employees...' %}">
                <span class="ph ph-magnifying-glass text-xl absolute top-1/2 -translate-y-1/2 left-4 text-secondary"></span>
            </div>

            <div class="flex flex-wrap items-center gap-3">
                <!-- Department Filter -->
                <div class="select_block sm:pr-16 pr-10 pl-3 py-2 border border-line rounded">
                    <div class="select">
                        <span class="selected caption1" data-title="all departments">{% trans "All Departments" %}</span>
                        <ul class="list_option scrollbar_custom max-h-[200px] p-0 bg-white">
                            <li class="caption1" data-item="all">{% trans "All Departments" %}</li>
                            {% for dept in departments %}
                            <li class="caption1" data-item="{{ dept.id }}">{{ dept.name }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    <span class="icon_down ph ph-caret-down right-3"></span>
                </div>

                <!-- Status Filter -->
                <div class="select_block sm:pr-16 pr-10 pl-3 py-2 border border-line rounded">
                    <div class="select">
                        <span class="selected caption1" data-title="all status">{% trans "All Status" %}</span>
                        <ul class="list_option scrollbar_custom max-h-[200px] p-0 bg-white">
                            <li class="caption1" data-item="all">{% trans "All Status" %}</li>
                            <li class="caption1" data-item="active">{% trans "Active" %}</li>
                            <li class="caption1" data-item="on_leave">{% trans "On Leave" %}</li>
                            <li class="caption1" data-item="inactive">{% trans "Inactive" %}</li>
                        </ul>
                    </div>
                    <span class="icon_down ph ph-caret-down right-3"></span>
                </div>

                <!-- View Toggle -->
                <div class="flex items-center gap-2 p-1 bg-surface rounded-lg">
                    <button @click="viewMode = 'grid'"
                            :class="viewMode === 'grid' ? 'bg-white shadow-sm' : ''"
                            class="p-2 rounded-md transition-all">
                        <span class="ph ph-squares-four text-xl text-secondary"></span>
                    </button>
                    <button @click="viewMode = 'list'"
                            :class="viewMode === 'list' ? 'bg-white shadow-sm' : ''"
                            class="p-2 rounded-md transition-all">
                        <span class="ph ph-list text-xl text-secondary"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Employees Container -->
    <div id="employees-container" class="col-span-full">
        <!-- Grid View -->
        <div x-show="viewMode === 'grid'" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            {% for employee in employees %}
            <div class="p-6 rounded-lg bg-white hover:shadow-lg transition-all">
                <div class="text-center">
                    {% if employee.user.profile_picture %}
                    <img class="mx-auto h-24 w-24 rounded-full object-cover" src="{{ employee.user.profile_picture.url }}" alt="{{ employee.user.get_full_name }}">
                    {% else %}
                    <div class="mx-auto h-24 w-24 rounded-full bg-gradient-to-br from-primary to-blue-600 flex items-center justify-center">
                        <span class="text-white text-2xl font-medium">{{ employee.user.first_name|slice:":1" }}{{ employee.user.last_name|slice:":1" }}</span>
                    </div>
                    {% endif %}

                    <h3 class="mt-4 heading6">{{ employee.user.get_full_name }}</h3>
                    <p class="caption1 text-secondary mt-1">{{ employee.job_title|default:"N/A" }}</p>
                    <p class="caption2 text-primary mt-1">{{ employee.department.name|default:"N/A" }}</p>

                    <!-- Status Badge -->
                    <div class="mt-3">
                        {% if employee.status == 'active' %}
                        <span class="tag bg-green-500 bg-opacity-10 text-green-500">
                            <span class="w-1.5 h-1.5 mr-1.5 rounded-full bg-green-500"></span>
                            {% trans "Active" %}
                        </span>
                        {% elif employee.status == 'on_leave' %}
                        <span class="tag bg-yellow-500 bg-opacity-10 text-yellow-500">
                            <span class="w-1.5 h-1.5 mr-1.5 rounded-full bg-yellow-500"></span>
                            {% trans "On Leave" %}
                        </span>
                        {% else %}
                        <span class="tag bg-secondary bg-opacity-10 text-secondary">
                            {% trans "Inactive" %}
                        </span>
                        {% endif %}
                    </div>

                    <!-- Contact Icons -->
                    <div class="mt-4 flex justify-center gap-3">
                        <a href="mailto:{{ employee.user.email }}" class="text-secondary hover:text-primary" title="{% trans 'Email' %}">
                            <span class="ph ph-envelope text-xl"></span>
                        </a>
                        {% if employee.phone %}
                        <a href="tel:{{ employee.phone }}" class="text-secondary hover:text-primary" title="{% trans 'Call' %}">
                            <span class="ph ph-phone text-xl"></span>
                        </a>
                        {% endif %}
                        <a href="{% url 'frontend:messages:compose' %}?to={{ employee.user.id }}" class="text-secondary hover:text-primary" title="{% trans 'Message' %}">
                            <span class="ph ph-chat-circle-text text-xl"></span>
                        </a>
                    </div>
                </div>

                <div class="mt-6 pt-4 border-t border-line text-center">
                    <a href="{% url 'frontend:hr:employee-detail' employee.id %}" class="caption1 text-primary hover:underline font-medium">
                        {% trans "View Profile" %} <span class="ph ph-arrow-right"></span>
                    </a>
                </div>
            </div>
            {% empty %}
            <div class="col-span-full py-12 text-center">
                <span class="ph ph-users text-6xl text-secondary"></span>
                <h3 class="mt-4 heading6">{% trans "No employees found" %}</h3>
                <p class="caption1 text-secondary mt-2">{% trans "Get started by adding your first employee." %}</p>
            </div>
            {% endfor %}
        </div>

        <!-- List View -->
        <div x-show="viewMode === 'list'" x-cloak class="rounded-lg bg-white overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="border-b border-line">
                        <tr>
                            <th class="px-6 py-4 text-left caption1 font-bold text-secondary uppercase">{% trans "Employee" %}</th>
                            <th class="px-6 py-4 text-left caption1 font-bold text-secondary uppercase">{% trans "Department" %}</th>
                            <th class="px-6 py-4 text-left caption1 font-bold text-secondary uppercase">{% trans "Role" %}</th>
                            <th class="px-6 py-4 text-left caption1 font-bold text-secondary uppercase">{% trans "Status" %}</th>
                            <th class="px-6 py-4 text-left caption1 font-bold text-secondary uppercase">{% trans "Start Date" %}</th>
                            <th class="px-6 py-4 text-right caption1 font-bold text-secondary uppercase">{% trans "Actions" %}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for employee in employees %}
                        <tr class="border-b border-line hover:bg-surface transition-all">
                            <td class="px-6 py-4">
                                <div class="flex items-center gap-3">
                                    {% if employee.user.profile_picture %}
                                    <img class="h-10 w-10 rounded-full object-cover" src="{{ employee.user.profile_picture.url }}" alt="">
                                    {% else %}
                                    <div class="h-10 w-10 rounded-full bg-primary flex items-center justify-center">
                                        <span class="text-white caption1 font-medium">{{ employee.user.first_name|slice:":1" }}{{ employee.user.last_name|slice:":1" }}</span>
                                    </div>
                                    {% endif %}
                                    <div>
                                        <div class="caption1 font-medium text-title">{{ employee.user.get_full_name }}</div>
                                        <div class="caption2 text-secondary">{{ employee.user.email }}</div>
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-4 caption1 text-title">{{ employee.department.name|default:"N/A" }}</td>
                            <td class="px-6 py-4 caption1 text-secondary">{{ employee.job_title|default:"N/A" }}</td>
                            <td class="px-6 py-4">
                                {% if employee.status == 'active' %}
                                <span class="tag bg-green-500 bg-opacity-10 text-green-500">{% trans "Active" %}</span>
                                {% elif employee.status == 'on_leave' %}
                                <span class="tag bg-yellow-500 bg-opacity-10 text-yellow-500">{% trans "On Leave" %}</span>
                                {% else %}
                                <span class="tag bg-secondary bg-opacity-10 text-secondary">{% trans "Inactive" %}</span>
                                {% endif %}
                            </td>
                            <td class="px-6 py-4 caption1 text-secondary">{{ employee.start_date|date:"M d, Y"|default:"N/A" }}</td>
                            <td class="px-6 py-4 text-right">
                                <a href="{% url 'frontend:hr:employee-detail' employee.id %}" class="caption1 text-primary hover:underline font-medium">{% trans "View" %}</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    {% if page_obj %}
    <!-- Pagination -->
    <div class="col-span-full mt-6">
        {% include "components/pagination.html" %}
    </div>
    {% endif %}
</div>
{% endif %}
{% endblock %}
