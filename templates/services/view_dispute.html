{% extends "base/freelanhub_dashboard_base.html" %}
{% load static i18n humanize %}

{% block page_title %}{% trans "Dispute" %} #{{ dispute.id }}{% endblock %}

{% block dashboard_content %}
<!-- Breadcrumb -->
<div class="breadcrumb flex items-center gap-2 mb-6">
    <a href="{% url 'services:my_contracts' %}" class="text-secondary hover:text-primary caption1">{% trans "My Contracts" %}</a>
    <span class="ph ph-caret-right text-secondary"></span>
    <a href="{% url 'services:view_contract' contract.id %}" class="text-secondary hover:text-primary caption1">{{ contract.title|truncatewords:5 }}</a>
    <span class="ph ph-caret-right text-secondary"></span>
    <span class="text-title caption1">{% trans "Dispute" %} #{{ dispute.id }}</span>
</div>

<!-- Page Header -->
<div class="heading mb-6">
    <div class="flex items-center gap-3">
        <h3 class="heading3">{% trans "Dispute" %} #{{ dispute.id }}</h3>
        <span class="tag {% if dispute.resolved %}bg-green bg-opacity-10 text-green{% else %}bg-red bg-opacity-10 text-red{% endif %}">
            {% if dispute.resolved %}{% trans "Resolved" %}{% else %}{% trans "Open" %}{% endif %}
        </span>
    </div>
</div>
<div class="max-w-3xl mx-auto space-y-7.5">
    <!-- Dispute Details -->
    <div class="p-8 rounded-lg bg-white">
        <div class="pb-6 border-b border-line">
            <div class="flex items-start justify-between">
                <div>
                    <h2 class="heading4 mb-2">{{ dispute.reason }}</h2>
                    <p class="caption1 text-secondary">
                        {% trans "Raised by" %}
                        {% if is_raiser %}{% trans "you" %}{% else %}{{ dispute.raised_by.get_full_name|default:dispute.raised_by.email }}{% endif %}
                        {% trans "on" %} {{ dispute.created_at|date:"F d, Y" }}
                    </p>
                </div>
            </div>
        </div>

        <div class="pt-6">
            {% if dispute.details %}
            <div class="text-secondary whitespace-pre-line">
                {{ dispute.details|linebreaks }}
            </div>
            {% else %}
            <p class="text-secondary italic">{% trans "No additional details provided." %}</p>
            {% endif %}
        </div>
    </div>

    <!-- Contract & Escrow Info -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-7.5">
        <!-- Contract Info -->
        <div class="p-8 rounded-lg bg-white">
            <h3 class="heading5 mb-6">{% trans "Contract" %}</h3>
            <dl class="space-y-4">
                <div>
                    <dt class="caption1 text-secondary">{% trans "Title" %}</dt>
                    <dd class="mt-1 text-title">{{ contract.title }}</dd>
                </div>
                <div>
                    <dt class="caption1 text-secondary">{% trans "Amount" %}</dt>
                    <dd class="mt-1 heading5 text-title">${{ contract.agreed_rate|floatformat:2 }}</dd>
                </div>
                <div>
                    <dt class="caption1 text-secondary">{% trans "Status" %}</dt>
                    <dd class="mt-1">
                        <span class="tag bg-red bg-opacity-10 text-red">
                            {{ contract.get_status_display }}
                        </span>
                    </dd>
                </div>
            </dl>
            <div class="mt-6 pt-6 border-t border-line">
                <a href="{% url 'services:view_contract' contract.id %}"
                   class="caption1 text-primary hover:text-primary inline-flex items-center gap-1">
                    {% trans "View Contract" %} <span class="ph ph-arrow-right"></span>
                </a>
            </div>
        </div>

        <!-- Escrow Status -->
        <div class="p-8 rounded-lg bg-white">
            <h3 class="heading5 mb-6">{% trans "Escrow Status" %}</h3>
            <dl class="space-y-4">
                <div>
                    <dt class="caption1 text-secondary">{% trans "Escrow Amount" %}</dt>
                    <dd class="mt-1 heading5 text-title">${{ escrow.amount|floatformat:2 }} {{ escrow.currency }}</dd>
                </div>
                <div>
                    <dt class="caption1 text-secondary">{% trans "Status" %}</dt>
                    <dd class="mt-1">
                        <span class="tag bg-yellow bg-opacity-10 text-yellow">
                            {{ escrow.get_status_display }}
                        </span>
                    </dd>
                </div>
                <div>
                    <dt class="caption1 text-secondary">{% trans "Dispute Raised" %}</dt>
                    <dd class="mt-1 text-title">{{ escrow.dispute_raised_at|date:"F d, Y H:i" }}</dd>
                </div>
            </dl>
        </div>
    </div>

    <!-- Resolution (if resolved) -->
    {% if dispute.resolved %}
    <div class="p-8 rounded-lg bg-green bg-opacity-10">
        <div class="flex items-start gap-4">
            <div class="flex-shrink-0">
                <span class="ph ph-check-circle text-4xl text-green"></span>
            </div>
            <div class="flex-1">
                <h3 class="heading5 text-green mb-2">{% trans "Dispute Resolved" %}</h3>
                <p class="caption1 text-green">
                    {% trans "Resolved on" %} {{ dispute.resolved_at|date:"F d, Y H:i" }}
                </p>
                {% if dispute.resolution_notes %}
                <div class="mt-4 p-6 bg-white rounded-lg">
                    <p class="heading6 mb-2">{% trans "Resolution Notes:" %}</p>
                    <p class="text-secondary">{{ dispute.resolution_notes }}</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% else %}
    <!-- Pending Resolution Notice -->
    <div class="p-8 rounded-lg bg-yellow bg-opacity-10">
        <div class="flex items-start gap-4">
            <div class="flex-shrink-0">
                <span class="ph ph-clock text-4xl text-yellow animate-pulse"></span>
            </div>
            <div>
                <h3 class="heading5 text-yellow mb-2">{% trans "Pending Review" %}</h3>
                <p class="caption1 text-yellow">
                    {% trans "Our team is reviewing this dispute. You will be notified once a resolution is made. Expected response within 48 hours." %}
                </p>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Actions -->
    <div class="flex justify-end">
        <a href="{% url 'services:view_contract' contract.id %}"
           class="button-main -border">
            {% trans "Back to Contract" %}
        </a>
    </div>
</div>
{% endblock %}
