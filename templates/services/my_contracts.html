{% extends "base/freelanhub_dashboard_base.html" %}
{% load static i18n humanize %}

{% block title %}{% trans "My Contracts" %} - Zumodra{% endblock %}

{% block breadcrumb %}
<li class="flex items-center">
    <svg class="zu-icon--sm text-secondary" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/>
    </svg>
    <span class="ml-2 caption1 text-secondary">{% trans "My Contracts" %}</span>
</li>
{% endblock %}

{% block page_title %}{% trans "My Contracts" %}{% endblock %}

{% block page_description %}
<p class="mt-1 caption2 text-secondary">
    {% trans "View and manage all your contracts." %}
</p>
{% endblock %}

{% block dashboard_content %}
<div class="space-y-7.5">
    <!-- Contracts as Client -->
    <div class="zu-card">
        <div class="zu-card__header">
            <div class="zu-card__header-content">
                <h2 class="zu-card__title">{% trans "As Client" %}</h2>
            </div>
        </div>

        <div class="zu-table-container">
            <div class="zu-table__wrapper">
                <table class="zu-table">
                    <thead class="zu-table__head">
                        <tr>
                            <th scope="col" class="zu-table__th">
                                {% trans "Contract" %}
                            </th>
                            <th scope="col" class="zu-table__th">
                                {% trans "Provider" %}
                            </th>
                            <th scope="col" class="zu-table__th">
                                {% trans "Amount" %}
                            </th>
                            <th scope="col" class="zu-table__th">
                                {% trans "Status" %}
                            </th>
                            <th scope="col" class="zu-table__th">
                                {% trans "Date" %}
                            </th>
                            <th scope="col" class="zu-table__th zu-table__th--actions">
                                <span class="sr-only">{% trans "Actions" %}</span>
                            </th>
                        </tr>
                    </thead>
                    <tbody class="zu-table__body">
                        {% for contract in client_contracts %}
                        <tr class="zu-table__row">
                            <td class="zu-table__td zu-table__td--primary">
                                <a href="{% url 'view_contract' contract.id %}" class="caption1 hover:text-primary">
                                    {{ contract.title|truncatewords:5 }}
                                </a>
                            </td>
                            <td class="zu-table__td">
                                <div class="flex items-center">
                                    {% if contract.provider.avatar %}
                                    <img src="{{ contract.provider.avatar.url }}" alt="" class="w-8 h-8 rounded-full object-cover mr-3">
                                    {% else %}
                                    <div class="w-8 h-8 rounded-full bg-primary bg-opacity-10 flex items-center justify-center mr-3">
                                        <span class="text-xs font-medium text-primary-600 dark:text-primary-400">{{ contract.provider.display_name|slice:":1"|upper }}</span>
                                    </div>
                                    {% endif %}
                                    <span class="text-sm text-on-surface">{{ contract.provider.display_name }}</span>
                                </div>
                            </td>
                            <td class="zu-table__td">
                                <span class="caption1">${{ contract.agreed_rate|intcomma }}</span>
                            </td>
                            <td class="zu-table__td">
                                <span class="zu-badge
                                    {% if contract.status == 'pending' %}zu-badge--warning
                                    {% elif contract.status == 'active' or contract.status == 'in_progress' %}zu-badge--info
                                    {% elif contract.status == 'completed' %}zu-badge--success
                                    {% elif contract.status == 'cancelled' %}zu-badge--danger
                                   {% else %}zu-badge--neutral{% endif %}">
                                    {{ contract.get_status_display }}
                                </span>
                            </td>
                            <td class="zu-table__td">
                                <span class="caption2 text-secondary">{{ contract.created_at|date:"M d, Y" }}</span>
                            </td>
                            <td class="zu-table__td zu-table__td--actions">
                                <a href="{% url 'view_contract' contract.id %}" class="zu-btn zu-btn--ghost zu-btn--sm">{% trans "View" %}</a>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="6" class="zu-table__td">
                                <div class="zu-empty py-12">
                                    <svg class="zu-icon zu-empty__icon mx-auto h-12 w-12 text-secondary" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                    </svg>
                                    <p class="mt-2 caption2 text-secondary">{% trans "No contracts as client." %}</p>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Contracts as Provider -->
    {% if provider_contracts %}
    <div class="zu-card">
        <div class="zu-card__header">
            <div class="zu-card__header-content">
                <h2 class="zu-card__title">{% trans "As Provider" %}</h2>
            </div>
        </div>

        <div class="zu-table-container">
            <div class="zu-table__wrapper">
                <table class="zu-table">
                    <thead class="zu-table__head">
                        <tr>
                            <th scope="col" class="zu-table__th">
                                {% trans "Contract" %}
                            </th>
                            <th scope="col" class="zu-table__th">
                                {% trans "Client" %}
                            </th>
                            <th scope="col" class="zu-table__th">
                                {% trans "Amount" %}
                            </th>
                            <th scope="col" class="zu-table__th">
                                {% trans "Status" %}
                            </th>
                            <th scope="col" class="zu-table__th">
                                {% trans "Date" %}
                            </th>
                            <th scope="col" class="zu-table__th zu-table__th--actions">
                                <span class="sr-only">{% trans "Actions" %}</span>
                            </th>
                        </tr>
                    </thead>
                    <tbody class="zu-table__body">
                        {% for contract in provider_contracts %}
                        <tr class="zu-table__row">
                            <td class="zu-table__td zu-table__td--primary">
                                <a href="{% url 'view_contract' contract.id %}" class="caption1 hover:text-primary">
                                    {{ contract.title|truncatewords:5 }}
                                </a>
                            </td>
                            <td class="zu-table__td">
                                <span class="text-sm text-on-surface">{{ contract.client.get_full_name|default:contract.client.email }}</span>
                            </td>
                            <td class="zu-table__td">
                                <span class="caption1">${{ contract.agreed_rate|intcomma }}</span>
                            </td>
                            <td class="zu-table__td">
                                <span class="zu-badge
                                    {% if contract.status == 'pending' %}zu-badge--warning
                                    {% elif contract.status == 'active' or contract.status == 'in_progress' %}zu-badge--info
                                    {% elif contract.status == 'completed' %}zu-badge--success
                                    {% elif contract.status == 'cancelled' %}zu-badge--danger
                                   {% else %}zu-badge--neutral{% endif %}">
                                    {{ contract.get_status_display }}
                                </span>
                            </td>
                            <td class="zu-table__td">
                                <span class="caption2 text-secondary">{{ contract.created_at|date:"M d, Y" }}</span>
                            </td>
                            <td class="zu-table__td zu-table__td--actions">
                                <a href="{% url 'view_contract' contract.id %}" class="zu-btn zu-btn--ghost zu-btn--sm">{% trans "View" %}</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
