{% extends "base/freelanhub_dashboard_base.html" %}
{% load static i18n humanize %}

{% block page_title %}{% trans "Update Contract Status" %}{% endblock %}

{% block dashboard_content %}
<!-- Breadcrumb -->
<div class="breadcrumb flex items-center gap-2 mb-6">
    <a href="{% url 'my_contracts' %}" class="text-secondary hover:text-primary caption1">{% trans "My Contracts" %}</a>
    <span class="ph ph-caret-right text-secondary"></span>
    <a href="{% url 'view_contract' contract.id %}" class="text-secondary hover:text-primary caption1">{{ contract.title|truncatewords:3 }}</a>
    <span class="ph ph-caret-right text-secondary"></span>
    <span class="text-title caption1">{% trans "Update Status" %}</span>
</div>

<!-- Page Header -->
<div class="heading mb-6">
    <h3 class="heading3">{% trans "Update Contract Status" %}</h3>
</div>
<div class="max-w-lg mx-auto">
    <div class="p-8 rounded-lg bg-white">
        <!-- Current Status -->
        <div class="pb-6 border-b border-line">
            <h3 class="caption1 text-secondary mb-3">{% trans "Current Status" %}</h3>
            <span class="tag
                {% if contract.status == 'pending' %}bg-yellow bg-opacity-10 text-yellow
                {% elif contract.status == 'active' or contract.status == 'in_progress' %}bg-blue bg-opacity-10 text-blue
                {% elif contract.status == 'completed' %}bg-green bg-opacity-10 text-green
                {% elif contract.status == 'cancelled' %}bg-red bg-opacity-10 text-red
                {% else %}bg-secondary bg-opacity-10 text-secondary{% endif %}">
                {{ contract.get_status_display }}
            </span>
        </div>

        <!-- Available Actions -->
        <div class="pt-6">
            <h3 class="heading5 mb-6">{% trans "Available Actions" %}</h3>

            <div class="space-y-5">
                {% if contract.status == 'pending' %}
                <!-- Start Contract -->
                <form method="post" class="p-6 rounded-lg bg-blue bg-opacity-10">
                    {% csrf_token %}
                    <input type="hidden" name="status" value="active">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <h4 class="heading6 text-blue mb-1">{% trans "Start Contract" %}</h4>
                            <p class="caption1 text-blue">{% trans "Begin working on this contract." %}</p>
                        </div>
                        <button type="submit" class="button-main">
                            {% trans "Start" %}
                        </button>
                    </div>
                </form>
                {% endif %}

                {% if contract.status == 'active' %}
                <!-- Mark as Completed (Provider only) -->
                <form method="post" class="p-6 rounded-lg bg-green bg-opacity-10">
                    {% csrf_token %}
                    <input type="hidden" name="status" value="completed">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <h4 class="heading6 text-green mb-1">{% trans "Mark as Completed" %}</h4>
                            <p class="caption1 text-green">{% trans "Mark this contract as completed." %}</p>
                        </div>
                        <button type="submit" class="button-main">
                            {% trans "Complete" %}
                        </button>
                    </div>
                </form>
                {% endif %}

                {% if contract.status != 'completed' and contract.status != 'cancelled' %}
                <!-- Cancel Contract -->
                <form method="post" class="p-6 rounded-lg bg-red bg-opacity-10">
                    {% csrf_token %}
                    <input type="hidden" name="status" value="cancelled">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <h4 class="heading6 text-red mb-1">{% trans "Cancel Contract" %}</h4>
                            <p class="caption1 text-red">{% trans "Cancel this contract. This action cannot be undone." %}</p>
                        </div>
                        <button type="submit" class="button-main">
                            {% trans "Cancel" %}
                        </button>
                    </div>
                </form>
                {% endif %}

                {% if contract.status == 'completed' or contract.status == 'cancelled' %}
                <div class="p-8 rounded-lg bg-surface text-center">
                    <span class="ph ph-check-circle text-6xl text-secondary opacity-30 block mb-4"></span>
                    <p class="caption1 text-secondary">
                        {% trans "This contract has been finalized. No further status changes are available." %}
                    </p>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Back Link -->
        <div class="pt-6 mt-6 border-t border-line">
            <a href="{% url 'view_contract' contract.id %}"
               class="caption1 text-primary hover:text-primary inline-flex items-center gap-1">
                <span class="ph ph-arrow-left"></span>
                {% trans "Back to Contract" %}
            </a>
        </div>
    </div>
</div>
{% endblock %}
