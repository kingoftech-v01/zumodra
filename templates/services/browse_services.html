{% extends "base/freelanhub_base.html" %}
{% load static i18n humanize %}

{% block title %}{% trans "Browse Services" %} - FreelanHub{% endblock %}

{% block meta_description %}{% trans "Discover professional services from verified providers. Find the perfect freelancer for your project." %}{% endblock %}

{% block content %}

<!-- Breadcrumb -->
<section class="breadcrumb">
    <div class="breadcrumb_inner relative sm:mt-20 mt-16 lg:py-20 py-14">
        <div class="breadcrumb_bg absolute top-0 left-0 w-full h-full bg-primary"></div>
        <div class="container relative h-full">
            <div class="breadcrumb_content flex flex-col items-start justify-center xl:w-[1000px] lg:w-[848px] md:w-5/6 w-full h-full">
                <div class="list_breadcrumb flex items-center gap-2 animate animate_top" style="--i: 1">
                    <a href="/" class="caption1 text-white">{% trans "Home" %}</a>
                    <span class="caption1 text-white opacity-40">/</span>
                    <span class="caption1 text-white opacity-60">{% trans "Services" %}</span>
                </div>
                <h3 class="heading3 text-white mt-2 animate animate_top" style="--i: 2">{% trans "Browse Services" %}</h3>

                <!-- Search Form -->
                <div class="form_search z-[1] w-full mt-5 animate animate_top" style="--i: 3">
                    <form method="get" action="{% url 'services:service_list' %}" class="form_inner flex items-center justify-between max-sm:flex-wrap gap-6 gap-y-4 relative w-full p-3 rounded-lg bg-white">
                        <div class="form_input relative w-full">
                            <span class="icon_search ph-bold ph-magnifying-glass absolute top-1/2 -translate-y-1/2 left-2 text-xl"></span>
                            <input type="text" name="search" value="{{ search }}" class="input_search w-full h-full pl-10" placeholder="{% trans 'Job title, keywords or service' %}" />
                        </div>
                        <div class="select_block flex-shrink-0 max-sm:w-full sm:pr-16 pr-7 sm:pl-6 pl-3 sm:border-l border-line">
                            <div class="select">
                                <span class="selected" data-title="{% trans 'All Categories' %}">{% trans "All Categories" %}</span>
                                <ul class="list_option bg-white max-sm:w-full">
                                    {% for category in categories %}
                                    <li data-item="{{ category.name }}">{{ category.name }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                            <span class="icon_down ph ph-caret-down sm:text-2xl text-xl sm:right-0 right-3"></span>
                        </div>
                        <button type="submit" class="button-main max-sm:w-1/3 text-center flex-shrink-0">{% trans "Search" %}</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- List Services -->
<div class="services lg:py-20 sm:py-14 py-10">
    <div class="container flex max-lg:flex-col-reverse gap-y-10">

        <!-- Sidebar Filters -->
        <div class="sidebar_inner relative full-height flex-shrink-0 lg:w-[300px] w-full">
            <form method="get" action="{% url 'services:service_list' %}">

                <!-- Search Filter -->
                <div class="filter_section search">
                    <strong class="text-button">{% trans "search" %}</strong>
                    <div class="form_input relative w-full h-12 mt-2">
                        <span class="icon_search ph-bold ph-magnifying-glass absolute top-1/2 -translate-y-1/2 left-3 text-xl"></span>
                        <input type="text" name="search" value="{{ search }}" class="input_search w-full h-full pl-10 pr-3 border border-line rounded-lg" placeholder="{% trans 'Job title, keywords...' %}" />
                    </div>
                </div>

                <!-- Category Filter -->
                <div class="filter_section category relative z-[2] mt-6">
                    <strong class="text-button">{% trans "category" %}</strong>
                    <div class="select_block flex items-center w-full h-12 pr-10 pl-3 mt-2 border border-line rounded-lg">
                        <div class="select">
                            <span class="selected capitalize" data-title="{% trans 'Select category' %}">{% trans "Select category" %}</span>
                            <div class="list_option w-full bg-white">
                                <div class="form_input relative w-full h-11">
                                    <span class="icon_search ph-bold ph-magnifying-glass absolute top-1/2 -translate-y-1/2 left-3 text-lg"></span>
                                    <input type="text" class="input_search w-full h-full pl-10 pr-3 border border-line rounded-lg" placeholder="{% trans 'Find category...' %}" />
                                </div>
                                <ul class="list_result mt-3">
                                    {% for category in categories %}
                                    <li class="capitalize" data-item="{{ category.name }}">{{ category.name }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                        <span class="icon_down ph ph-caret-down right-3"></span>
                    </div>
                </div>

                <!-- Price Range Filter -->
                <div class="filter_section filter_price mt-6">
                    <strong class="text-button">{% trans "Budget" %}</strong>
                    <div class="tow_bar_block mt-5">
                        <div class="progress"></div>
                    </div>
                    <div class="range_input">
                        <input class="input range_min" type="range" min="0" max="5000" value="{{ request.GET.min_price|default:0 }}" />
                        <input class="input range_max" type="range" min="0" max="5000" value="{{ request.GET.max_price|default:5000 }}" />
                    </div>
                    <div class="price_block flex items-center justify-between mt-4">
                        <div class="price_min flex items-center overflow-hidden relative w-32 h-10">
                            <span class="text-button text-secondary absolute top-1/2 -translate-y-1/2 left-3">$</span>
                            <input type="number" name="min_price" value="{{ request.GET.min_price|default:0 }}" class="caption1 w-full h-full pl-7 pr-10 border border-line rounded-lg" />
                            <span class="caption1 text-placehover absolute top-1/2 -translate-y-1/2 right-3">{% trans "min" %}</span>
                        </div>
                        <span class="ph-bold ph-minus text-xl"></span>
                        <div class="price_max flex items-center overflow-hidden relative w-32 h-10">
                            <span class="text-button text-secondary absolute top-1/2 -translate-y-1/2 left-3">$</span>
                            <input type="number" name="max_price" value="{{ request.GET.max_price|default:5000 }}" class="caption1 w-full h-full pl-7 pr-10 border border-line rounded-lg" />
                            <span class="caption1 text-placehover absolute top-1/2 -translate-y-1/2 right-3">{% trans "max" %}</span>
                        </div>
                    </div>
                </div>

                <!-- Filter Button -->
                <button type="submit" class="button-main w-full mt-6 text-center">{% trans "Find Services" %}</button>
            </form>
        </div>

        <!-- Main Content -->
        <div class="right w-full lg:pl-7.5">

            <!-- Filter Header -->
            <div class="filter flex flex-wrap items-center justify-between gap-8 gap-y-3 relative w-full">
                <ul class="list_layout flex items-center gap-1">
                    <li class="max-xl:hidden">
                        <button class="layout_btn cols_3 active"></button>
                    </li>
                    <li class="max-xl:hidden">
                        <button class="layout_btn cols_2"></button>
                    </li>
                    <li class="xl:hidden">
                        <a href="#!" class="layout_link cols_2 active"></a>
                    </li>
                </ul>

                <!-- Sort Dropdown -->
                <div class="select_filter flex items-center gap-3">
                    <span class="caption1">{% trans "Sort by:" %}</span>
                    <div class="select_block sm:pr-16 pr-10 pl-3 py-1 border border-line rounded">
                        <div class="select">
                            <span class="selected caption1 capitalize" data-title="{% trans 'default' %}">{% trans "default" %}</span>
                            <ul class="list_option p-0 bg-white">
                                <li class="capitalize" data-item="default">{% trans "sort by (default)" %}</li>
                                <li class="capitalize" data-item="newest">{% trans "newest" %}</li>
                                <li class="capitalize" data-item="oldest">{% trans "oldest" %}</li>
                                <li class="capitalize" data-item="price-low">{% trans "price: low to high" %}</li>
                                <li class="capitalize" data-item="price-high">{% trans "price: high to low" %}</li>
                            </ul>
                        </div>
                        <span class="icon_down ph ph-caret-down right-3"></span>
                    </div>
                </div>
            </div>

            <!-- Results Count -->
            <div class="list_filtered flex flex-wrap items-center gap-3 w-full mt-5">
                <span class="quantity pr-3 border-r border-line">
                    {% if services.paginator.count %}
                    {{ services.paginator.count }}+ {% trans "Results" %}
                    {% else %}
                    0 {% trans "Results" %}
                    {% endif %}
                </span>
            </div>

            <!-- Services Grid -->
            <ul class="list_layout_cols list_services grid xl:grid-cols-3 sm:grid-cols-2 md:gap-7.5 gap-5 w-full md:mt-10 mt-7">
                {% for service in services %}
                <li class="item h-full">
                    <div class="service_item overflow-hidden relative rounded-lg h-full bg-white shadow-md duration-300 hover:shadow-xl">
                        <!-- Wishlist Button -->
                        {% if user.is_authenticated %}
                        <button class="add_wishlist_btn">
                            <span class="ph ph-heart text-xl"></span>
                            <span class="ph-fill ph-heart text-xl"></span>
                        </button>
                        {% endif %}

                        <!-- Service Thumbnail -->
                        <a href="{% url 'services:service_detail' service.uuid %}" class="service_thumb">
                            {% if service.thumbnail %}
                            <img src="{{ service.thumbnail.url }}" alt="{{ service.name }}" class="w-full" />
                            {% else %}
                            <div class="w-full h-48 bg-surface flex items-center justify-center">
                                <span class="ph-fill ph-briefcase text-6xl text-placehover"></span>
                            </div>
                            {% endif %}
                        </a>

                        <!-- Service Info -->
                        <div class="service_info py-5 px-4">
                            <div class="flex items-center justify-between">
                                {% if service.category %}
                                <a href="{% url 'services:service_list' %}?category={{ service.category.id }}" class="tag caption2 bg-surface hover:bg-primary hover:text-white">{{ service.category.name }}</a>
                                {% else %}
                                <span class="tag caption2 bg-surface">{% trans "General" %}</span>
                                {% endif %}

                                <!-- Rating -->
                                <div class="rate flex items-center gap-1">
                                    <span class="ph-fill ph-star text-yellow text-xs"></span>
                                    <strong class="service_rate text-button-sm">{{ service.provider.rating_avg|default:"5.0"|floatformat:1 }}</strong>
                                    <span class="service_rate_quantity caption1 text-secondary">({{ service.provider.total_reviews|default:0 }})</span>
                                </div>
                            </div>

                            <!-- Service Title -->
                            <a href="{% url 'services:service_detail' service.uuid %}" class="service_title text-title pt-2 duration-300 hover:text-primary">{{ service.name }}</a>

                            <!-- Service Author & Price -->
                            <div class="service_more_info flex items-center justify-between gap-1 mt-4 pt-4 border-t border-line">
                                <a href="{% url 'services:provider_profile' service.provider.uuid %}" class="service_author flex items-center gap-2">
                                    {% if service.provider.avatar %}
                                    <img src="{{ service.provider.avatar.url }}" alt="{{ service.provider.display_name }}" class="service_author_avatar w-8 h-8 rounded-full" />
                                    {% else %}
                                    <div class="service_author_avatar w-8 h-8 rounded-full bg-primary flex items-center justify-center text-white font-semibold text-sm">
                                        {{ service.provider.display_name|slice:":1"|upper }}
                                    </div>
                                    {% endif %}
                                    <span class="service_author_name -style-1">{{ service.provider.display_name }}</span>
                                </a>
                                <div class="service_price whitespace-nowrap">
                                    <span class="text-secondary">{% trans "From" %} </span>
                                    <span class="price text-title">${{ service.price|intcomma }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </li>
                {% empty %}

                <!-- Empty State -->
                <li class="col-span-full">
                    <div class="text-center py-20">
                        <span class="ph ph-magnifying-glass text-9xl text-placehover"></span>
                        <h3 class="heading3 mt-6">{% trans "No services found" %}</h3>
                        <p class="body2 text-secondary mt-3">
                            {% trans "Try adjusting your search or filter criteria to find what you're looking for." %}
                        </p>
                        <a href="{% url 'services:service_list' %}" class="button-main mt-6 inline-block">
                            {% trans "Clear Filters" %}
                        </a>
                    </div>
                </li>

                {% endfor %}
            </ul>

            <!-- Pagination -->
            {% if services.has_other_pages %}
            <div class="pagination_block mt-10">
                <ul class="list_pagination flex items-center justify-center gap-1">
                    {% if services.has_previous %}
                    <li>
                        <a href="?page={{ services.previous_page_number }}{% if search %}&search={{ search }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.min_price %}&min_price={{ request.GET.min_price }}{% endif %}{% if request.GET.max_price %}&max_price={{ request.GET.max_price }}{% endif %}" class="item flex items-center justify-center w-10 h-10 rounded-lg border border-line duration-300 hover:bg-primary hover:text-white">
                            <span class="ph-bold ph-caret-left"></span>
                        </a>
                    </li>
                    {% endif %}

                    {% for num in services.paginator.page_range %}
                    {% if services.number == num %}
                    <li>
                        <span class="item flex items-center justify-center w-10 h-10 rounded-lg bg-primary text-white">{{ num }}</span>
                    </li>
                    {% elif num > services.number|add:'-3' and num < services.number|add:'3' %}
                    <li>
                        <a href="?page={{ num }}{% if search %}&search={{ search }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.min_price %}&min_price={{ request.GET.min_price }}{% endif %}{% if request.GET.max_price %}&max_price={{ request.GET.max_price }}{% endif %}" class="item flex items-center justify-center w-10 h-10 rounded-lg border border-line duration-300 hover:bg-primary hover:text-white">{{ num }}</a>
                    </li>
                    {% endif %}
                    {% endfor %}

                    {% if services.has_next %}
                    <li>
                        <a href="?page={{ services.next_page_number }}{% if search %}&search={{ search }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.min_price %}&min_price={{ request.GET.min_price }}{% endif %}{% if request.GET.max_price %}&max_price={{ request.GET.max_price }}{% endif %}" class="item flex items-center justify-center w-10 h-10 rounded-lg border border-line duration-300 hover:bg-primary hover:text-white">
                            <span class="ph-bold ph-caret-right"></span>
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </div>
            {% endif %}

        </div>
    </div>
</div>

{% endblock %}
