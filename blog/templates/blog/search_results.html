{% extends 'base_public.html' %}
{% load static wagtailcore_tags wagtailimages_tags %}

{% block page_content %}
        <!-- Breadcrumb -->
        <section class="breadcrumb">
            <div class="breadcrumb_inner relative sm:mt-20 mt-16 lg:py-20 py-14">
                <div class="breadcrumb_bg absolute top-0 left-0 w-full h-full">
                    <img src="{% static 'assets/images/components/breadcrumb_job.webp' %}" alt="Search Results" class="w-full h-full object-cover" />
                </div>
                <div class="container relative h-full">
                    <div class="breadcrumb_content flex flex-col items-start justify-center xl:w-[1000px] lg:w-[848px] md:w-5/6 w-full h-full">
                        <div class="list_breadcrumb flex items-center gap-2 animate animate_top" style="--i: 1">
                            <a href="/" class="caption1 text-white">Home</a>
                            <span class="caption1 text-white opacity-40">/</span>
                            <span class="caption1 text-white">Blog</span>
                            <span class="caption1 text-white opacity-40">/</span>
                            <span class="caption1 text-white opacity-60">Search Results</span>
                        </div>
                        <h3 class="heading3 text-white mt-2 animate animate_top" style="--i: 2">
                            {% if query %}Search: "{{ query }}"{% else %}Blog Search{% endif %}
                        </h3>
                        {% if total_results is not None %}
                        <p class="text-white mt-2 animate animate_top" style="--i: 3">Found {{ total_results }} result{{ total_results|pluralize }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </section>

        <!-- List blogs -->
        <div class="blogs lg:py-20 sm:py-14 py-10">
            <div class="container flex max-md:flex-col gap-y-12">
                <div class="list lg:pr-20 md:pr-12">
                    <ul class="list_blog grid lg:gap-10 gap-8">
                        {% for post in posts %}
                        <li class="blog_item">
                            <a href="{{ post.url }}" class="blog_thumb block overflow-hidden rounded-xl">
                                {% if post.featured_image %}
                                    {% image post.featured_image fill-800x450 as list_img %}
                                    <img src="{{ list_img.url }}" alt="{{ post.title }}" class="blog_img w-full" />
                                {% else %}
                                    <img src="{% static 'assets/images/blog/default.webp' %}" alt="{{ post.title }}" class="blog_img w-full" />
                                {% endif %}
                            </a>
                            <div class="blog_info flex flex-wrap items-center justify-between gap-8 gap-y-2 mt-5">
                                <div class="flex flex-wrap items-center gap-2">
                                    <div class="date flex items-center gap-2">
                                        <span class="ph ph-calendar-blank text-2xl"></span>
                                        <span class="blog_date">{{ post.publishing_date|date:"F d, Y"|default:post.first_published_at|date:"F d, Y" }}</span>
                                    </div>
                                    {% with parent=post.get_parent.specific %}
                                        {% if parent.specific_class.name == 'CategoryPage' %}
                                        <div class="line w-px h-3 bg-line"></div>
                                        <a href="{{ parent.url }}" class="category flex items-center gap-2 duration-300 hover:text-primary">
                                            <span class="ph ph-tag-simple text-2xl"></span>
                                            <span class="blog_category">{{ parent.title }}</span>
                                        </a>
                                        {% endif %}
                                    {% endwith %}
                                </div>
                                <div class="flex flex-wrap items-center gap-2">
                                    <div class="comment flex items-center gap-2">
                                        <span class="ph ph-chats-circle text-2xl"></span>
                                        <span class="blog_comment">{{ post.comments.count }}</span>
                                    </div>
                                    <div class="line w-px h-3 bg-line"></div>
                                    <div class="view flex items-center gap-2">
                                        <span class="ph ph-eye text-2xl"></span>
                                        <span class="blog_view">{{ post.view_count }}</span>
                                    </div>
                                </div>
                            </div>
                            <a href="{{ post.url }}" class="heading5 blog_title mt-3 hover:underline">{{ post.title }}</a>
                            <p class="blog_desc mt-2 text-secondary">{{ post.excerpt|default:""|truncatewords:30 }}</p>
                        </li>
                        {% empty %}
                        <li class="text-secondary">No results found for your search.</li>
                        {% endfor %}
                    </ul>
                    {% if posts.has_other_pages %}
                    <ul class="list_pagination menu_tab flex items-center justify-center gap-2 w-full md:mt-10 mt-7" role="tablist">
                        {% if posts.has_previous %}
                        <li role="presentation">
                            <a href="?page={{ posts.previous_page_number }}{% if query %}&q={{ query }}{% endif %}{% if tag_slug %}&tag={{ tag_slug }}{% endif %}{% if category_id %}&category={{ category_id }}{% endif %}" class="tab_btn -fill flex items-center justify-center w-10 h-10 rounded border border-line text-title duration-300 hover:border-black" role="tab"><</a>
                        </li>
                        {% endif %}

                        {% for num in posts.paginator.page_range %}
                            {% if posts.number == num %}
                            <li role="presentation">
                                <a href="?page={{ num }}{% if query %}&q={{ query }}{% endif %}{% if tag_slug %}&tag={{ tag_slug }}{% endif %}{% if category_id %}&category={{ category_id }}{% endif %}" class="tab_btn -fill flex items-center justify-center w-10 h-10 rounded border border-line text-title duration-300 hover:border-black active" role="tab" aria-selected="true">{{ num }}</a>
                            </li>
                            {% elif num > posts.number|add:'-3' and num < posts.number|add:'3' %}
                            <li role="presentation">
                                <a href="?page={{ num }}{% if query %}&q={{ query }}{% endif %}{% if tag_slug %}&tag={{ tag_slug }}{% endif %}{% if category_id %}&category={{ category_id }}{% endif %}" class="tab_btn -fill flex items-center justify-center w-10 h-10 rounded border border-line text-title duration-300 hover:border-black" role="tab" aria-selected="false">{{ num }}</a>
                            </li>
                            {% endif %}
                        {% endfor %}

                        {% if posts.has_next %}
                        <li role="presentation">
                            <a href="?page={{ posts.next_page_number }}{% if query %}&q={{ query }}{% endif %}{% if tag_slug %}&tag={{ tag_slug }}{% endif %}{% if category_id %}&category={{ category_id }}{% endif %}" class="tab_btn -fill flex items-center justify-center w-10 h-10 rounded border border-line text-title duration-300 hover:border-black" role="tab">></a>
                        </li>
                        {% endif %}
                    </ul>
                    {% endif %}
                </div>
                <div class="blog_sidebar flex-shrink-0 lg:w-[360px] md:w-1/3 w-full h-fit">
                    <form method="GET" action="{% url 'frontend:blog:search' %}" class="form-search overflow-hidden relative w-full h-12 rounded-lg">
                        <input class="py-2 pl-4 pr-16 w-full h-full border border-line rounded-lg" type="text" name="q" placeholder="Search" value="{{ query }}" />
                        <button type="submit" class="flex items-center justify-center absolute top-0 right-0 h-full aspect-square rounded-r-lg bg-primary text-white duration-300 hover:bg-black">
                            <span class="ph ph-magnifying-glass text-lg"></span>
                        </button>
                    </form>
                    <div class="recent md:mt-10 mt-7">
                        <h6 class="heading6">Recent Posts</h6>
                        <ul class="list-recent mt-5">
                            {% for post in recent_posts %}
                            {% if forloop.first %}
                            <li class="blog_item outstanding_blog">
                                <a href="{{ post.url }}" class="blog_thumb block w-full rounded-lg overflow-hidden">
                                    {% if post.featured_image %}
                                        {% image post.featured_image fill-360x240 as thumb_img %}
                                        <img src="{{ thumb_img.url }}" alt="{{ post.title }}" class="blog_img w-full" />
                                    {% else %}
                                        <img src="{% static 'assets/images/blog/default.webp' %}" alt="{{ post.title }}" class="blog_img w-full" />
                                    {% endif %}
                                </a>
                                <div class="flex flex-wrap items-center gap-2 mt-5 mb-2">
                                    <div class="date flex items-center gap-2">
                                        <span class="ph ph-calendar-blank text-xl"></span>
                                        <span class="blog_date caption1">{{ post.publishing_date|date:"F d, Y"|default:post.first_published_at|date:"F d, Y" }}</span>
                                    </div>
                                    {% with parent=post.get_parent.specific %}
                                        {% if parent.specific_class.name == 'CategoryPage' %}
                                        <div class="line w-px h-3 bg-line"></div>
                                        <a href="{{ parent.url }}" class="category flex items-center gap-2 duration-300 hover:text-primary">
                                            <span class="ph ph-tag-simple text-xl"></span>
                                            <span class="blog_category caption1">{{ parent.title }}</span>
                                        </a>
                                        {% endif %}
                                    {% endwith %}
                                </div>
                                <a href="{{ post.url }}" class="blog_name heading6 duration-300 hover:text-primary">{{ post.title }}</a>
                            </li>
                            {% else %}
                            <li class="blog_item flex gap-4 mt-5 pt-5 border-t border-line">
                                <a href="{{ post.url }}" class="blog_thumb block flex-shrink-0 w-[100px] h-fit rounded overflow-hidden">
                                    {% if post.featured_image %}
                                        {% image post.featured_image fill-100x75 as small_thumb %}
                                        <img src="{{ small_thumb.url }}" alt="{{ post.title }}" class="blog_img w-full" />
                                    {% else %}
                                        <img src="{% static 'assets/images/blog/default.webp' %}" alt="{{ post.title }}" class="blog_img w-full" />
                                    {% endif %}
                                </a>
                                <div>
                                    <a href="{{ post.url }}" class="blog_name text-button duration-300 hover:text-primary">{{ post.title }}</a>
                                    <div class="flex flex-wrap items-center gap-2 gap-y-1 mt-1.5">
                                        <span class="blog_date caption1">{{ post.publishing_date|date:"F d, Y"|default:post.first_published_at|date:"F d, Y" }}</span>
                                    </div>
                                </div>
                            </li>
                            {% endif %}
                            {% empty %}
                            <li class="text-secondary">No recent posts available.</li>
                            {% endfor %}
                        </ul>
                    </div>
                    <div class="filter_category md:mt-10 mt-7">
                        <h6 class="heading6">Categories</h6>
                        <ul class="list_category flex flex-col gap-3 mt-5" role="tablist">
                            {% for category in categories %}
                            <li role="presentation">
                                <a href="{% url 'frontend:blog:search' %}?category={{ category.id }}" class="tab_btn text-button -before line-before line-black" role="tab">
                                    {{ category.title }} ({{ category.get_children.live.count }})
                                </a>
                            </li>
                            {% empty %}
                            <li class="text-secondary caption1">No categories available.</li>
                            {% endfor %}
                        </ul>
                    </div>
                    <div class="filter_tags md:mt-10 mt-7">
                        <h6 class="heading6">Popular Tag</h6>
                        <ul class="list_tags menu_tab flex items-center flex-wrap gap-3 mt-5" role="tablist">
                            {% for tag in popular_tags %}
                            <li role="presentation">
                                <a href="{% url 'frontend:blog:search' %}?tag={{ tag.slug }}" class="tag tab_btn -fill -border -rounded-sm caption1 capitalize hover:bg-black hover:text-white" role="tab">
                                    {{ tag.name }}
                                </a>
                            </li>
                            {% empty %}
                            <li class="text-secondary caption1">No tags available.</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
        </div>

{% endblock %}
