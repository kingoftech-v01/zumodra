# Generated by Django 5.2.7 on 2026-01-11 08:13

import django.contrib.postgres.fields
import django.core.validators
import django.db.models.deletion
import uuid
from decimal import Decimal
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('ats', '0001_initial'),
        ('configurations', '0001_initial'),
        ('tenants', '0001_initial'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='AIServiceStatus',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('service_name', models.CharField(choices=[('openai_embedding', 'OpenAI Embedding'), ('openai_chat', 'OpenAI Chat'), ('local_embedding', 'Local Embedding Model'), ('resume_parser', 'Resume Parser')], max_length=50, unique=True)),
                ('is_available', models.BooleanField(default=True)),
                ('last_check', models.DateTimeField(auto_now=True)),
                ('last_success', models.DateTimeField(blank=True, null=True)),
                ('last_failure', models.DateTimeField(blank=True, null=True)),
                ('failure_count', models.PositiveIntegerField(default=0)),
                ('error_message', models.TextField(blank=True)),
                ('requests_today', models.PositiveIntegerField(default=0)),
                ('daily_limit', models.PositiveIntegerField(default=10000)),
            ],
            options={
                'verbose_name': 'AI Service Status',
                'verbose_name_plural': 'AI Service Statuses',
            },
        ),
        migrations.CreateModel(
            name='AIModelVersion',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('uuid', models.UUIDField(default=uuid.uuid4, editable=False, unique=True)),
                ('version', models.CharField(help_text='Semantic version string (e.g., 1.0.0)', max_length=50)),
                ('model_type', models.CharField(choices=[('skill_matcher', 'Skill Matcher'), ('resume_parser', 'Resume Parser'), ('embedding', 'Embedding Generator'), ('bias_detector', 'Bias Detector'), ('job_analyzer', 'Job Analyzer'), ('candidate_ranker', 'Candidate Ranker')], db_index=True, max_length=30)),
                ('config', models.JSONField(default=dict, help_text='Model configuration parameters')),
                ('model_name', models.CharField(default='all-MiniLM-L6-v2', help_text='Underlying model name (e.g., all-MiniLM-L6-v2)', max_length=100)),
                ('embedding_dimension', models.PositiveIntegerField(default=384, help_text='Embedding vector dimension')),
                ('deployed_at', models.DateTimeField(auto_now_add=True)),
                ('is_active', models.BooleanField(db_index=True, default=False, help_text='Whether this version is currently active')),
                ('deprecated_at', models.DateTimeField(blank=True, null=True)),
                ('accuracy_score', models.FloatField(blank=True, help_text='Measured accuracy on test set', null=True, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(1)])),
                ('avg_latency_ms', models.FloatField(blank=True, help_text='Average inference latency in milliseconds', null=True)),
                ('changelog', models.TextField(blank=True, help_text='Description of changes in this version')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'AI Model Version',
                'verbose_name_plural': 'AI Model Versions',
                'ordering': ['-deployed_at'],
                'indexes': [models.Index(fields=['model_type', 'is_active'], name='ai_matching_model_t_815450_idx'), models.Index(fields=['-deployed_at'], name='ai_matching_deploye_9d961c_idx')],
                'unique_together': {('version', 'model_type')},
            },
        ),
        migrations.CreateModel(
            name='RankingProfile',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False, verbose_name='ID')),
                ('uuid', models.UUIDField(default=uuid.uuid4, editable=False, unique=True)),
                ('name', models.CharField(help_text='Profile name', max_length=100)),
                ('description', models.TextField(blank=True)),
                ('is_default', models.BooleanField(default=False)),
                ('is_active', models.BooleanField(default=True)),
                ('rule_score_weight', models.DecimalField(decimal_places=3, default=Decimal('0.300'), help_text='Weight for deterministic rule matching (0-1)', max_digits=4)),
                ('ai_score_weight', models.DecimalField(decimal_places=3, default=Decimal('0.500'), help_text='Weight for AI/ML matching (0-1)', max_digits=4)),
                ('verification_score_weight', models.DecimalField(decimal_places=3, default=Decimal('0.200'), help_text='Weight for verification/trust score (0-1)', max_digits=4)),
                ('skill_match_weight', models.DecimalField(decimal_places=3, default=Decimal('0.350'), help_text='Weight for skill matching', max_digits=4)),
                ('experience_match_weight', models.DecimalField(decimal_places=3, default=Decimal('0.250'), help_text='Weight for experience level matching', max_digits=4)),
                ('culture_fit_weight', models.DecimalField(decimal_places=3, default=Decimal('0.150'), help_text='Weight for culture fit prediction', max_digits=4)),
                ('location_match_weight', models.DecimalField(decimal_places=3, default=Decimal('0.150'), help_text='Weight for location/remote preference', max_digits=4)),
                ('salary_match_weight', models.DecimalField(decimal_places=3, default=Decimal('0.100'), help_text='Weight for salary expectation alignment', max_digits=4)),
                ('identity_verification_weight', models.DecimalField(decimal_places=3, default=Decimal('0.300'), help_text='Weight for KYC/identity verification', max_digits=4)),
                ('career_verification_weight', models.DecimalField(decimal_places=3, default=Decimal('0.400'), help_text='Weight for employment/education verification', max_digits=4)),
                ('trust_score_weight', models.DecimalField(decimal_places=3, default=Decimal('0.300'), help_text='Weight for overall trust score', max_digits=4)),
                ('minimum_rule_score', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Minimum rule score to pass (0-100)', max_digits=5)),
                ('minimum_ai_score', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Minimum AI score to pass (0-100)', max_digits=5)),
                ('minimum_verification_score', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Minimum verification score to pass (0-100)', max_digits=5)),
                ('minimum_overall_score', models.DecimalField(decimal_places=2, default=Decimal('50.00'), help_text='Minimum overall score to recommend (0-100)', max_digits=5)),
                ('knockout_on_missing_required_skills', models.BooleanField(default=True, help_text='Disqualify if missing required skills')),
                ('knockout_on_experience_mismatch', models.BooleanField(default=False, help_text='Disqualify if experience below minimum')),
                ('knockout_on_location_mismatch', models.BooleanField(default=False, help_text='Disqualify if location/remote mismatch')),
                ('knockout_on_salary_mismatch', models.BooleanField(default=False, help_text='Disqualify if salary expectation too high')),
                ('knockout_on_education_mismatch', models.BooleanField(default=False, help_text='Disqualify if education below minimum')),
                ('bonus_for_verified_career', models.DecimalField(decimal_places=2, default=Decimal('5.00'), help_text='Bonus points for career verification', max_digits=5)),
                ('bonus_for_premium_trust', models.DecimalField(decimal_places=2, default=Decimal('3.00'), help_text='Bonus points for premium trust level', max_digits=5)),
                ('bonus_for_platform_experience', models.DecimalField(decimal_places=2, default=Decimal('2.00'), help_text='Bonus points for successful platform history', max_digits=5)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='ranking_profiles_created', to=settings.AUTH_USER_MODEL)),
                ('tenant', models.ForeignKey(help_text='The tenant this record belongs to.', on_delete=django.db.models.deletion.CASCADE, related_name='%(app_label)s_%(class)s_set', to='tenants.tenant', verbose_name='Tenant')),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='ranking_profiles_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Ranking Profile',
                'verbose_name_plural': 'Ranking Profiles',
                'ordering': ['-is_default', 'name'],
            },
        ),
        migrations.CreateModel(
            name='RankingRule',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False, verbose_name='ID')),
                ('uuid', models.UUIDField(default=uuid.uuid4, editable=False, unique=True)),
                ('name', models.CharField(max_length=100)),
                ('description', models.TextField(blank=True)),
                ('is_active', models.BooleanField(default=True)),
                ('rule_type', models.CharField(choices=[('knockout', 'Knockout (Must Pass)'), ('preference', 'Preference (Weighted)'), ('bonus', 'Bonus (Additional Points)')], default='preference', max_length=20)),
                ('field_type', models.CharField(choices=[('skill', 'Skill'), ('experience_years', 'Years of Experience'), ('education', 'Education Level'), ('certification', 'Certification'), ('location', 'Location'), ('remote', 'Remote Preference'), ('salary', 'Salary Expectation'), ('language', 'Language'), ('work_auth', 'Work Authorization'), ('availability', 'Availability Date'), ('custom', 'Custom Field')], max_length=20)),
                ('operator', models.CharField(choices=[('eq', 'Equals'), ('neq', 'Not Equals'), ('gt', 'Greater Than'), ('gte', 'Greater Than or Equal'), ('lt', 'Less Than'), ('lte', 'Less Than or Equal'), ('contains', 'Contains'), ('not_contains', 'Not Contains'), ('in', 'In List'), ('not_in', 'Not In List'), ('any', 'Matches Any'), ('all', 'Matches All')], default='eq', max_length=20)),
                ('target_value', models.JSONField(default=dict, help_text='Target value(s) for comparison')),
                ('weight', models.DecimalField(decimal_places=2, default=Decimal('1.00'), help_text='Weight/points for this rule', max_digits=5)),
                ('apply_to_all_jobs', models.BooleanField(default=True, help_text='Apply to all jobs in tenant')),
                ('job_categories', django.contrib.postgres.fields.ArrayField(base_field=models.CharField(max_length=50), blank=True, default=list, help_text='Specific job categories to apply to', size=None)),
                ('priority', models.PositiveIntegerField(default=100, help_text='Evaluation priority (lower = first)')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('tenant', models.ForeignKey(help_text='The tenant this record belongs to.', on_delete=django.db.models.deletion.CASCADE, related_name='%(app_label)s_%(class)s_set', to='tenants.tenant', verbose_name='Tenant')),
            ],
            options={
                'verbose_name': 'Ranking Rule',
                'verbose_name_plural': 'Ranking Rules',
                'ordering': ['priority', 'name'],
            },
        ),
        migrations.CreateModel(
            name='BiasAuditLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('uuid', models.UUIDField(default=uuid.uuid4, editable=False, unique=True)),
                ('content_type', models.CharField(choices=[('job_posting', 'Job Posting'), ('matching_result', 'Matching Result'), ('recommendation', 'Recommendation')], max_length=30)),
                ('content_id', models.PositiveIntegerField(help_text='ID of the audited content')),
                ('bias_detected', models.BooleanField(default=False)),
                ('bias_types', django.contrib.postgres.fields.ArrayField(base_field=models.CharField(max_length=50), blank=True, default=list, help_text='Types of bias detected (gender, age, etc.)', size=None)),
                ('bias_score', models.DecimalField(blank=True, decimal_places=4, help_text='Overall bias score (0-1, higher = more bias)', max_digits=5, null=True)),
                ('flagged_phrases', models.JSONField(blank=True, default=list, help_text='Specific phrases flagged for bias')),
                ('suggestions', models.JSONField(blank=True, default=list, help_text='Suggested neutral alternatives')),
                ('automated', models.BooleanField(default=True, help_text='Whether this was an automated check')),
                ('action_taken', models.CharField(choices=[('none', 'No Action'), ('warned', 'Warning Issued'), ('modified', 'Content Modified'), ('blocked', 'Content Blocked')], default='none', max_length=30)),
                ('action_notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('auditor', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='bias_audits_performed', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Bias Audit Log',
                'verbose_name_plural': 'Bias Audit Logs',
                'ordering': ['-created_at'],
                'indexes': [models.Index(fields=['content_type', 'content_id'], name='ai_matching_content_b08c1e_idx'), models.Index(fields=['bias_detected'], name='ai_matching_bias_de_890da8_idx'), models.Index(fields=['created_at'], name='ai_matching_created_8cde1f_idx')],
            },
        ),
        migrations.CreateModel(
            name='BiasMetric',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('uuid', models.UUIDField(default=uuid.uuid4, editable=False, unique=True)),
                ('period_start', models.DateField(db_index=True)),
                ('period_end', models.DateField(db_index=True)),
                ('total_candidates_evaluated', models.PositiveIntegerField(default=0)),
                ('total_matches_computed', models.PositiveIntegerField(default=0)),
                ('demographic_distribution', models.JSONField(blank=True, default=dict, help_text='Distribution of candidates by demographic (anonymized)')),
                ('score_distribution', models.JSONField(blank=True, default=dict, help_text='Score distribution analysis. Format: {"mean": 0.65, "std": 0.15, "percentiles": {...}}')),
                ('gender_parity_score', models.FloatField(blank=True, help_text='Gender parity score (1.0 = perfect parity)', null=True, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(1)])),
                ('age_parity_score', models.FloatField(blank=True, null=True, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(1)])),
                ('disparate_impact_ratio', models.FloatField(blank=True, help_text='Disparate impact ratio (>0.8 generally acceptable)', null=True)),
                ('equal_opportunity_diff', models.FloatField(blank=True, help_text='Equal opportunity difference (closer to 0 is better)', null=True)),
                ('bias_detected', models.BooleanField(default=False)),
                ('bias_types', django.contrib.postgres.fields.ArrayField(base_field=models.CharField(max_length=50), blank=True, default=list, size=None)),
                ('recommendations', models.JSONField(blank=True, default=list, help_text='Recommended actions to address bias')),
                ('reviewed_at', models.DateTimeField(blank=True, null=True)),
                ('review_notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('job', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='bias_metrics', to='ats.jobposting')),
                ('reviewed_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='reviewed_bias_metrics', to=settings.AUTH_USER_MODEL)),
                ('tenant', models.ForeignKey(help_text='Tenant this object belongs to', on_delete=django.db.models.deletion.CASCADE, related_name='%(app_label)s_%(class)s_set', to='tenants.tenant')),
            ],
            options={
                'verbose_name': 'Bias Metric',
                'verbose_name_plural': 'Bias Metrics',
                'ordering': ['-period_start'],
                'indexes': [models.Index(fields=['tenant', 'period_start'], name='ai_matching_tenant__6b90d9_idx'), models.Index(fields=['bias_detected'], name='ai_matching_bias_de_b282ec_idx')],
            },
        ),
        migrations.CreateModel(
            name='CandidateEmbedding',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('embedding_vector', django.contrib.postgres.fields.ArrayField(base_field=models.FloatField(), help_text='Combined vector representation of candidate profile', size=1536)),
                ('skills_vector', django.contrib.postgres.fields.ArrayField(base_field=models.FloatField(), blank=True, help_text='Vector for skills only', null=True, size=1536)),
                ('experience_vector', django.contrib.postgres.fields.ArrayField(base_field=models.FloatField(), blank=True, help_text='Vector for work experience', null=True, size=1536)),
                ('education_vector', django.contrib.postgres.fields.ArrayField(base_field=models.FloatField(), blank=True, help_text='Vector for education background', null=True, size=1536)),
                ('bio_vector', django.contrib.postgres.fields.ArrayField(base_field=models.FloatField(), blank=True, help_text='Vector for bio/summary text', null=True, size=1536)),
                ('embedding_model', models.CharField(default='text-embedding-ada-002', max_length=100)),
                ('total_experience_years', models.DecimalField(blank=True, decimal_places=1, help_text='Total years of experience calculated from resume', max_digits=4, null=True)),
                ('skills_extracted', django.contrib.postgres.fields.ArrayField(base_field=models.CharField(max_length=100), blank=True, default=list, help_text='Skills extracted from resume', size=None)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('candidate', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='embedding', to='configurations.candidateprofile')),
            ],
            options={
                'verbose_name': 'Candidate Embedding',
                'verbose_name_plural': 'Candidate Embeddings',
                'indexes': [models.Index(fields=['candidate'], name='ai_matching_candida_9977b8_idx'), models.Index(fields=['updated_at'], name='ai_matching_updated_727dfb_idx')],
            },
        ),
        migrations.CreateModel(
            name='JobEmbedding',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('embedding_vector', django.contrib.postgres.fields.ArrayField(base_field=models.FloatField(), help_text='Vector representation of job requirements', size=1536)),
                ('title_vector', django.contrib.postgres.fields.ArrayField(base_field=models.FloatField(), blank=True, help_text='Vector for job title only', null=True, size=1536)),
                ('requirements_vector', django.contrib.postgres.fields.ArrayField(base_field=models.FloatField(), blank=True, help_text='Vector for job requirements text', null=True, size=1536)),
                ('description_vector', django.contrib.postgres.fields.ArrayField(base_field=models.FloatField(), blank=True, help_text='Vector for job description text', null=True, size=1536)),
                ('embedding_model', models.CharField(default='text-embedding-ada-002', max_length=100)),
                ('skills_extracted', django.contrib.postgres.fields.ArrayField(base_field=models.CharField(max_length=100), blank=True, default=list, help_text='Skills extracted from job description', size=None)),
                ('experience_years_min', models.PositiveIntegerField(blank=True, help_text='Minimum years of experience extracted', null=True)),
                ('experience_years_max', models.PositiveIntegerField(blank=True, help_text='Maximum years of experience extracted', null=True)),
                ('is_remote', models.BooleanField(blank=True, help_text='Whether job allows remote work', null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('job', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='embedding', to='configurations.job')),
            ],
            options={
                'verbose_name': 'Job Embedding',
                'verbose_name_plural': 'Job Embeddings',
                'indexes': [models.Index(fields=['job'], name='ai_matching_job_id_4ede94_idx'), models.Index(fields=['updated_at'], name='ai_matching_updated_fe15bc_idx')],
            },
        ),
        migrations.CreateModel(
            name='JobMatchingProfile',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('uuid', models.UUIDField(default=uuid.uuid4, editable=False, unique=True)),
                ('embedding', django.contrib.postgres.fields.ArrayField(base_field=models.FloatField(), blank=True, help_text='Combined vector representation of job requirements', null=True, size=384)),
                ('title_embedding', django.contrib.postgres.fields.ArrayField(base_field=models.FloatField(), blank=True, null=True, size=384)),
                ('requirements_embedding', django.contrib.postgres.fields.ArrayField(base_field=models.FloatField(), blank=True, null=True, size=384)),
                ('description_embedding', django.contrib.postgres.fields.ArrayField(base_field=models.FloatField(), blank=True, null=True, size=384)),
                ('required_skills_normalized', models.JSONField(blank=True, default=dict, help_text='Required skills with weights. Format: {"skill_id": {"name": "Python", "weight": 1.0, "required": true}}')),
                ('nice_to_have_normalized', models.JSONField(blank=True, default=dict, help_text='Nice-to-have skills with weights')),
                ('experience_weight', models.FloatField(default=0.2, help_text='Weight for experience matching', validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(1)])),
                ('skills_weight', models.FloatField(default=0.35, help_text='Weight for skills matching', validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(1)])),
                ('education_weight', models.FloatField(default=0.1, help_text='Weight for education matching', validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(1)])),
                ('cultural_fit_weight', models.FloatField(default=0.15, help_text='Weight for cultural fit matching', validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(1)])),
                ('location_weight', models.FloatField(default=0.1, help_text='Weight for location matching', validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(1)])),
                ('salary_weight', models.FloatField(default=0.1, help_text='Weight for salary matching', validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(1)])),
                ('min_experience_years', models.PositiveIntegerField(blank=True, null=True)),
                ('max_experience_years', models.PositiveIntegerField(blank=True, null=True)),
                ('required_education_level', models.CharField(blank=True, max_length=50)),
                ('is_remote', models.BooleanField(blank=True, null=True)),
                ('company_values', django.contrib.postgres.fields.ArrayField(base_field=models.CharField(max_length=100), blank=True, default=list, size=None)),
                ('last_processed', models.DateTimeField(auto_now=True)),
                ('processing_version', models.CharField(blank=True, max_length=50)),
                ('processing_status', models.CharField(choices=[('pending', 'Pending'), ('processing', 'Processing'), ('completed', 'Completed'), ('failed', 'Failed')], default='pending', max_length=20)),
                ('processing_error', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('job', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='matching_profile', to='ats.jobposting')),
                ('tenant', models.ForeignKey(help_text='Tenant this object belongs to', on_delete=django.db.models.deletion.CASCADE, related_name='%(app_label)s_%(class)s_set', to='tenants.tenant')),
            ],
            options={
                'verbose_name': 'Job Matching Profile',
                'verbose_name_plural': 'Job Matching Profiles',
                'indexes': [models.Index(fields=['tenant', 'job'], name='ai_matching_tenant__90bc0a_idx'), models.Index(fields=['processing_status'], name='ai_matching_process_7870a0_idx'), models.Index(fields=['-last_processed'], name='ai_matching_last_pr_4b249a_idx')],
            },
        ),
        migrations.CreateModel(
            name='MatchingProfile',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('uuid', models.UUIDField(default=uuid.uuid4, editable=False, unique=True)),
                ('embedding', django.contrib.postgres.fields.ArrayField(base_field=models.FloatField(), blank=True, help_text='Vector representation of candidate profile', null=True, size=384)),
                ('skills_embedding', django.contrib.postgres.fields.ArrayField(base_field=models.FloatField(), blank=True, help_text='Vector for skills only', null=True, size=384)),
                ('experience_embedding', django.contrib.postgres.fields.ArrayField(base_field=models.FloatField(), blank=True, help_text='Vector for work experience', null=True, size=384)),
                ('education_embedding', django.contrib.postgres.fields.ArrayField(base_field=models.FloatField(), blank=True, help_text='Vector for education background', null=True, size=384)),
                ('skills_normalized', models.JSONField(blank=True, default=dict, help_text='Normalized skill list with weights. Format: {"skill_id": {"name": "Python", "weight": 0.9, "category": "programming"}}')),
                ('experience_score', models.FloatField(default=0.0, help_text='Normalized experience score (0-1)', validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(1)])),
                ('education_score', models.FloatField(default=0.0, help_text='Normalized education score (0-1)', validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(1)])),
                ('overall_quality_score', models.FloatField(default=0.0, help_text='Overall profile completeness/quality score', validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(1)])),
                ('total_experience_years', models.DecimalField(blank=True, decimal_places=1, max_digits=4, null=True)),
                ('highest_education_level', models.CharField(blank=True, help_text='Highest education level (e.g., Masters, Bachelors)', max_length=50)),
                ('primary_skills', django.contrib.postgres.fields.ArrayField(base_field=models.CharField(max_length=100), blank=True, default=list, help_text='Top 10 primary skills', size=None)),
                ('industries', django.contrib.postgres.fields.ArrayField(base_field=models.CharField(max_length=100), blank=True, default=list, help_text='Industries from work experience', size=None)),
                ('last_processed', models.DateTimeField(auto_now=True)),
                ('processing_version', models.CharField(blank=True, help_text='AI model version used for processing', max_length=50)),
                ('processing_status', models.CharField(choices=[('pending', 'Pending'), ('processing', 'Processing'), ('completed', 'Completed'), ('failed', 'Failed')], default='pending', max_length=20)),
                ('processing_error', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('candidate', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='matching_profile', to='ats.candidate')),
                ('tenant', models.ForeignKey(help_text='Tenant this object belongs to', on_delete=django.db.models.deletion.CASCADE, related_name='%(app_label)s_%(class)s_set', to='tenants.tenant')),
            ],
            options={
                'verbose_name': 'Matching Profile',
                'verbose_name_plural': 'Matching Profiles',
                'indexes': [models.Index(fields=['tenant', 'candidate'], name='ai_matching_tenant__063fb9_idx'), models.Index(fields=['processing_status'], name='ai_matching_process_1df15e_idx'), models.Index(fields=['overall_quality_score'], name='ai_matching_overall_c56267_idx'), models.Index(fields=['-last_processed'], name='ai_matching_last_pr_6ba67d_idx')],
            },
        ),
        migrations.CreateModel(
            name='MatchingResult',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('uuid', models.UUIDField(default=uuid.uuid4, editable=False, unique=True)),
                ('overall_score', models.DecimalField(decimal_places=4, help_text='Overall match score (0-1)', max_digits=5)),
                ('skill_score', models.DecimalField(blank=True, decimal_places=4, help_text='Skill match score', max_digits=5, null=True)),
                ('experience_score', models.DecimalField(blank=True, decimal_places=4, help_text='Experience match score', max_digits=5, null=True)),
                ('location_score', models.DecimalField(blank=True, decimal_places=4, help_text='Location compatibility score', max_digits=5, null=True)),
                ('salary_score', models.DecimalField(blank=True, decimal_places=4, help_text='Salary alignment score', max_digits=5, null=True)),
                ('culture_score', models.DecimalField(blank=True, decimal_places=4, help_text='Culture fit score', max_digits=5, null=True)),
                ('education_score', models.DecimalField(blank=True, decimal_places=4, help_text='Education match score', max_digits=5, null=True)),
                ('matching_algorithm', models.CharField(choices=[('ai_embedding', 'AI Embedding Based'), ('rule_based', 'Rule-Based Fallback'), ('hybrid', 'Hybrid AI + Rules')], default='ai_embedding', max_length=50)),
                ('confidence_level', models.CharField(choices=[('high', 'High'), ('medium', 'Medium'), ('low', 'Low')], default='medium', max_length=20)),
                ('matched_skills', django.contrib.postgres.fields.ArrayField(base_field=models.CharField(max_length=100), blank=True, default=list, size=None)),
                ('missing_skills', django.contrib.postgres.fields.ArrayField(base_field=models.CharField(max_length=100), blank=True, default=list, size=None)),
                ('explanation', models.JSONField(blank=True, default=dict, help_text='Detailed explanation of match score components')),
                ('calculated_at', models.DateTimeField(auto_now_add=True)),
                ('expires_at', models.DateTimeField(help_text='When this cached result should be recalculated')),
                ('is_stale', models.BooleanField(default=False, help_text='Whether this match needs recalculation')),
                ('candidate', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='matching_results', to='configurations.candidateprofile')),
                ('job', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='matching_results', to='configurations.job')),
            ],
            options={
                'verbose_name': 'Matching Result',
                'verbose_name_plural': 'Matching Results',
                'ordering': ['-overall_score'],
                'indexes': [models.Index(fields=['candidate', 'job'], name='ai_matching_candida_f36849_idx'), models.Index(fields=['overall_score'], name='ai_matching_overall_04b040_idx'), models.Index(fields=['calculated_at'], name='ai_matching_calcula_98fc62_idx'), models.Index(fields=['is_stale'], name='ai_matching_is_stal_7a7af1_idx')],
                'unique_together': {('candidate', 'job')},
            },
        ),
        migrations.CreateModel(
            name='MatchResult',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('uuid', models.UUIDField(default=uuid.uuid4, editable=False, unique=True)),
                ('overall_score', models.FloatField(help_text='Overall match score (0-1)', validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(1)])),
                ('skill_match_score', models.FloatField(default=0, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(1)])),
                ('experience_match_score', models.FloatField(default=0, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(1)])),
                ('education_match_score', models.FloatField(default=0, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(1)])),
                ('cultural_fit_score', models.FloatField(default=0, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(1)])),
                ('location_match_score', models.FloatField(default=0, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(1)])),
                ('salary_match_score', models.FloatField(default=0, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(1)])),
                ('embedding_similarity', models.FloatField(blank=True, null=True, validators=[django.core.validators.MinValueValidator(-1), django.core.validators.MaxValueValidator(1)])),
                ('matched_skills', django.contrib.postgres.fields.ArrayField(base_field=models.CharField(max_length=100), blank=True, default=list, size=None)),
                ('missing_skills', django.contrib.postgres.fields.ArrayField(base_field=models.CharField(max_length=100), blank=True, default=list, size=None)),
                ('bonus_skills', django.contrib.postgres.fields.ArrayField(base_field=models.CharField(max_length=100), blank=True, default=list, help_text='Extra skills candidate has beyond requirements', size=None)),
                ('explanation', models.JSONField(blank=True, default=dict, help_text='Detailed explanation of match. Format: {"summary": "...", "strengths": [...], "gaps": [...], "recommendations": [...]}')),
                ('confidence_level', models.CharField(choices=[('high', 'High'), ('medium', 'Medium'), ('low', 'Low')], default='medium', max_length=20)),
                ('algorithm_used', models.CharField(choices=[('ai_embedding', 'AI Embedding Based'), ('rule_based', 'Rule-Based Fallback'), ('hybrid', 'Hybrid AI + Rules')], default='hybrid', max_length=30)),
                ('computed_at', models.DateTimeField(auto_now_add=True)),
                ('expires_at', models.DateTimeField(blank=True, help_text='When this cached result should be recalculated', null=True)),
                ('model_version', models.CharField(blank=True, help_text='AI model version used for this match', max_length=50)),
                ('computation_time_ms', models.PositiveIntegerField(blank=True, help_text='Time taken to compute this match in milliseconds', null=True)),
                ('is_stale', models.BooleanField(default=False, help_text='Whether this match needs recalculation')),
                ('candidate', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='ai_match_results', to='ats.candidate')),
                ('job', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='ai_match_results', to='ats.jobposting')),
                ('tenant', models.ForeignKey(help_text='Tenant this object belongs to', on_delete=django.db.models.deletion.CASCADE, related_name='%(app_label)s_%(class)s_set', to='tenants.tenant')),
            ],
            options={
                'verbose_name': 'Match Result',
                'verbose_name_plural': 'Match Results',
                'ordering': ['-overall_score'],
                'indexes': [models.Index(fields=['tenant', 'candidate', 'job'], name='ai_matching_tenant__e425e5_idx'), models.Index(fields=['tenant', 'job', '-overall_score'], name='ai_matching_tenant__49cb6b_idx'), models.Index(fields=['tenant', 'candidate', '-overall_score'], name='ai_matching_tenant__61e230_idx'), models.Index(fields=['overall_score'], name='ai_matching_overall_6b23b5_idx'), models.Index(fields=['computed_at'], name='ai_matching_compute_880776_idx'), models.Index(fields=['is_stale'], name='ai_matching_is_stal_1b409e_idx')],
                'unique_together': {('tenant', 'candidate', 'job')},
            },
        ),
        migrations.CreateModel(
            name='CandidateRanking',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, verbose_name='Created at')),
                ('updated_at', models.DateTimeField(auto_now=True, db_index=True, verbose_name='Updated at')),
                ('is_active', models.BooleanField(db_index=True, default=True, help_text='Designates whether this record is active.', verbose_name='Is active')),
                ('uuid', models.UUIDField(default=uuid.uuid4, editable=False, unique=True)),
                ('job_id', models.PositiveIntegerField(help_text='Reference to Job model')),
                ('candidate_id', models.PositiveIntegerField(help_text='Reference to Candidate/User model')),
                ('rule_score', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Deterministic rule-based score (0-100)', max_digits=5)),
                ('ai_score', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='AI/ML matching score (0-100)', max_digits=5)),
                ('verification_score', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Trust/verification score (0-100)', max_digits=5)),
                ('overall_score', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Weighted overall score (0-100)', max_digits=5)),
                ('skill_match_score', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=5)),
                ('experience_match_score', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=5)),
                ('culture_fit_score', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=5)),
                ('location_match_score', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=5)),
                ('salary_match_score', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=5)),
                ('identity_verification_score', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=5)),
                ('career_verification_score', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=5)),
                ('trust_score_value', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=5)),
                ('bonus_points', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=5)),
                ('bonuses_applied', models.JSONField(blank=True, default=list, help_text='List of bonuses applied')),
                ('passed_knockout', models.BooleanField(default=True)),
                ('knockout_reasons', models.JSONField(blank=True, default=list, help_text='Reasons for knockout if failed')),
                ('rules_evaluated', models.PositiveIntegerField(default=0)),
                ('rules_passed', models.PositiveIntegerField(default=0)),
                ('rule_details', models.JSONField(blank=True, default=list, help_text='Detailed results per rule')),
                ('ranking_explanation', models.JSONField(blank=True, default=dict, help_text='Human-readable explanation of ranking')),
                ('top_strengths', models.JSONField(blank=True, default=list, help_text='Top 5 matching strengths')),
                ('improvement_areas', models.JSONField(blank=True, default=list, help_text='Areas where candidate could improve match')),
                ('is_recommended', models.BooleanField(default=False, help_text='Passes minimum threshold')),
                ('rank_position', models.PositiveIntegerField(blank=True, help_text='Position in ranked list for this job', null=True)),
                ('calculated_at', models.DateTimeField(auto_now_add=True)),
                ('recalculated_at', models.DateTimeField(blank=True, null=True)),
                ('tenant', models.ForeignKey(help_text='The tenant this record belongs to.', on_delete=django.db.models.deletion.CASCADE, related_name='%(app_label)s_%(class)s_set', to='tenants.tenant', verbose_name='Tenant')),
                ('ranking_profile', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='rankings', to='ai_matching.rankingprofile')),
            ],
            options={
                'verbose_name': 'Candidate Ranking',
                'verbose_name_plural': 'Candidate Rankings',
                'ordering': ['-overall_score'],
                'indexes': [models.Index(fields=['tenant', 'job_id', '-overall_score'], name='ai_matching_tenant__9be1c0_idx'), models.Index(fields=['tenant', 'candidate_id'], name='ai_matching_tenant__1011bf_idx'), models.Index(fields=['is_recommended', '-overall_score'], name='ai_matching_is_reco_ae8eb9_idx')],
                'unique_together': {('tenant', 'job_id', 'candidate_id')},
            },
        ),
        migrations.CreateModel(
            name='RecommendationLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('uuid', models.UUIDField(default=uuid.uuid4, editable=False, unique=True)),
                ('recommendation_type', models.CharField(choices=[('jobs_for_candidate', 'Jobs for Candidate'), ('candidates_for_job', 'Candidates for Job'), ('similar_jobs', 'Similar Jobs'), ('similar_candidates', 'Similar Candidates'), ('skills_to_learn', 'Skills to Learn')], max_length=30)),
                ('recommended_items', models.JSONField(default=list, help_text='IDs of recommended items')),
                ('recommendation_scores', models.JSONField(default=dict, help_text='Scores for each recommended item')),
                ('context', models.JSONField(blank=True, default=dict, help_text='Context data used for recommendation')),
                ('items_viewed', models.JSONField(blank=True, default=list, help_text='Which recommended items were viewed')),
                ('items_clicked', models.JSONField(blank=True, default=list, help_text='Which recommended items were clicked')),
                ('items_applied', models.JSONField(blank=True, default=list, help_text='Which recommended items led to application')),
                ('user_rating', models.PositiveSmallIntegerField(blank=True, help_text='User rating of recommendations (1-5)', null=True)),
                ('user_feedback', models.TextField(blank=True, help_text='User feedback text')),
                ('algorithm_version', models.CharField(default='1.0', max_length=20)),
                ('model_used', models.CharField(default='text-embedding-ada-002', max_length=100)),
                ('fallback_used', models.BooleanField(default=False, help_text='Whether rule-based fallback was used')),
                ('processing_time_ms', models.PositiveIntegerField(blank=True, help_text='Time taken to generate recommendations', null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='recommendation_logs', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Recommendation Log',
                'verbose_name_plural': 'Recommendation Logs',
                'ordering': ['-created_at'],
                'indexes': [models.Index(fields=['user'], name='ai_matching_user_id_d0b6d5_idx'), models.Index(fields=['recommendation_type'], name='ai_matching_recomme_d17813_idx'), models.Index(fields=['created_at'], name='ai_matching_created_9ac35d_idx'), models.Index(fields=['fallback_used'], name='ai_matching_fallbac_fec19a_idx')],
            },
        ),
        migrations.CreateModel(
            name='SkillEmbedding',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('embedding_vector', django.contrib.postgres.fields.ArrayField(base_field=models.FloatField(), help_text='Vector representation of the skill', size=1536)),
                ('embedding_model', models.CharField(default='text-embedding-ada-002', help_text='Model used to generate the embedding', max_length=100)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('skill', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='embedding', to='configurations.skill')),
            ],
            options={
                'verbose_name': 'Skill Embedding',
                'verbose_name_plural': 'Skill Embeddings',
                'indexes': [models.Index(fields=['skill'], name='ai_matching_skill_i_29fa21_idx'), models.Index(fields=['updated_at'], name='ai_matching_updated_8f21b8_idx')],
            },
        ),
        migrations.CreateModel(
            name='SkillTaxonomy',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('uuid', models.UUIDField(default=uuid.uuid4, editable=False, unique=True)),
                ('canonical_name', models.CharField(help_text='Standardized skill name', max_length=100, unique=True)),
                ('display_name', models.CharField(help_text='User-friendly display name', max_length=100)),
                ('category', models.CharField(db_index=True, help_text='Skill category (e.g., programming, soft_skills)', max_length=50)),
                ('subcategory', models.CharField(blank=True, max_length=50)),
                ('aliases', django.contrib.postgres.fields.ArrayField(base_field=models.CharField(max_length=100), blank=True, default=list, help_text='Alternative names (e.g., ["JS", "JavaScript", "ECMAScript"])', size=None)),
                ('embedding', django.contrib.postgres.fields.ArrayField(base_field=models.FloatField(), blank=True, null=True, size=384)),
                ('description', models.TextField(blank=True)),
                ('is_active', models.BooleanField(default=True)),
                ('popularity_score', models.FloatField(default=0.5, help_text='How commonly this skill appears in job postings', validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(1)])),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('parent', models.ForeignKey(blank=True, help_text='Parent skill (e.g., Python -> Programming)', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='children', to='ai_matching.skilltaxonomy')),
                ('related_skills', models.ManyToManyField(blank=True, help_text='Related skills for similarity matching', to='ai_matching.skilltaxonomy')),
            ],
            options={
                'verbose_name': 'Skill Taxonomy',
                'verbose_name_plural': 'Skill Taxonomies',
                'ordering': ['category', 'canonical_name'],
                'indexes': [models.Index(fields=['canonical_name'], name='ai_matching_canonic_77b78d_idx'), models.Index(fields=['category'], name='ai_matching_categor_5a6e38_idx'), models.Index(fields=['is_active'], name='ai_matching_is_acti_5d78cb_idx')],
            },
        ),
    ]
