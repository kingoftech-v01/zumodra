# =============================================================================
# RabbitMQ Production Configuration for Zumodra
# =============================================================================

# -----------------------------------------------------------------------------
# Networking
# -----------------------------------------------------------------------------
listeners.tcp.default = 5672
management.tcp.port = 15672

# -----------------------------------------------------------------------------
# Resource Limits
# -----------------------------------------------------------------------------
# Memory watermark (80% of container memory)
vm_memory_high_watermark.relative = 0.8

# Disk free limit
disk_free_limit.absolute = 2GB

# File descriptors
# Set via environment or ulimit

# -----------------------------------------------------------------------------
# Performance Tuning
# -----------------------------------------------------------------------------
# Channel max (0 = unlimited)
channel_max = 2047

# Frame max
frame_max = 131072

# Heartbeat interval (seconds)
heartbeat = 60

# TCP buffer sizes
tcp_listen_options.backlog = 4096
tcp_listen_options.nodelay = true
tcp_listen_options.linger.on = true
tcp_listen_options.linger.timeout = 0
tcp_listen_options.sndbuf = 196608
tcp_listen_options.recbuf = 196608

# -----------------------------------------------------------------------------
# Queue Configuration
# -----------------------------------------------------------------------------
# Default queue type
default_queue_type = quorum

# Queue message TTL (optional)
# queue.default.message_ttl = 86400000

# -----------------------------------------------------------------------------
# Consumer Settings
# -----------------------------------------------------------------------------
# Consumer prefetch
consumer_timeout = 1800000

# -----------------------------------------------------------------------------
# Management Plugin
# -----------------------------------------------------------------------------
management.load_definitions = /etc/rabbitmq/definitions.json

# Rate limiting for management stats
management.rates_mode = basic

# -----------------------------------------------------------------------------
# Logging
# -----------------------------------------------------------------------------
log.console = true
log.console.level = info
log.file = /var/log/rabbitmq/rabbitmq.log
log.file.level = info
log.file.rotation.date = $D0
log.file.rotation.count = 7

# -----------------------------------------------------------------------------
# Security
# -----------------------------------------------------------------------------
# Disable guest user for remote connections
loopback_users.guest = true

# Password hashing
password_hashing_module = rabbit_password_hashing_sha256

# -----------------------------------------------------------------------------
# Clustering (for future HA setup)
# -----------------------------------------------------------------------------
# cluster_formation.peer_discovery_backend = rabbit_peer_discovery_k8s
# cluster_formation.k8s.host = kubernetes.default.svc.cluster.local
# cluster_partition_handling = autoheal
