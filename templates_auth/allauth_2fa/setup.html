{% extends "account/base.html" %}
{% load i18n %}

{% block head_title %}{% trans "Setup Two-Factor Authentication" %} - Zumodra{% endblock %}

{% block content %}
<div class="text-center mb-6">
    <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-green-100 flex items-center justify-center">
        <span class="ph-bold ph-shield-plus text-green-600 text-3xl"></span>
    </div>
    <h1 class="text-2xl font-bold text-gray-900 mb-2">{% trans "Setup Two-Factor Authentication" %}</h1>
    <p class="text-gray-600">{% trans "Add an extra layer of security to your account" %}</p>
</div>

{# Step 1: Scan QR Code #}
<div class="mb-6">
    <div class="flex items-center gap-2 mb-3">
        <span class="flex items-center justify-center w-6 h-6 rounded-full bg-blue-600 text-white text-sm font-bold">1</span>
        <h4 class="text-sm font-medium text-gray-900">{% trans "Scan the QR code" %}</h4>
    </div>
    <p class="text-sm text-gray-600 mb-4">
        {% trans "Use an authenticator app like Google Authenticator, Authy, or 1Password to scan this QR code." %}
    </p>
    <div class="flex justify-center p-4 bg-white border border-gray-200 rounded-lg">
        <img src="{{ qr_code_url }}" alt="{% trans 'QR Code for 2FA Setup' %}" class="w-48 h-48" />
    </div>
    <details class="mt-3">
        <summary class="text-sm text-gray-600 cursor-pointer hover:text-gray-900">
            {% trans "Can't scan the QR code? Enter this key manually" %}
        </summary>
        <div class="mt-2 p-3 bg-gray-50 rounded-lg">
            <code class="text-sm font-mono text-gray-900 break-all select-all">{{ secret }}</code>
        </div>
    </details>
</div>

{# Step 2: Verify Code #}
<div class="mb-6">
    <div class="flex items-center gap-2 mb-3">
        <span class="flex items-center justify-center w-6 h-6 rounded-full bg-blue-600 text-white text-sm font-bold">2</span>
        <h4 class="text-sm font-medium text-gray-900">{% trans "Verify setup" %}</h4>
    </div>
    <p class="text-sm text-gray-600 mb-4">
        {% trans "Enter the 6-digit code from your authenticator app to verify setup." %}
    </p>

    <form method="post" class="space-y-4">
        {% csrf_token %}

        {# Form Errors #}
        {% if form.non_field_errors %}
        <div class="p-4 bg-red-50 border-l-4 border-red-500 rounded-r-lg">
            <div class="flex items-start">
                <span class="ph-bold ph-warning-circle text-red-500 text-lg mr-2 flex-shrink-0"></span>
                <div class="text-sm text-red-700">
                    {% for error in form.non_field_errors %}
                    <p>{{ error }}</p>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}

        {# OTP Token Field #}
        <div>
            <label for="id_otp_token" class="block text-sm font-medium text-gray-700 mb-1">
                {% trans "Verification Code" %}
            </label>
            <div class="relative">
                <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
                    <span class="ph-bold ph-key text-lg"></span>
                </span>
                <input type="text"
                       name="otp_token"
                       id="id_otp_token"
                       class="w-full pl-10 pr-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors text-center text-2xl tracking-widest font-mono"
                       placeholder="000000"
                       autocomplete="one-time-code"
                       inputmode="numeric"
                       pattern="[0-9]*"
                       maxlength="6"
                       required>
            </div>
            {% if form.otp_token.errors %}
            <p class="mt-1 text-sm text-red-600">{{ form.otp_token.errors.0 }}</p>
            {% endif %}
        </div>

        {# Submit Button #}
        <button type="submit"
                class="w-full flex items-center justify-center gap-2 px-4 py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 focus:ring-4 focus:ring-green-300 transition-all duration-200">
            <span class="ph-bold ph-shield-check text-lg"></span>
            {% trans "Enable Two-Factor Authentication" %}
        </button>
    </form>
</div>

{# Security Notice #}
<div class="p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded-r-lg">
    <div class="flex items-start">
        <span class="ph-bold ph-warning text-yellow-600 text-lg mr-2 flex-shrink-0"></span>
        <div class="text-sm text-yellow-800">
            <p class="font-medium mb-1">{% trans "Important" %}</p>
            <p>{% trans "Once enabled, you'll need your phone to sign in. Make sure to save your backup codes in case you lose access to your device." %}</p>
        </div>
    </div>
</div>
{% endblock %}
