{
  "permissions": {
    "allow": [
      "Bash(python manage.py:*)",
      "Bash(ls:*)",
      "Bash(dir:*)",
      "Bash(powershell:*)",
      "Bash(python:*)",
      "Bash(findstr:*)",
      "Bash(cat:*)",
      "Bash(echo \"\n\n# ==================== HR REPORTS VIEW ====================\n\nclass HRReportsView\\(APIView\\):\n    \"\"\"\"\"\"\n    HR reporting endpoints for headcount, turnover, and time off utilization.\n    \"\"\"\"\"\"\n    permission_classes = [permissions.IsAuthenticated, permissions.IsAdminUser]\n\n    def get\\(self, request\\):\n        report_type = request.query_params.get\\(''report_type'', ''headcount''\\)\n        from datetime import datetime\n        today = timezone.now\\(\\).date\\(\\)\n        period_start_str = request.query_params.get\\(''period_start''\\)\n        period_end_str = request.query_params.get\\(''period_end''\\)\n        if period_start_str:\n            period_start = datetime.strptime\\(period_start_str, ''%Y-%m-%d''\\).date\\(\\)\n        else:\n            period_start = today.replace\\(month=1, day=1\\)\n        if period_end_str:\n            period_end = datetime.strptime\\(period_end_str, ''%Y-%m-%d''\\).date\\(\\)\n        else:\n            period_end = today\n\n        if report_type == ''headcount'':\n            return self._headcount_report\\(period_start, period_end\\)\n        elif report_type == ''turnover'':\n            return self._turnover_report\\(period_start, period_end\\)\n        elif report_type == ''time_off_utilization'':\n            return self._time_off_utilization_report\\(period_start, period_end\\)\n        else:\n            return Response\\({''detail'': f''Unknown report type: {report_type}''}, status=status.HTTP_400_BAD_REQUEST\\)\n\n    def _headcount_report\\(self, period_start, period_end\\):\n        total_employees = Employee.objects.count\\(\\)\n        active_employees = Employee.objects.filter\\(status__in=[''active'', ''probation'']\\).count\\(\\)\n        on_leave = Employee.objects.filter\\(status=''on_leave''\\).count\\(\\)\n        on_probation = Employee.objects.filter\\(status=''probation''\\).count\\(\\)\n        terminated_this_period = Employee.objects.filter\\(termination_date__gte=period_start, termination_date__lte=period_end\\).count\\(\\)\n        hired_this_period = Employee.objects.filter\\(hire_date__gte=period_start, hire_date__lte=period_end\\).count\\(\\)\n        by_department = list\\(Employee.objects.filter\\(status__in=[''active'', ''probation'']\\).values\\(''department__name''\\).annotate\\(count=Count\\(''id''\\)\\).order_by\\(''-count''\\)\\)\n        by_employment_type = dict\\(Employee.objects.filter\\(status__in=[''active'', ''probation'']\\).values_list\\(''employment_type''\\).annotate\\(count=Count\\(''id''\\)\\)\\)\n        by_location = list\\(Employee.objects.filter\\(status__in=[''active'', ''probation''], work_location__isnull=False\\).values\\(''work_location''\\).annotate\\(count=Count\\(''id''\\)\\).order_by\\(''-count''\\)[:10]\\)\n        return Response\\({''total_employees'': total_employees, ''active_employees'': active_employees, ''on_leave'': on_leave, ''on_probation'': on_probation, ''terminated_this_period'': terminated_this_period, ''hired_this_period'': hired_this_period, ''by_department'': by_department, ''by_employment_type'': by_employment_type, ''by_location'': by_location, ''as_of_date'': period_end}\\)\n\n    def _turnover_report\\(self, period_start, period_end\\):\n        offboardings = Offboarding.objects.filter\\(last_working_day__gte=period_start, last_working_day__lte=period_end\\)\n        total_terminations = offboardings.count\\(\\)\n        voluntary_terminations = offboardings.filter\\(separation_type__in=[''resignation'', ''retirement'']\\).count\\(\\)\n        involuntary_terminations = offboardings.filter\\(separation_type__in=[''termination'', ''layoff'']\\).count\\(\\)\n        start_headcount = Employee.objects.filter\\(hire_date__lte=period_start, status__in=[''active'', ''probation'', ''on_leave'']\\).count\\(\\)\n        end_headcount = Employee.objects.filter\\(status__in=[''active'', ''probation'', ''on_leave'']\\).count\\(\\)\n        average_headcount = \\(start_headcount + end_headcount\\) / 2 if start_headcount else end_headcount\n        turnover_rate = \\(total_terminations / average_headcount * 100\\) if average_headcount else 0\n        voluntary_turnover_rate = \\(voluntary_terminations / average_headcount * 100\\) if average_headcount else 0\n        by_department = list\\(offboardings.values\\(''employee__department__name''\\).annotate\\(count=Count\\(''id''\\)\\).order_by\\(''-count''\\)\\)\n        top_reasons = list\\(offboardings.exclude\\(reason=''''\\).values\\(''reason''\\).annotate\\(count=Count\\(''id''\\)\\).order_by\\(''-count''\\)[:5]\\)\n        return Response\\({''period_start'': period_start, ''period_end'': period_end, ''total_terminations'': total_terminations, ''voluntary_terminations'': voluntary_terminations, ''involuntary_terminations'': involuntary_terminations, ''average_headcount'': round\\(average_headcount, 1\\), ''turnover_rate'': round\\(turnover_rate, 2\\), ''voluntary_turnover_rate'': round\\(voluntary_turnover_rate, 2\\), ''by_department'': by_department, ''top_reasons'': top_reasons}\\)\n\n    def _time_off_utilization_report\\(self, period_start, period_end\\):\n        from django.db.models import Sum\n        time_off_requests = TimeOffRequest.objects.filter\\(status=TimeOffRequest.RequestStatus.APPROVED, start_date__lte=period_end, end_date__gte=period_start\\)\n        total_days_taken = time_off_requests.aggregate\\(total=Sum\\(''total_days''\\)\\)[''total''] or Decimal\\(''0''\\)\n        total_days_available = Employee.objects.filter\\(status__in=[''active'', ''probation'']\\).aggregate\\(total=Sum\\(''pto_balance''\\)\\)[''total''] or Decimal\\(''0''\\)\n        utilization_rate = \\(float\\(total_days_taken\\) / float\\(total_days_available\\) * 100\\) if total_days_available else 0\n        by_leave_type = list\\(time_off_requests.values\\(''time_off_type__name''\\).annotate\\(days=Sum\\(''total_days''\\), count=Count\\(''id''\\)\\).order_by\\(''-days''\\)\\)\n        by_department = list\\(time_off_requests.values\\(''employee__department__name''\\).annotate\\(days=Sum\\(''total_days''\\), count=Count\\(''id''\\)\\).order_by\\(''-days''\\)\\)\n        active_employee_count = Employee.objects.filter\\(status__in=[''active'', ''probation'']\\).count\\(\\)\n        average_days_per_employee = float\\(total_days_taken\\) / active_employee_count if active_employee_count else 0\n        pending_requests = TimeOffRequest.objects.filter\\(status=TimeOffRequest.RequestStatus.PENDING\\)\n        pending_requests_count = pending_requests.count\\(\\)\n        pending_requests_days = pending_requests.aggregate\\(total=Sum\\(''total_days''\\)\\)[''total''] or Decimal\\(''0''\\)\n        return Response\\({''period_start'': period_start, ''period_end'': period_end, ''total_days_taken'': float\\(total_days_taken\\), ''total_days_available'': float\\(total_days_available\\), ''utilization_rate'': round\\(utilization_rate, 2\\), ''by_leave_type'': by_leave_type, ''by_department'': by_department, ''average_days_per_employee'': round\\(average_days_per_employee, 2\\), ''pending_requests_count'': pending_requests_count, ''pending_requests_days'': float\\(pending_requests_days\\)}\\)\n\")",
      "Bash(python3:*)",
      "Bash(python -c:*)",
      "Bash(done)",
      "Bash(for app in accounts analytics api appointment ats blog careers configurations core custom_account_u dashboard dashboard_service drip finance hr_core integrations main marketing messages_sys newsletter notifications security services tenants)",
      "Bash(do test:*)",
      "Bash(echo:*)",
      "Bash(test:*)",
      "Bash(for app in accounts analytics api appointment ats blog careers custom_account_u dashboard dashboard_service drip finance hr_core integrations main marketing messages_sys newsletter notifications security services tenants)",
      "Bash(dir /b /s \"c:\\\\Users\\\\techn\\\\OneDrive\\\\Documents\\\\zumodra\")",
      "Bash(Get-ChildItem -Path \"c:\\\\Users\\\\techn\\\\OneDrive\\\\Documents\\\\zumodra\" -Recurse -Filter \"*.py\" -Name)",
      "Bash(Select-Object -First 100)",
      "Bash(Get-ChildItem -Path \"c:\\\\Users\\\\techn\\\\OneDrive\\\\Documents\\\\zumodra\" -Directory -Name)",
      "Bash(Where-Object { $_ -notmatch \"^\\(\\\\.|\\\\__\\)\" })",
      "Bash(powershell.exe -Command:*)",
      "Bash(for dir in accounts ai_matching analytics api ats appointment blog careers configurations core custom_account_u dashboard dashboard_service finance hr_core integrations logs marketing messages_sys newsletter notifications security services tenants main)",
      "Bash(do if [ -d \"/c/Users/techn/OneDrive/Documents/zumodra/$dir\" ])",
      "Bash(then echo \"=== APP: $dir ===\" ls -la \"/c/Users/techn/OneDrive/Documents/zumodra/$dir/\")",
      "Bash(fi)",
      "Bash(for app in accounts ai_matching analytics api ats appointment blog careers configurations core custom_account_u dashboard dashboard_service finance hr_core integrations main marketing messages_sys newsletter notifications security services tenants)",
      "Bash(do dir=\"/c/Users/techn/OneDrive/Documents/zumodra/$app\" echo \"=== $app ===\" ls \"$dir\")",
      "Bash(for app in tenants core custom_account_u accounts security ats hr_core careers ai_matching analytics finance messages_sys notifications newsletter blog marketing api integrations dashboard appointment services configurations)",
      "Bash(do echo \"=== $app ===\" find \"c:\\\\Users\\\\techn\\\\OneDrive\\\\Documents\\\\zumodra$app\" -maxdepth 2 -type f \\\\\\( -name \"models.py\" -o -name \"views.py\" -o -name \"admin.py\" -o -name \"urls.py\" -o -name \"apps.py\" \\\\\\))",
      "Bash(else)",
      "Bash(find:*)",
      "Bash(for app in accounts ai_matching analytics api appointment ats blog careers configurations core custom_account_u dashboard dashboard_service finance hr_core integrations main marketing messages_sys newsletter notifications security services tenants)",
      "Bash(do)",
      "Bash(if [ -f \"c:/Users/techn/OneDrive/Documents/zumodra/$app/urls.py\" ])",
      "Bash(then)",
      "Bash(docker compose config:*)",
      "Bash(for app in accounts analytics api appointment ats blog careers core dashboard dashboard_service custom_account_u drip finance hr_core integrations main marketing messages_sys newsletter notifications security services tenants)",
      "Bash(do if [ -d \"$app/migrations\" ])",
      "Bash(then echo \"$app: migrations/ exists\")",
      "Bash(else echo \"$app: MISSING migrations/\")",
      "Bash(grep:*)",
      "Bash(python -m py_compile:*)",
      "Bash(python -m pytest:*)",
      "Bash(git add:*)",
      "Bash(git push:*)",
      "Bash(ssh:*)",
      "Bash(git commit -m \"$\\(cat <<''EOF''\nfix: add missing TenantAwareModel import in ai_matching/models.py\n\nThe RankingProfile, RankingRule, and CandidateRanking models\ninherit from TenantAwareModel which needs to be imported from core.db.models.\n\nðŸ¤– Generated with [Claude Code]\\(https://claude.com/claude-code\\)\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git commit -m \"$\\(cat <<''EOF''\nfix: remove duplicate Tenant admin registration in main/admin.py\n\nTenant was registered in both main/admin.py and tenants/admin.py\ncausing AlreadyRegistered error. The tenants/admin.py version has\nfull configuration, so removing the duplicate from main.\n\nðŸ¤– Generated with [Claude Code]\\(https://claude.com/claude-code\\)\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(ssh -o ConnectTimeout=30 root@147.93.47.35 \"docker ps --format ''table {{.Names}}\\\\t{{.Ports}}'' | head -30\")",
      "Bash(git commit:*)",
      "Bash(ssh -o ConnectTimeout=30 root@147.93.47.35 \"docker ps -a --format ''table {{.Names}}\\\\t{{.Status}}'' | grep zumodra\")",
      "Bash(python manage.py makemigrations:*)",
      "Bash(timeout 30 ssh:*)",
      "Bash(timeout 10 sleep:*)"
    ]
  }
}
