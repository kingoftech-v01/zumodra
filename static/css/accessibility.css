/**
 * Accessibility Styles for Zumodra
 *
 * Features:
 * - Focus visible styles (WCAG 2.1 AA compliant)
 * - Skip link styling
 * - Reduced motion support
 * - High contrast mode support
 * - Screen reader only utilities
 *
 * WCAG 2.1 AA Compliance:
 * - Minimum contrast ratio of 4.5:1 for normal text
 * - Minimum contrast ratio of 3:1 for large text and UI components
 * - Focus indicators with minimum 2px width
 */

/* ==========================================================================
   CSS Custom Properties for Accessibility
   ========================================================================== */

:root {
    /* Focus ring colors */
    --focus-ring-color: #005fcc;
    --focus-ring-color-dark: #4da3ff;
    --focus-ring-width: 3px;
    --focus-ring-offset: 2px;
    --focus-ring-style: solid;

    /* Reduced motion variable (set by JS) */
    --reduce-motion: 0;

    /* High contrast colors */
    --high-contrast-bg: #000000;
    --high-contrast-fg: #ffffff;
    --high-contrast-link: #ffff00;
    --high-contrast-focus: #00ffff;
}

/* Dark theme focus colors */
[data-theme="dark"] {
    --focus-ring-color: #4da3ff;
}

/* ==========================================================================
   Screen Reader Only Utilities
   ========================================================================== */

/**
 * Visually hide content while keeping it accessible to screen readers
 * Use for skip links, additional context, labels, etc.
 */
.sr-only,
.visually-hidden {
    position: absolute !important;
    width: 1px !important;
    height: 1px !important;
    padding: 0 !important;
    margin: -1px !important;
    overflow: hidden !important;
    clip: rect(0, 0, 0, 0) !important;
    clip-path: inset(50%) !important;
    white-space: nowrap !important;
    border: 0 !important;
}

/**
 * Show visually hidden content when focused (for skip links)
 */
.sr-only-focusable:focus,
.sr-only-focusable:active,
.visually-hidden-focusable:focus,
.visually-hidden-focusable:active {
    position: static !important;
    width: auto !important;
    height: auto !important;
    padding: inherit !important;
    margin: inherit !important;
    overflow: visible !important;
    clip: auto !important;
    clip-path: none !important;
    white-space: normal !important;
}

/* ==========================================================================
   Skip Link Styles
   ========================================================================== */

.skip-link {
    position: absolute;
    top: -100%;
    left: 50%;
    transform: translateX(-50%);
    z-index: 10000;
    padding: 1rem 1.5rem;
    background-color: var(--focus-ring-color);
    color: #ffffff;
    font-size: 1rem;
    font-weight: 600;
    text-decoration: none;
    border-radius: 0 0 8px 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    transition: top 0.2s ease-in-out;
    white-space: nowrap;
}

.skip-link:focus,
.skip-link:active {
    top: 0;
    outline: none;
}

/* Dark mode skip link */
[data-theme="dark"] .skip-link {
    background-color: var(--focus-ring-color-dark);
    color: #000000;
}

/* Multiple skip links container */
.skip-links {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    z-index: 10000;
    display: flex;
    justify-content: center;
    gap: 0.5rem;
}

.skip-links .skip-link {
    position: relative;
    top: -100%;
}

.skip-links .skip-link:focus {
    top: 0;
}

/* ==========================================================================
   Focus Visible Styles
   ========================================================================== */

/**
 * Remove default focus outline for mouse users
 * Keep it for keyboard users via :focus-visible
 */
:focus:not(:focus-visible) {
    outline: none;
}

/**
 * Custom focus indicator for keyboard navigation
 * Meets WCAG 2.1 AA requirements (3:1 contrast, 2px minimum)
 */
:focus-visible {
    outline: var(--focus-ring-width) var(--focus-ring-style) var(--focus-ring-color);
    outline-offset: var(--focus-ring-offset);
    border-radius: 2px;
}

/* Specific focus styles for interactive elements */
a:focus-visible,
button:focus-visible,
input:focus-visible,
select:focus-visible,
textarea:focus-visible,
[role="button"]:focus-visible,
[role="link"]:focus-visible,
[tabindex]:focus-visible {
    outline: var(--focus-ring-width) var(--focus-ring-style) var(--focus-ring-color);
    outline-offset: var(--focus-ring-offset);
}

/* Card and container focus */
.card:focus-visible,
.panel:focus-visible,
[role="article"]:focus-visible,
[role="region"]:focus-visible {
    outline: var(--focus-ring-width) var(--focus-ring-style) var(--focus-ring-color);
    outline-offset: calc(var(--focus-ring-offset) + 2px);
}

/* Focus within for composite widgets */
.dropdown:focus-within,
.menu:focus-within,
.autocomplete:focus-within {
    outline: 2px solid var(--focus-ring-color);
    outline-offset: 1px;
}

/* Remove inner focus ring on buttons in Firefox */
button::-moz-focus-inner,
[type="button"]::-moz-focus-inner,
[type="reset"]::-moz-focus-inner,
[type="submit"]::-moz-focus-inner {
    border-style: none;
    padding: 0;
}

/* Focus indicator for form inputs */
input:focus-visible,
select:focus-visible,
textarea:focus-visible {
    border-color: var(--focus-ring-color);
    box-shadow: 0 0 0 3px rgba(0, 95, 204, 0.25);
}

[data-theme="dark"] input:focus-visible,
[data-theme="dark"] select:focus-visible,
[data-theme="dark"] textarea:focus-visible {
    border-color: var(--focus-ring-color-dark);
    box-shadow: 0 0 0 3px rgba(77, 163, 255, 0.25);
}

/* ==========================================================================
   Reduced Motion Support
   ========================================================================== */

/**
 * Respect user's motion preferences
 * Disable or reduce animations for users who prefer reduced motion
 */
@media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
    }

    /* Maintain essential visual feedback with subtle changes */
    .skip-link {
        transition: none;
    }

    /* Keep focus indicators visible without animation */
    :focus-visible {
        transition: none;
    }

    /* Disable parallax and scroll effects */
    .parallax {
        transform: none !important;
    }

    /* Disable autoplay videos */
    video[autoplay] {
        animation: none;
    }

    /* Remove hover transformations */
    .card:hover,
    .btn:hover,
    button:hover {
        transform: none !important;
    }
}

/* Class-based reduced motion (set by JS) */
.reduce-motion *,
.reduce-motion *::before,
.reduce-motion *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
}

/* ==========================================================================
   High Contrast Mode Support
   ========================================================================== */

/**
 * Support for Windows High Contrast Mode
 * Uses system colors for maximum compatibility
 */
@media (forced-colors: active) {
    /* Use system colors */
    .skip-link {
        background-color: Highlight;
        color: HighlightText;
        forced-color-adjust: none;
    }

    /* Ensure focus indicators are visible */
    :focus-visible {
        outline: 3px solid Highlight;
        outline-offset: 2px;
    }

    /* Buttons and links */
    a,
    button,
    [role="button"] {
        forced-color-adjust: none;
    }

    /* Form controls */
    input,
    select,
    textarea {
        border: 2px solid ButtonText;
    }

    input:focus,
    select:focus,
    textarea:focus {
        border-color: Highlight;
        outline: 2px solid Highlight;
    }

    /* Disabled state */
    button:disabled,
    input:disabled,
    select:disabled,
    textarea:disabled {
        border-color: GrayText;
        color: GrayText;
    }

    /* Icons and decorative elements */
    svg {
        forced-color-adjust: auto;
    }

    /* Ensure checkboxes and radios are visible */
    input[type="checkbox"],
    input[type="radio"] {
        forced-color-adjust: none;
        appearance: auto;
    }
}

/* Additional high contrast mode for users who enable it manually */
@media (prefers-contrast: more) {
    :root {
        --focus-ring-width: 4px;
    }

    body {
        font-weight: 500;
    }

    /* Increase border visibility */
    input,
    select,
    textarea {
        border-width: 2px;
    }

    /* Ensure links are underlined */
    a {
        text-decoration: underline;
    }

    /* Increase button contrast */
    button,
    .btn {
        border-width: 2px;
    }
}

/* ==========================================================================
   Interactive Element States
   ========================================================================== */

/* Ensure disabled states are clearly indicated */
[disabled],
[aria-disabled="true"],
.disabled {
    cursor: not-allowed;
    opacity: 0.6;
    pointer-events: none;
}

/* Busy/loading state indicator */
[aria-busy="true"] {
    cursor: progress;
}

/* Current/active page indicator */
[aria-current="page"],
[aria-current="step"],
[aria-current="location"] {
    font-weight: 700;
}

/* Selected state */
[aria-selected="true"] {
    background-color: rgba(0, 95, 204, 0.1);
}

[data-theme="dark"] [aria-selected="true"] {
    background-color: rgba(77, 163, 255, 0.1);
}

/* Expanded/collapsed indicators */
[aria-expanded="true"] > .expand-icon {
    transform: rotate(180deg);
}

/* Invalid form fields */
[aria-invalid="true"],
.is-invalid {
    border-color: #dc3545;
}

[aria-invalid="true"]:focus-visible,
.is-invalid:focus-visible {
    outline-color: #dc3545;
    box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.25);
}

/* ==========================================================================
   Text and Content Accessibility
   ========================================================================== */

/* Ensure text is readable */
body {
    line-height: 1.5;
    letter-spacing: 0.01em;
}

/* Maintain readable line lengths */
.readable-content,
article,
.prose {
    max-width: 75ch;
}

/* Ensure sufficient color contrast for links */
a:not(.btn) {
    text-decoration-thickness: 1px;
    text-underline-offset: 2px;
}

a:hover:not(.btn) {
    text-decoration-thickness: 2px;
}

/* Visible focus for code blocks */
pre:focus-visible,
code:focus-visible {
    outline: var(--focus-ring-width) var(--focus-ring-style) var(--focus-ring-color);
    outline-offset: 4px;
}

/* ==========================================================================
   Touch Target Sizes
   ========================================================================== */

/**
 * Ensure interactive elements meet minimum touch target size
 * WCAG 2.1 AA requires 44x44px minimum
 */
@media (pointer: coarse) {
    button,
    [role="button"],
    input[type="submit"],
    input[type="button"],
    input[type="reset"],
    a.btn {
        min-height: 44px;
        min-width: 44px;
    }

    /* Increase checkbox and radio sizes on touch */
    input[type="checkbox"],
    input[type="radio"] {
        min-width: 24px;
        min-height: 24px;
    }

    /* Navigation links */
    nav a {
        padding: 12px 16px;
    }
}

/* ==========================================================================
   Print Accessibility
   ========================================================================== */

@media print {
    /* Ensure links show their URLs */
    a[href]::after {
        content: " (" attr(href) ")";
        font-size: 0.875em;
        font-weight: normal;
    }

    /* Don't print decorative content */
    [aria-hidden="true"],
    [role="presentation"],
    .decorative {
        display: none !important;
    }

    /* Ensure adequate contrast */
    body {
        color: #000000;
        background: #ffffff;
    }
}

/* ==========================================================================
   ARIA Live Regions
   ========================================================================== */

/* Style for live regions (hidden but accessible) */
#aria-live-polite,
#aria-live-assertive,
[role="status"],
[role="alert"],
[aria-live] {
    /* Ensure screen readers can access */
}

#aria-live-polite,
#aria-live-assertive {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

/* Visible alerts for important messages */
.alert[role="alert"] {
    border-left: 4px solid currentColor;
    padding: 1rem;
}

/* ==========================================================================
   Utility Classes
   ========================================================================== */

/* Remove from accessibility tree */
.a11y-hidden {
    visibility: hidden;
}

/* Keep in accessibility tree but hide visually */
.a11y-offscreen {
    position: absolute;
    left: -10000px;
    width: 1px;
    height: 1px;
    overflow: hidden;
}

/* Force focus visibility */
.focus-visible {
    outline: var(--focus-ring-width) var(--focus-ring-style) var(--focus-ring-color) !important;
    outline-offset: var(--focus-ring-offset) !important;
}

/* No focus outline (use sparingly) */
.no-focus-outline:focus {
    outline: none;
}

/* Text that announces but doesn't display */
.announce-only {
    clip: rect(0, 0, 0, 0);
    clip-path: inset(50%);
    height: 1px;
    overflow: hidden;
    position: absolute;
    white-space: nowrap;
    width: 1px;
}
